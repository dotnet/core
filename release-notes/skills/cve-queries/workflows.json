{
  "kind": "workflows",
  "title": "CVE Query Workflows",
  "schema_version": "2.0",
  "skill": "cve-queries",
  "ai_note": "Workflows chain via next_workflow. Follow the chain until your query is satisfied.",
  "_links": {
    "self": {
      "href": "https://raw.githubusercontent.com/dotnet/core/refs/heads/release-index/release-notes/skills/cve-queries/workflows.json"
    }
  },
  "_embedded": {
    "entry_point": {
      "description": "Route CVE queries to the right workflow",
      "pre_check": {
        "description": "Before fetching timeline, check if embedded data answers the query",
        "since_date_pattern": {
          "matches": ["since {date}", "after {date}", "updated in {date}", "has there been"],
          "logic": "Compare query_date to llms.json._embedded.patches[version].latest_security_patch_date",
          "if_query_date_gte_latest": {
            "answer": "No security patch since {query_date}. Last was {version} on {latest_date}.",
            "fetch_needed": false,
            "stop": true
          },
          "if_query_date_lt_latest": {
            "answer": "Yes, {latest_security_patch} released on {latest_date}.",
            "fetch_needed": "only if CVE details requested",
            "continue_to": "decision"
          }
        }
      },
      "decision": {
        "latest_cves": { "workflow": "cve-latest", "hint": "recent patches, current vulnerabilities" },
        "cves_for_version": { "workflow": "cve-by-version", "hint": ".NET 8, .NET 9, specific version" },
        "cves_over_time": { "workflow": "cve-history", "hint": "last N months, date range, 2024 CVEs" },
        "code_analysis": { "workflow": "cve-details", "hint": "diffs, commits, CWE, packages" }
      }
    },
    "workflows": {
      "cve-latest": {
        "description": "CVEs from the most recent security release",
        "follow_path": ["kind:llms", "latest-security-disclosures"],
        "destination_kind": "month",
        "yields": {
          "data": "_embedded.disclosures[]",
          "fields": ["id", "title", "cvss_severity", "cvss_score", "affected_releases"]
        },
        "next_workflow": {
          "condition": "code diffs, CWE, or package versions needed",
          "workflow": "cve-extraction",
          "via": "follow _links.cve-json from current month index"
        }
      },
      "cve-by-version": {
        "description": "CVEs affecting a specific .NET version",
        "follow_path": ["kind:llms", "patches.{version}", "latest-security-disclosures"],
        "destination_kind": "month",
        "yields": {
          "data": "_embedded.disclosures[]",
          "filter": "where affected_releases contains {version}"
        },
        "next_workflow": {
          "condition": "code diffs, CWE, or package versions needed",
          "workflow": "cve-extraction",
          "via": "follow _links.cve-json from current month index"
        }
      },
      "cve-history": {
        "description": "CVEs over a time range",
        "decision": {
          "1-3_months": {
            "follow_path": ["kind:llms", "latest-security-disclosures"],
            "iterate": "walk prev-security-month until date < cutoff",
            "destination_kind": "month"
          },
          "4+_months_or_cross_year": {
            "follow_path": ["kind:llms", "latest-year"],
            "then": "follow _links.prev-year from each year index",
            "select": "_embedded.months[?security].cve-json links",
            "destination_kind": "cve",
            "note": "Skip month indexes—go directly to cve.json from year index"
          }
        },
        "yields": {
          "data": "disclosures from each month/cve.json in range"
        },
        "warning": "NEVER fabricate year URLs like timeline/2024/index.json. Always follow _links.prev-year from the current year index.",
        "next_workflow": {
          "condition": "code diffs needed",
          "workflow": "cve-extraction"
        }
      },
      "cve-details": {
        "description": "Go directly to cve.json for full details",
        "follow_path": ["kind:llms", "latest-cve-json"],
        "destination_kind": "cve",
        "next_workflow": {
          "always": true,
          "workflow": "cve-extraction"
        }
      },
      "cve-extraction": {
        "kind": "extraction",
        "description": "Extract data from cve.json (different schema than month index)",
        "source": "cve.json already fetched",
        "patterns": {
          "commit_diff": "$.commits[key].url — already ends in .diff, use as-is",
          "version_ranges": "$.products[] or $.packages[] — has min_vulnerable, fixed",
          "cwe": "$.disclosures[].weakness"
        },
        "warnings": [
          "$.commits[key].url already ends in .diff — fetch it directly",
          "NEVER strip .diff or fetch the commit HTML page (causes errors)"
        ]
      }
    }
  }
}
