# Microsoft.EntityFrameworkCore.Query

``` diff
 namespace Microsoft.EntityFrameworkCore.Query {
     public abstract class AsNoTrackingTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryFixtureBase<NoopModelCustomizer>, new() {
+        public virtual void Applied_after_navigation_expansion();
-        public virtual void Entity_not_added_to_state_manager();

+        public virtual void Entity_not_added_to_state_manager(bool useParam);
     }
     public abstract class AsTrackingTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryFixtureBase<NoopModelCustomizer>, new() {
-        public virtual void Entity_added_to_state_manager();

+        public virtual void Entity_added_to_state_manager(bool useParam);
     }
-    public readonly struct AsyncEnumerable<TResult> : IAsyncEnumerableAccessor<TResult> {
 {
-        public AsyncEnumerable(IAsyncEnumerable<TResult> asyncEnumerable);

-        IAsyncEnumerable<TResult> Microsoft.EntityFrameworkCore.Query.Internal.IAsyncEnumerableAccessor<TResult>.AsyncEnumerable { get; }

-        public Task ForEachAsync(Action<TResult> action, CancellationToken cancellationToken = default(CancellationToken));

-        public Task LoadAsync(CancellationToken cancellationToken = default(CancellationToken));

-        public Task<TResult[]> ToArrayAsync(CancellationToken cancellationToken = default(CancellationToken));

-        public Task<Dictionary<TKey, TElement>> ToDictionaryAsync<TKey, TElement>(Func<TResult, TKey> keySelector, Func<TResult, TElement> elementSelector, IEqualityComparer<TKey> comparer, CancellationToken cancellationToken = default(CancellationToken));

-        public Task<Dictionary<TKey, TElement>> ToDictionaryAsync<TKey, TElement>(Func<TResult, TKey> keySelector, Func<TResult, TElement> elementSelector, CancellationToken cancellationToken = default(CancellationToken));

-        public Task<Dictionary<TKey, TResult>> ToDictionaryAsync<TKey>(Func<TResult, TKey> keySelector, IEqualityComparer<TKey> comparer, CancellationToken cancellationToken = default(CancellationToken));

-        public Task<Dictionary<TKey, TResult>> ToDictionaryAsync<TKey>(Func<TResult, TKey> keySelector, CancellationToken cancellationToken = default(CancellationToken));

-        public Task<List<TResult>> ToListAsync(CancellationToken cancellationToken = default(CancellationToken));

-    }
     public abstract class AsyncFromSqlQueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryRelationalFixture<NoopModelCustomizer>, new() {
+        public virtual Task FromSqlRaw_annotations_do_not_affect_successive_calls();
+        public virtual Task FromSqlRaw_composed_with_nullable_predicate();
+        public virtual Task FromSqlRaw_queryable_composed();
+        public virtual Task FromSqlRaw_queryable_composed_multiple_line_query();
+        public virtual Task FromSqlRaw_queryable_multiple_composed();
+        public virtual Task FromSqlRaw_queryable_multiple_composed_with_closure_parameters();
+        public virtual Task FromSqlRaw_queryable_multiple_composed_with_parameters_and_closure_parameters();
+        public virtual Task FromSqlRaw_queryable_multiple_line_query();
+        public virtual Task FromSqlRaw_queryable_simple();
+        public virtual Task FromSqlRaw_queryable_simple_as_no_tracking_not_composed();
+        public virtual Task FromSqlRaw_queryable_simple_cache_key_includes_query_string();
+        public virtual Task FromSqlRaw_queryable_simple_columns_out_of_order();
+        public virtual Task FromSqlRaw_queryable_simple_columns_out_of_order_and_extra_columns();
+        public virtual Task FromSqlRaw_queryable_simple_composed_include();
+        public virtual Task FromSqlRaw_queryable_simple_include();
+        public virtual Task FromSqlRaw_queryable_simple_projection_not_composed();
+        public virtual Task FromSqlRaw_queryable_with_parameters();
+        public virtual Task FromSqlRaw_queryable_with_parameters_and_closure();
+        public virtual Task FromSqlRaw_queryable_with_parameters_cache_key_includes_parameters();
-        public virtual Task From_sql_annotations_do_not_affect_successive_calls();

-        public virtual Task From_sql_composed_with_nullable_predicate();

-        public virtual Task From_sql_queryable_composed();

-        public virtual Task From_sql_queryable_composed_multiple_line_query();

-        public virtual Task From_sql_queryable_multiple_composed();

-        public virtual Task From_sql_queryable_multiple_composed_with_closure_parameters();

-        public virtual Task From_sql_queryable_multiple_composed_with_parameters_and_closure_parameters();

-        public virtual Task From_sql_queryable_multiple_line_query();

-        public virtual Task From_sql_queryable_simple();

-        public virtual Task From_sql_queryable_simple_as_no_tracking_not_composed();

-        public virtual Task From_sql_queryable_simple_cache_key_includes_query_string();

-        public virtual Task From_sql_queryable_simple_columns_out_of_order();

-        public virtual Task From_sql_queryable_simple_columns_out_of_order_and_extra_columns();

-        public virtual Task From_sql_queryable_simple_composed_include();

-        public virtual Task From_sql_queryable_simple_include();

-        public virtual Task From_sql_queryable_simple_projection_not_composed();

-        public virtual Task From_sql_queryable_with_parameters();

-        public virtual Task From_sql_queryable_with_parameters_and_closure();

-        public virtual Task From_sql_queryable_with_parameters_cache_key_includes_parameters();

     }
-    public abstract class AsyncFromSqlSprocQueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryRelationalFixture<NoopModelCustomizer>, new() {
 {
-        protected AsyncFromSqlSprocQueryTestBase(TFixture fixture);

-        protected abstract string CustomerOrderHistorySproc { get; }

-        protected TFixture Fixture { get; }

-        protected abstract string TenMostExpensiveProductsSproc { get; }

-        protected NorthwindContext CreateContext();

-        public virtual Task From_sql_queryable_stored_procedure();

-        public virtual Task From_sql_queryable_stored_procedure_composed();

-        public virtual Task From_sql_queryable_stored_procedure_min();

-        public virtual Task From_sql_queryable_stored_procedure_take();

-        public virtual Task From_sql_queryable_stored_procedure_with_include_throws();

-        public virtual Task From_sql_queryable_stored_procedure_with_parameter();

-        public virtual Task From_sql_queryable_stored_procedure_with_parameter_composed();

-        protected virtual object[] GetCustomerOrderHistorySprocParameters();

-        protected virtual object[] GetTenMostExpensiveProductsParameters();

-    }
-    public abstract class AsyncGroupByQueryTestBase<TFixture> : QueryTestBase<TFixture> where TFixture : NorthwindQueryFixtureBase<NoopModelCustomizer>, new() {
 {
-        protected AsyncGroupByQueryTestBase(TFixture fixture);

-        protected NorthwindContext CreateContext();

-        public virtual Task Double_GroupBy_with_aggregate();

-        public virtual Task GroupBy_anonymous_key_without_aggregate();

-        public virtual Task GroupBy_Select_sum_over_unmapped_property();

-        public virtual Task Join_GroupBy_entity_ToList();

-        public virtual Task Select_GroupBy();

-        public virtual Task Select_GroupBy_All();

-        public virtual Task Select_GroupBy_SelectMany();

-        public virtual Task Select_nested_collection_with_groupby();

-    }
-    public class AsyncQueryMethodProvider : IQueryMethodProvider {
 {
-        public AsyncQueryMethodProvider();

-        public virtual MethodInfo DefaultIfEmptyShapedQueryMethod { get; }

-        public virtual MethodInfo FastQueryMethod { get; }

-        public virtual MethodInfo GetResultMethod { get; }

-        public virtual MethodInfo GroupByMethod { get; }

-        public virtual MethodInfo GroupJoinMethod { get; }

-        public virtual MethodInfo InjectParametersMethod { get; }

-        public virtual MethodInfo QueryMethod { get; }

-        public virtual MethodInfo ShapedQueryMethod { get; }

-    }
     public abstract class ChangeTrackingTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryFixtureBase<NoopModelCustomizer>, new() {
+        public virtual void Precedence_of_tracking_modifiers();
+        public virtual void Precedence_of_tracking_modifiers2();
+        public virtual void Precedence_of_tracking_modifiers3();
+        public virtual void Precedence_of_tracking_modifiers4();
+        public virtual void Precedence_of_tracking_modifiers5();
-        public virtual void Precendence_of_tracking_modifiers();

-        public virtual void Precendence_of_tracking_modifiers2();

-        public virtual void Precendence_of_tracking_modifiers3();

-        public virtual void Precendence_of_tracking_modifiers4();

-        public virtual void Precendence_of_tracking_modifiers5();

     }
+    public class CollectionInitializingExpression : Expression, IPrintableExpression {
+        public CollectionInitializingExpression(int collectionId, Expression parent, Expression parentIdentifier, Expression outerIdentifier, INavigation navigation, Type type);
+        public virtual int CollectionId { get; }
+        public virtual INavigation Navigation { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public virtual Expression OuterIdentifier { get; }
+        public virtual Expression Parent { get; }
+        public virtual Expression ParentIdentifier { get; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
+    public class CollectionPopulatingExpression : Expression, IPrintableExpression {
+        public CollectionPopulatingExpression(RelationalCollectionShaperExpression parent, Type type, bool include);
+        public virtual bool IsInclude { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public virtual RelationalCollectionShaperExpression Parent { get; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
+    public class CollectionShaperExpression : Expression, IPrintableExpression {
+        public CollectionShaperExpression(Expression projection, Expression innerShaper, INavigation navigation, Type elementType);
+        public virtual Type ElementType { get; }
+        public virtual Expression InnerShaper { get; }
+        public virtual INavigation Navigation { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public virtual Expression Projection { get; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        public virtual CollectionShaperExpression Update(Expression projection, Expression innerShaper);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
     public sealed class CompiledQueryCacheKeyGeneratorDependencies {
+        public CompiledQueryCacheKeyGeneratorDependencies(IModel model, ICurrentDbContext currentContext);
-        public CompiledQueryCacheKeyGeneratorDependencies(IModel model, ICurrentDbContext currentContext);

-        public ICurrentDbContext Context { get; }

+        public ICurrentDbContext CurrentContext { get; }
+        public CompiledQueryCacheKeyGeneratorDependencies With(ICurrentDbContext currentContext);
-        public CompiledQueryCacheKeyGeneratorDependencies With(ICurrentDbContext currentContext);

     }
     public abstract class ComplexNavigationsQueryRelationalFixtureBase : ComplexNavigationsQueryFixtureBase {
-        public override DbContextOptionsBuilder AddOptions(DbContextOptionsBuilder builder);

     }
     public abstract class ComplexNavigationsQueryTestBase<TFixture> : QueryTestBase<TFixture> where TFixture : ComplexNavigationsQueryFixtureBase, new() {
-        public virtual void Data_reader_is_closed_correct_number_of_times_for_include_queries_on_optional_navigations();

+        public virtual void GroupJoin_with_navigations_in_the_result_selector();
+        public virtual Task Include1(bool isAsync);
+        public virtual Task Include10(bool isAsync);
+        public virtual Task Include11(bool isAsync);
+        public virtual Task Include12(bool isAsync);
+        public virtual Task Include13(bool isAsync);
+        public virtual Task Include14(bool isAsync);
+        public virtual void Include15();
+        public virtual void Include16();
+        public virtual void Include17();
+        public virtual void Include18();
+        public virtual Task Include18_1(bool isAsync);
+        public virtual Task Include18_1_1(bool isAsync);
+        public virtual Task Include18_2(bool isAsync);
+        public virtual void Include18_3();
+        public virtual void Include18_3_1();
+        public virtual void Include18_3_2();
+        public virtual Task Include18_3_3(bool isAsync);
+        public virtual void Include18_4();
+        public virtual void Include19();
+        public virtual Task Include2(bool isAsync);
+        public virtual Task Include3(bool isAsync);
+        public virtual Task Include4(bool isAsync);
+        public virtual Task Include5(bool isAsync);
+        public virtual Task Include6(bool isAsync);
+        public virtual Task Include7(bool isAsync);
+        public virtual Task Include8(bool isAsync);
+        public virtual Task Include9(bool isAsync);
+        public virtual void IncludeCollection1();
+        public virtual void IncludeCollection2();
+        public virtual void IncludeCollection3();
+        public virtual void IncludeCollection4();
+        public virtual void IncludeCollection5();
+        public virtual void IncludeCollection6();
+        public virtual void IncludeCollection6_1();
+        public virtual void IncludeCollection6_2();
+        public virtual void IncludeCollection6_3();
+        public virtual void IncludeCollection6_4();
+        public virtual void IncludeCollection7();
+        public virtual void IncludeCollection8();
+        public virtual Task Include_multiple_collections_on_same_level(bool isAsync);
+        public virtual void Include_with_all_method_include_gets_ignored();
-        public virtual Task Join_navigations_in_inner_selector_translated_to_multiple_subquery_without_collision(bool isAsync);

+        public virtual Task Join_navigations_in_inner_selector_translated_without_collision(bool isAsync);
+        public virtual Task Join_navigation_deeply_nested_non_key_join(bool isAsync);
+        public virtual Task Join_navigation_deeply_nested_required(bool isAsync);
+        public virtual Task Join_navigation_in_inner_selector(bool isAsync);
-        public virtual Task Join_navigation_in_inner_selector_translated_to_subquery(bool isAsync);

+        public virtual Task Join_navigation_nested(bool isAsync);
+        public virtual Task Join_navigation_nested2(bool isAsync);
+        public virtual Task Join_navigation_non_key_join(bool isAsync);
+        public virtual Task Join_navigation_self_ref(bool isAsync);
-        public virtual Task Join_navigation_translated_to_subquery_deeply_nested_non_key_join(bool isAsync);

-        public virtual Task Join_navigation_translated_to_subquery_deeply_nested_required(bool isAsync);

-        public virtual Task Join_navigation_translated_to_subquery_nested(bool isAsync);

-        public virtual Task Join_navigation_translated_to_subquery_nested2(bool isAsync);

-        public virtual Task Join_navigation_translated_to_subquery_non_key_join(bool isAsync);

-        public virtual Task Join_navigation_translated_to_subquery_self_ref(bool isAsync);

+        public virtual Task Join_with_navigations_in_the_result_selector1(bool isAsync);
+        public virtual void Join_with_navigations_in_the_result_selector2();
+        public virtual Task Join_with_orderby_on_inner_sequence_navigation_non_key_join(bool isAsync);
-        public virtual Task Join_with_orderby_on_inner_sequence_navigation_translated_to_subquery_non_key_join(bool isAsync);

+        public virtual void Member_pushdown_chain_3_levels_deep();
+        public virtual void Member_pushdown_with_collection_navigation_in_the_middle();
+        public virtual Task Member_pushdown_with_multiple_collections(bool isAsync);
-        public virtual void Multi_level_include_reads_key_values_from_data_reader_rather_than_incorrect_reader_deep_into_the_stack();

+        public virtual Task Null_check_different_structure_does_not_remove_null_checks(bool isAsync);
+        public virtual Task Null_check_removal_applied_recursively(bool isAsync);
+        public virtual Task Project_collection_navigation_nested_with_take(bool isAsync);
+        public virtual Task Result_operator_nav_prop_reference_optional_Average_without_selector(bool isAsync);
+        public virtual Task Result_operator_nav_prop_reference_optional_Average_with_identity_selector(bool isAsync);
     }
     public abstract class ComplexNavigationsWeakQueryFixtureBase : ComplexNavigationsQueryFixtureBase {
+        protected virtual void Configure(OwnedNavigationBuilder<Level1, Level2> l2);
+        protected virtual void Configure(OwnedNavigationBuilder<Level2, Level3> l3);
+        protected virtual void Configure(OwnedNavigationBuilder<Level3, Level4> l4);
-        protected virtual void Configure(ReferenceOwnershipBuilder<Level1, Level2> l2);

-        protected virtual void Configure(ReferenceOwnershipBuilder<Level2, Level3> l3);

-        protected virtual void Configure(ReferenceOwnershipBuilder<Level3, Level4> l4);

     }
     public abstract class ComplexNavigationsWeakQueryRelationalFixtureBase : ComplexNavigationsWeakQueryFixtureBase {
-        public override DbContextOptionsBuilder AddOptions(DbContextOptionsBuilder builder);

+        protected override void Configure(OwnedNavigationBuilder<Level1, Level2> l2);
+        protected override void Configure(OwnedNavigationBuilder<Level2, Level3> l3);
+        protected override void Configure(OwnedNavigationBuilder<Level3, Level4> l4);
-        protected override void Configure(ReferenceOwnershipBuilder<Level1, Level2> l2);

-        protected override void Configure(ReferenceOwnershipBuilder<Level2, Level3> l3);

-        protected override void Configure(ReferenceOwnershipBuilder<Level3, Level4> l4);

     }
     public abstract class ComplexNavigationsWeakQueryTestBase<TFixture> : ComplexNavigationsQueryTestBase<TFixture> where TFixture : ComplexNavigationsWeakQueryFixtureBase, new() {
+        public override Task Include8(bool isAsync);
+        public override Task Include9(bool isAsync);
+        public override Task Include_collection_with_multiple_orderbys_complex(bool isAsync);
+        public override Task Include_collection_with_multiple_orderbys_complex_repeated(bool isAsync);
+        public override Task Include_collection_with_multiple_orderbys_member(bool isAsync);
+        public override Task Include_collection_with_multiple_orderbys_methodcall(bool isAsync);
+        public override Task Include_collection_with_multiple_orderbys_property(bool isAsync);
+        public override Task Join_navigation_self_ref(bool isAsync);
-        public override Task Join_navigation_translated_to_subquery_self_ref(bool isAsync);

+        public override void Join_with_navigations_in_the_result_selector2();
+        public override void Member_pushdown_chain_3_levels_deep();
+        public override void Member_pushdown_with_collection_navigation_in_the_middle();
-        public override void Multi_level_include_reads_key_values_from_data_reader_rather_than_incorrect_reader_deep_into_the_stack();

     }
-    public readonly struct EntityLoadInfo {
 {
-        public EntityLoadInfo(in MaterializationContext materializationContext, Func<MaterializationContext, object> materializer, Dictionary<Type, int[]> typeIndexMap = null);

-        public EntityLoadInfo(ValueBuffer valueBuffer, Func<ValueBuffer, object> materializer, Dictionary<Type, int[]> typeIndexMap = null);

-        public ValueBuffer ValueBuffer { get; }

-        public ValueBuffer ForType(Type clrType);

-        public object Materialize();

-    }
+    public class EntityMaterializerSource : IEntityMaterializerSource {
+        public static readonly MethodInfo TryReadValueMethod;
+        public EntityMaterializerSource(EntityMaterializerSourceDependencies dependencies);
+        public virtual Expression CreateMaterializeExpression(IEntityType entityType, string entityInstanceName, Expression materializationContextExpression);
+        public virtual Expression CreateReadValueExpression(Expression valueBufferExpression, Type type, int index, IPropertyBase property);
+        public virtual Func<MaterializationContext, object> GetMaterializer(IEntityType entityType);
+    }
+    public sealed class EntityMaterializerSourceDependencies {
+        public EntityMaterializerSourceDependencies();
+    }
+    public class EntityProjectionExpression : Expression {
+        public EntityProjectionExpression(IEntityType entityType, TableExpressionBase innerTable, bool nullable);
+        public EntityProjectionExpression(IEntityType entityType, IDictionary<IProperty, ColumnExpression> propertyExpressions);
+        public virtual IEntityType EntityType { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public override Type Type { get; }
+        public virtual void AddNavigationBinding(INavigation navigation, EntityShaperExpression entityShaper);
+        public virtual EntityShaperExpression BindNavigation(INavigation navigation);
+        public virtual ColumnExpression BindProperty(IProperty property);
+        public virtual EntityProjectionExpression MakeNullable();
+        public virtual EntityProjectionExpression UpdateEntityType(IEntityType derivedType);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
-    public abstract class EntityQueryModelVisitor : QueryModelVisitorBase {
 {
-        public static readonly ParameterExpression QueryContextParameter;

-        protected EntityQueryModelVisitor(EntityQueryModelVisitorDependencies dependencies, QueryCompilationContext queryCompilationContext);

-        public virtual ParameterExpression CurrentParameter { get; set; }

-        public virtual Expression Expression { get; set; }

-        public virtual ILinqOperatorProvider LinqOperatorProvider { get; private set; }

-        public virtual QueryCompilationContext QueryCompilationContext { get; }

-        public virtual void BindMemberExpression(MemberExpression memberExpression, Action<IProperty, IQuerySource> memberBinder);

-        public virtual TResult BindMemberExpression<TResult>(MemberExpression memberExpression, IQuerySource querySource, Func<IProperty, IQuerySource, TResult> memberBinder);

-        public virtual Expression BindMemberToValueBuffer(MemberExpression memberExpression, Expression expression);

-        public virtual void BindMethodCallExpression(MethodCallExpression methodCallExpression, Action<IProperty, IQuerySource> methodCallBinder);

-        public virtual TResult BindMethodCallExpression<TResult>(MethodCallExpression methodCallExpression, IQuerySource querySource, Func<IProperty, IQuerySource, TResult> methodCallBinder);

-        public virtual TResult BindMethodCallExpression<TResult>(MethodCallExpression methodCallExpression, Func<IProperty, IQuerySource, TResult> methodCallBinder);

-        public virtual Expression BindMethodCallToEntity(MethodCallExpression methodCallExpression, MethodCallExpression targetMethodCallExpression);

-        public virtual Expression BindMethodCallToValueBuffer(MethodCallExpression methodCallExpression, Expression expression);

-        public virtual TResult BindNavigationPathPropertyExpression<TResult>(Expression propertyExpression, Func<IReadOnlyList<IPropertyBase>, IQuerySource, TResult> propertyBinder);

-        public virtual Expression BindReadValueMethod(Type memberType, Expression expression, int index, IProperty property = null);

-        protected virtual Expression CallCreateTransparentIdentifier(Type transparentIdentifierType, Expression outerExpression, Expression innerExpression);

-        protected virtual bool CanOptimizeCorrelatedCollections();

-        protected virtual Expression CompileAdditionalFromClauseExpression(AdditionalFromClause additionalFromClause, QueryModel queryModel);

-        protected virtual Expression CompileGroupJoinInnerSequenceExpression(GroupJoinClause groupJoinClause, QueryModel queryModel);

-        protected virtual Expression CompileJoinClauseInnerSequenceExpression(JoinClause joinClause, QueryModel queryModel);

-        protected virtual Expression CompileMainFromClauseExpression(MainFromClause mainFromClause, QueryModel queryModel);

-        public virtual Func<QueryContext, IAsyncEnumerable<TResult>> CreateAsyncQueryExecutor<TResult>(QueryModel queryModel);

-        protected virtual Func<QueryContext, TResults> CreateExecutorLambda<TResults>();

-        public virtual Func<QueryContext, IEnumerable<TResult>> CreateQueryExecutor<TResult>(QueryModel queryModel);

-        protected virtual Type CreateTransparentIdentifierType(Type outerType, Type innerType);

-        protected virtual void ExtractQueryAnnotations(QueryModel queryModel);

-        protected virtual void InterceptExceptions();

-        protected virtual void IntroduceTransparentScope(IQuerySource querySource, QueryModel queryModel, int index, Type transparentIdentifierType);

-        protected virtual void OnBeforeNavigationRewrite(QueryModel queryModel);

-        protected virtual void OptimizeQueryModel(QueryModel queryModel, bool asyncQuery);

-        protected virtual void RemoveOrderings(QueryModel queryModel);

-        public virtual Expression ReplaceClauseReferences(Expression expression, IQuerySource querySource = null, bool inProjection = false);

-        protected virtual void RewriteProjectedCollectionNavigationsToIncludes(QueryModel queryModel);

-        public virtual bool ShouldApplyDefiningQuery(IEntityType entityType, IQuerySource querySource);

-        protected virtual void SingleResultToSequence(QueryModel queryModel, Type type = null);

-        protected virtual void TrackEntitiesInResults<TResult>(QueryModel queryModel);

-        public override void VisitAdditionalFromClause(AdditionalFromClause fromClause, QueryModel queryModel, int index);

-        public override void VisitGroupJoinClause(GroupJoinClause groupJoinClause, QueryModel queryModel, int index);

-        public override void VisitJoinClause(JoinClause joinClause, QueryModel queryModel, int index);

-        public override void VisitMainFromClause(MainFromClause fromClause, QueryModel queryModel);

-        public override void VisitOrdering(Ordering ordering, QueryModel queryModel, OrderByClause orderByClause, int index);

-        public override void VisitQueryModel(QueryModel queryModel);

-        public override void VisitResultOperator(ResultOperatorBase resultOperator, QueryModel queryModel, int index);

-        public override void VisitSelectClause(SelectClause selectClause, QueryModel queryModel);

-        public override void VisitWhereClause(WhereClause whereClause, QueryModel queryModel, int index);

-    }
-    public sealed class EntityQueryModelVisitorDependencies {
 {
-        public EntityQueryModelVisitorDependencies(IQueryOptimizer queryOptimizer, INavigationRewritingExpressionVisitorFactory navigationRewritingExpressionVisitorFactory, IQuerySourceTracingExpressionVisitorFactory querySourceTracingExpressionVisitorFactory, IEntityResultFindingExpressionVisitorFactory entityResultFindingExpressionVisitorFactory, IEagerLoadingExpressionVisitorFactory eagerLoadingExpressionVisitorFactory, ITaskBlockingExpressionVisitor taskBlockingExpressionVisitor, IMemberAccessBindingExpressionVisitorFactory memberAccessBindingExpressionVisitorFactory, IProjectionExpressionVisitorFactory projectionExpressionVisitorFactory, IEntityQueryableExpressionVisitorFactory entityQueryableExpressionVisitorFactory, IQueryAnnotationExtractor queryAnnotationExtractor, IResultOperatorHandler resultOperatorHandler, IEntityMaterializerSource entityMaterializerSource, IExpressionPrinter expressionPrinter, IQueryModelGenerator queryModelGenerator);

-        public IEagerLoadingExpressionVisitorFactory EagerLoadingExpressionVisitorFactory { get; }

-        public IEntityMaterializerSource EntityMaterializerSource { get; }

-        public IEntityQueryableExpressionVisitorFactory EntityQueryableExpressionVisitorFactory { get; }

-        public IEntityResultFindingExpressionVisitorFactory EntityResultFindingExpressionVisitorFactory { get; }

-        public IExpressionPrinter ExpressionPrinter { get; }

-        public IMemberAccessBindingExpressionVisitorFactory MemberAccessBindingExpressionVisitorFactory { get; }

-        public INavigationRewritingExpressionVisitorFactory NavigationRewritingExpressionVisitorFactory { get; }

-        public IProjectionExpressionVisitorFactory ProjectionExpressionVisitorFactory { get; }

-        public IQueryAnnotationExtractor QueryAnnotationExtractor { get; }

-        public IQueryModelGenerator QueryModelGenerator { get; }

-        public IQueryOptimizer QueryOptimizer { get; }

-        public IQuerySourceTracingExpressionVisitorFactory QuerySourceTracingExpressionVisitorFactory { get; }

-        public IResultOperatorHandler ResultOperatorHandler { get; }

-        public ITaskBlockingExpressionVisitor TaskBlockingExpressionVisitor { get; }

-        public EntityQueryModelVisitorDependencies With(IEntityMaterializerSource entityMaterializerSource);

-        public EntityQueryModelVisitorDependencies With(IEntityQueryableExpressionVisitorFactory entityQueryableExpressionVisitorFactory);

-        public EntityQueryModelVisitorDependencies With(IEagerLoadingExpressionVisitorFactory eagerLoadingExpressionVisitorFactory);

-        public EntityQueryModelVisitorDependencies With(IEntityResultFindingExpressionVisitorFactory entityResultFindingExpressionVisitorFactory);

-        public EntityQueryModelVisitorDependencies With(IMemberAccessBindingExpressionVisitorFactory memberAccessBindingExpressionVisitorFactory);

-        public EntityQueryModelVisitorDependencies With(INavigationRewritingExpressionVisitorFactory navigationRewritingExpressionVisitorFactory);

-        public EntityQueryModelVisitorDependencies With(IQuerySourceTracingExpressionVisitorFactory querySourceTracingExpressionVisitorFactory);

-        public EntityQueryModelVisitorDependencies With(ITaskBlockingExpressionVisitor taskBlockingExpressionVisitor);

-        public EntityQueryModelVisitorDependencies With(IProjectionExpressionVisitorFactory projectionExpressionVisitorFactory);

-        public EntityQueryModelVisitorDependencies With(IExpressionPrinter expressionPrinter);

-        public EntityQueryModelVisitorDependencies With(IQueryAnnotationExtractor queryAnnotationExtractor);

-        public EntityQueryModelVisitorDependencies With(IQueryModelGenerator queryModelGenerator);

-        public EntityQueryModelVisitorDependencies With(IQueryOptimizer queryOptimizer);

-        public EntityQueryModelVisitorDependencies With(IResultOperatorHandler resultOperatorHandler);

-    }
-    public abstract class EntityQueryModelVisitorFactory : IEntityQueryModelVisitorFactory {
 {
-        protected EntityQueryModelVisitorFactory(EntityQueryModelVisitorDependencies dependencies);

-        protected virtual EntityQueryModelVisitorDependencies Dependencies { get; }

-        public abstract EntityQueryModelVisitor Create(QueryCompilationContext queryCompilationContext, EntityQueryModelVisitor parentEntityQueryModelVisitor);

-    }
+    public class EntityShaperExpression : Expression, IPrintableExpression {
+        public EntityShaperExpression(IEntityType entityType, Expression valueBufferExpression, bool nullable);
+        public virtual IEntityType EntityType { get; }
+        public virtual bool IsNullable { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public override Type Type { get; }
+        public virtual Expression ValueBufferExpression { get; }
+        public virtual EntityShaperExpression MarkAsNullable();
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        public virtual EntityShaperExpression Update(Expression valueBufferExpression);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+        public virtual EntityShaperExpression WithEntityType(IEntityType entityType);
+    }
+    public class EvaluatableExpressionFilter : IEvaluatableExpressionFilter {
+        public EvaluatableExpressionFilter(EvaluatableExpressionFilterDependencies dependencies);
+        protected virtual EvaluatableExpressionFilterDependencies Dependencies { get; }
+        public virtual bool IsEvaluatableExpression(Expression expression, IModel model);
+    }
+    public sealed class EvaluatableExpressionFilterDependencies {
+        public EvaluatableExpressionFilterDependencies();
+    }
+    public static class ExpressionExtensions {
+        public static RelationalTypeMapping InferTypeMapping(params SqlExpression[] expressions);
+    }
+    public class ExpressionPrinter : ExpressionVisitor {
+        public ExpressionPrinter();
+        public virtual ExpressionPrinter Append(object o);
+        public virtual ExpressionPrinter AppendLine();
+        public virtual ExpressionVisitor AppendLine(object o);
+        public virtual ExpressionPrinter AppendLines(object o, bool skipFinalNewline = false);
+        public virtual string GenerateBinaryOperator(ExpressionType expressionType);
+        public virtual IDisposable Indent();
+        protected virtual string PostProcess(string printedExpression);
+        public virtual string Print(Expression expression, Nullable<int> characterLimit = default(Nullable<int>));
+        protected virtual string PrintCore(Expression expression, Nullable<int> characterLimit, bool generateUniqueParameterIds);
+        public virtual string PrintDebug(Expression expression, Nullable<int> characterLimit = default(Nullable<int>), bool generateUniqueParameterIds = true);
+        public override Expression Visit(Expression expression);
+        protected override Expression VisitBinary(BinaryExpression binaryExpression);
+        protected override Expression VisitBlock(BlockExpression blockExpression);
+        protected override Expression VisitConditional(ConditionalExpression conditionalExpression);
+        protected override Expression VisitConstant(ConstantExpression constantExpression);
+        protected override Expression VisitDefault(DefaultExpression defaultExpression);
+        protected override Expression VisitExtension(Expression extensionExpression);
+        protected override Expression VisitGoto(GotoExpression gotoExpression);
+        protected override Expression VisitIndex(IndexExpression indexExpression);
+        protected override Expression VisitLabel(LabelExpression labelExpression);
+        protected override Expression VisitLambda<T>(Expression<T> lambdaExpression);
+        public virtual void VisitList<T>(IReadOnlyList<T> items, Action<ExpressionPrinter> joinAction = null) where T : Expression;
+        protected override Expression VisitMember(MemberExpression memberExpression);
+        protected override Expression VisitMemberInit(MemberInitExpression memberInitExpression);
+        protected override Expression VisitMethodCall(MethodCallExpression methodCallExpression);
+        protected override Expression VisitNew(NewExpression newExpression);
+        protected override Expression VisitNewArray(NewArrayExpression newArrayExpression);
+        protected override Expression VisitParameter(ParameterExpression parameterExpression);
+        protected override Expression VisitTry(TryExpression tryExpression);
+        protected override Expression VisitTypeBinary(TypeBinaryExpression typeBinaryExpression);
+        protected override Expression VisitUnary(UnaryExpression unaryExpression);
+    }
     public abstract class FiltersTestBase<TFixture> : IClassFixture<TFixture>, IDisposable where TFixture : NorthwindQueryFixtureBase<NorthwindFiltersCustomizer>, new() {
+        public virtual void Project_reference_that_itself_has_query_filter_with_another_reference();
     }
     public abstract class FromSqlQueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryRelationalFixture<NoopModelCustomizer>, new() {
+        public virtual void Entity_equality_through_fromsql();
+        public virtual void FromSqlInterpolated_parameterization_issue_12213();
+        public virtual void FromSqlInterpolated_queryable_multiple_composed_with_parameters_and_closure_parameters_interpolated();
+        public virtual void FromSqlInterpolated_queryable_with_parameters_inline_interpolated();
+        public virtual void FromSqlInterpolated_queryable_with_parameters_interpolated();
+        public virtual void FromSqlInterpolated_with_inlined_db_parameter();
+        public virtual void FromSqlInterpolated_with_inlined_db_parameter_without_name_prefix();
+        public virtual void FromSqlRaw_annotations_do_not_affect_successive_calls();
+        public virtual void FromSqlRaw_composed_contains();
+        public virtual void FromSqlRaw_composed_contains2();
+        public virtual void FromSqlRaw_composed_with_nullable_predicate();
+        public virtual void FromSqlRaw_does_not_parameterize_interpolated_string();
+        public virtual void FromSqlRaw_queryable_composed();
+        public virtual void FromSqlRaw_queryable_composed_after_removing_whitespaces();
+        public virtual void FromSqlRaw_queryable_composed_compiled();
+        public virtual void FromSqlRaw_queryable_composed_compiled_with_DbParameter();
+        public virtual void FromSqlRaw_queryable_composed_compiled_with_nameless_DbParameter();
+        public virtual void FromSqlRaw_queryable_composed_compiled_with_parameter();
+        public virtual void FromSqlRaw_queryable_composed_multiple_line_query();
+        public virtual void FromSqlRaw_queryable_multiple_composed();
+        public virtual void FromSqlRaw_queryable_multiple_composed_with_closure_parameters();
+        public virtual void FromSqlRaw_queryable_multiple_composed_with_parameters_and_closure_parameters();
+        public virtual void FromSqlRaw_queryable_multiple_line_query();
+        public virtual void FromSqlRaw_queryable_simple();
+        public virtual void FromSqlRaw_queryable_simple_as_no_tracking_not_composed();
+        public virtual void FromSqlRaw_queryable_simple_cache_key_includes_query_string();
+        public virtual void FromSqlRaw_queryable_simple_columns_out_of_order();
+        public virtual void FromSqlRaw_queryable_simple_columns_out_of_order_and_extra_columns();
+        public virtual void FromSqlRaw_queryable_simple_columns_out_of_order_and_not_enough_columns_throws();
+        public virtual void FromSqlRaw_queryable_simple_composed_include();
+        public virtual void FromSqlRaw_queryable_simple_include();
+        public virtual void FromSqlRaw_queryable_simple_projection_composed();
+        public virtual void FromSqlRaw_queryable_with_null_parameter();
+        public virtual void FromSqlRaw_queryable_with_parameters();
+        public virtual void FromSqlRaw_queryable_with_parameters_and_closure();
+        public virtual void FromSqlRaw_queryable_with_parameters_cache_key_includes_parameters();
+        public virtual void FromSqlRaw_queryable_with_parameters_inline();
+        public virtual void FromSqlRaw_with_dbParameter();
+        public virtual void FromSqlRaw_with_dbParameter_mixed();
+        public virtual void FromSqlRaw_with_dbParameter_without_name_prefix();
+        public virtual void FromSqlRaw_with_db_parameters_called_multiple_times();
+        public virtual void FromSqlRaw_with_join_and_include();
+        public virtual void FromSqlRaw_with_SelectMany_and_include();
-        public virtual void From_sql_annotations_do_not_affect_successive_calls();

-        public virtual void From_sql_composed_contains();

-        public virtual void From_sql_composed_contains2();

-        public virtual void From_sql_composed_with_nullable_predicate();

-        public virtual void From_sql_queryable_composed();

-        public virtual void From_sql_queryable_composed_after_removing_whitespaces();

-        public virtual void From_sql_queryable_composed_compiled();

-        public virtual void From_sql_queryable_composed_multiple_line_query();

-        public virtual void From_sql_queryable_multiple_composed();

-        public virtual void From_sql_queryable_multiple_composed_with_closure_parameters();

-        public virtual void From_sql_queryable_multiple_composed_with_parameters_and_closure_parameters();

-        public virtual void From_sql_queryable_multiple_composed_with_parameters_and_closure_parameters_interpolated();

-        public virtual void From_sql_queryable_multiple_line_query();

-        public virtual void From_sql_queryable_simple();

-        public virtual void From_sql_queryable_simple_as_no_tracking_not_composed();

-        public virtual void From_sql_queryable_simple_cache_key_includes_query_string();

-        public virtual void From_sql_queryable_simple_columns_out_of_order();

-        public virtual void From_sql_queryable_simple_columns_out_of_order_and_extra_columns();

-        public virtual void From_sql_queryable_simple_columns_out_of_order_and_not_enough_columns_throws();

-        public virtual void From_sql_queryable_simple_composed_include();

-        public virtual void From_sql_queryable_simple_include();

-        public virtual void From_sql_queryable_simple_projection_composed();

-        public virtual void From_sql_queryable_with_null_parameter();

-        public virtual void From_sql_queryable_with_parameters();

-        public virtual void From_sql_queryable_with_parameters_and_closure();

-        public virtual void From_sql_queryable_with_parameters_cache_key_includes_parameters();

-        public virtual void From_sql_queryable_with_parameters_inline();

-        public virtual void From_sql_queryable_with_parameters_inline_interpolated();

-        public virtual void From_sql_queryable_with_parameters_interpolated();

-        public virtual void From_sql_with_dbParameter();

-        public virtual void From_sql_with_dbParameter_mixed();

-        public virtual void From_sql_with_db_parameters_called_multiple_times();

-        public virtual void From_sql_with_inlined_db_parameter();

-        public virtual void From_sql_with_join_and_include();

-        public virtual void From_sql_with_SelectMany_and_include();

+        protected FormattableString NormalizeDelimetersInInterpolatedString(FormattableString sql);
+        protected string NormalizeDelimetersInRawString(string sql);
     }
     public abstract class FromSqlSprocQueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryRelationalFixture<NoopModelCustomizer>, new() {
-        public virtual void From_sql_queryable_select_and_stored_procedure();

+        public virtual Task<Exception> From_sql_queryable_select_and_stored_procedure(bool async);
+        public virtual Task From_sql_queryable_select_and_stored_procedure_on_client(bool async);
-        public virtual void From_sql_queryable_stored_procedure();

+        public virtual Task From_sql_queryable_stored_procedure(bool async);
-        public virtual void From_sql_queryable_stored_procedure_and_select();

+        public virtual Task<Exception> From_sql_queryable_stored_procedure_and_select(bool async);
+        public virtual Task From_sql_queryable_stored_procedure_and_select_on_client(bool async);
-        public virtual void From_sql_queryable_stored_procedure_composed();

+        public virtual Task<Exception> From_sql_queryable_stored_procedure_composed(bool async);
+        public virtual Task From_sql_queryable_stored_procedure_composed_on_client(bool async);
-        public virtual void From_sql_queryable_stored_procedure_min();

+        public virtual Task<Exception> From_sql_queryable_stored_procedure_min(bool async);
+        public virtual Task From_sql_queryable_stored_procedure_min_on_client(bool async);
-        public virtual void From_sql_queryable_stored_procedure_projection();

+        public virtual Task From_sql_queryable_stored_procedure_projection(bool async);
-        public virtual void From_sql_queryable_stored_procedure_reprojection();

+        public virtual Task<Exception> From_sql_queryable_stored_procedure_re_projection(bool async);
+        public virtual Task From_sql_queryable_stored_procedure_re_projection_on_client(bool async);
-        public virtual void From_sql_queryable_stored_procedure_take();

+        public virtual Task<Exception> From_sql_queryable_stored_procedure_take(bool async);
+        public virtual Task From_sql_queryable_stored_procedure_take_on_client(bool async);
-        public virtual void From_sql_queryable_stored_procedure_with_include_throws();

+        public virtual Task<Exception> From_sql_queryable_stored_procedure_with_include_throws(bool async);
-        public virtual void From_sql_queryable_stored_procedure_with_parameter();

+        public virtual Task From_sql_queryable_stored_procedure_with_parameter(bool async);
-        public virtual void From_sql_queryable_stored_procedure_with_parameter_composed();

+        public virtual Task<Exception> From_sql_queryable_stored_procedure_with_parameter_composed(bool async);
+        public virtual Task From_sql_queryable_stored_procedure_with_parameter_composed_on_client(bool async);
-        public virtual void From_sql_queryable_with_multiple_stored_procedures();

+        public virtual Task<Exception> From_sql_queryable_with_multiple_stored_procedures(bool async);
+        public virtual Task From_sql_queryable_with_multiple_stored_procedures_on_client(bool async);
     }
     public abstract class GearsOfWarQueryRelationalFixture : GearsOfWarQueryFixtureBase {
-        public override DbContextOptionsBuilder AddOptions(DbContextOptionsBuilder builder);

     }
     public abstract class GearsOfWarQueryTestBase<TFixture> : QueryTestBase<TFixture> where TFixture : GearsOfWarQueryFixtureBase, new() {
+        public virtual Task Anonymous_projection_take_followed_by_projecting_single_element_from_collection_navigation(bool isAsync);
+        public virtual Task Bool_projection_from_subquery_treated_appropriately_in_where(bool isAsync);
-        public TEntity Client<TEntity>(TEntity entity);
+        public static TEntity Client<TEntity>(TEntity entity);
+        public virtual Task DateTimeOffset_Contains_Less_than_Greater_than(bool isAsync);
-        public virtual Task Filter_with_compex_predicate_containig_subquery(bool isAsync);

+        public virtual Task Filter_with_complex_predicate_containing_subquery(bool isAsync);
+        public virtual Task Filter_with_new_Guid(bool isAsync);
+        public virtual Task Filter_with_new_Guid_closure(bool isAsync);
+        public virtual void Include_multiple_include_then_include();
-        public virtual Task Include_multiple_include_then_include(bool isAsync);

+        public virtual void Include_multiple_one_to_one_and_one_to_many_self_reference();
-        public virtual Task Include_multiple_one_to_one_and_one_to_many_self_reference(bool isAsync);

+        public virtual void Include_multiple_one_to_one_and_one_to_one_and_one_to_many();
-        public virtual Task Include_multiple_one_to_one_and_one_to_one_and_one_to_many(bool isAsync);

+        public virtual void Include_with_client_method_and_member_access_still_applies_includes();
+        public virtual void Include_with_complex_order_by();
+        public virtual void Include_with_projection_of_unmapped_property_still_gets_applied();
+        public virtual Task Join_with_order_by_without_skip_or_take(bool isAsync);
+        public virtual Task Multiple_includes_with_client_method_around_entity_and_also_projecting_included_collection();
-        public virtual Task Multiple_includes_with_client_method_around_qsre_and_also_projecting_included_collection();

+        public virtual Task Multiple_orderby_with_navigation_expansion_on_one_of_the_order_bys(bool isAsync);
+        public virtual Task Multiple_orderby_with_navigation_expansion_on_one_of_the_order_bys_inside_subquery(bool isAsync);
+        public virtual Task Multiple_orderby_with_navigation_expansion_on_one_of_the_order_bys_inside_subquery_complex_orderings(bool isAsync);
+        public virtual Task Multiple_orderby_with_navigation_expansion_on_one_of_the_order_bys_inside_subquery_duplicated_orderings(bool isAsync);
+        public virtual Task Navigation_inside_interpolated_string_expanded(bool isAsync);
+        public virtual void Nav_rewrite_Distinct_with_convert();
+        public virtual void Nav_rewrite_Distinct_with_convert_anonymous();
+        public virtual void Nav_rewrite_with_convert1();
+        public virtual void Nav_rewrite_with_convert2();
+        public virtual void Nav_rewrite_with_convert3();
+        public virtual Task Null_semantics_is_correctly_applied_for_function_comparisons_that_take_arguments_from_optional_navigation(bool isAsync);
+        public virtual Task Null_semantics_is_correctly_applied_for_function_comparisons_that_take_arguments_from_optional_navigation_complex(bool isAsync);
+        public virtual Task Null_semantics_on_nullable_bool_from_inner_join_subquery_is_fully_applied(bool isAsync);
-        public virtual Task Null_semantics_on_nullable_bool_from_inner_join_subuery_is_fully_applied(bool isAsync);

+        public virtual Task Null_semantics_on_nullable_bool_from_left_join_subquery_is_fully_applied(bool isAsync);
-        public virtual Task Null_semantics_on_nullable_bool_from_left_join_subuery_is_fully_applied(bool isAsync);

+        public virtual void OfTypeNav1();
+        public virtual void OfTypeNav2();
+        public virtual void OfTypeNav3();
-        public virtual void Order_by_is_properly_lifted_from_subquery_created_by_include();

-        public virtual void Order_by_then_by_is_properly_lifted_from_subquery_created_by_include();

+        public virtual void Project_derivied_entity_with_convert_to_parent();
+        public virtual Task Query_with_complex_let_containing_ordering_and_filter_projecting_firstOrDefault_element_of_let(bool isAsync);
-        public virtual Task Query_with_complex_let_containing_ordering_and_filter_projecting_firstOrDefefault_element_of_let(bool isAsync);

+        public virtual Task Select_required_navigation_on_the_same_type_with_cast(bool isAsync);
+        public virtual Task Select_subquery_boolean_empty_with_pushdown_without_convert_to_nullable1(bool isAsync);
+        public virtual Task Select_subquery_boolean_empty_with_pushdown_without_convert_to_nullable2(bool isAsync);
+        public virtual Task Select_subquery_int_with_pushdown_and_coalesce2(bool isAsync);
+        public virtual Task Skip_with_orderby_followed_by_orderBy_is_pushed_down(bool isAsync);
+        public virtual Task Subquery_is_lifted_from_additional_from_clause(bool isAsync);
-        public virtual Task Subquery_is_not_lifted_from_additional_from_clause(bool isAsync);

+        public virtual Task Take_without_orderby_followed_by_orderBy_is_pushed_down1(bool isAsync);
+        public virtual Task Take_without_orderby_followed_by_orderBy_is_pushed_down2(bool isAsync);
+        public virtual Task Take_without_orderby_followed_by_orderBy_is_pushed_down3(bool isAsync);
-        public virtual Task Where_and_order_by_are_properly_lifted_from_subquery_created_by_tracking(bool isAsync);

+        public virtual Task Where_contains_on_navigation_with_composite_keys(bool isAsync);
+        public virtual void Where_datetimeoffset_milliseconds_parameter_and_constant();
     }
     public abstract class GroupByQueryTestBase<TFixture> : QueryTestBase<TFixture> where TFixture : NorthwindQueryFixtureBase<NoopModelCustomizer>, new() {
-        public virtual Task AllAny_after_GroupBy_aggregate(bool isAsync);

+        public virtual Task All_after_GroupBy_aggregate(bool isAsync);
+        public virtual Task All_after_GroupBy_aggregate2(bool isAsync);
+        public virtual Task Any_after_GroupBy_aggregate(bool isAsync);
-        public virtual void Double_GroupBy_with_aggregate();

+        public virtual Task Double_GroupBy_with_aggregate(bool isAsync);
+        public virtual Task GroupBy_anonymous_key_type_mismatch_with_aggregate(bool isAsync);
-        public virtual void GroupBy_anonymous_key_without_aggregate();

+        public virtual Task GroupBy_anonymous_key_without_aggregate(bool isAsync);
+        public virtual Task GroupBy_Property_Select_Average_with_navigation_expansion(bool isAsync);
+        public virtual Task GroupBy_Property_Select_Key_with_constant(bool isAsync);
-        public virtual void GroupBy_Select_sum_over_unmapped_property();

+        public virtual Task GroupBy_Select_sum_over_unmapped_property(bool isAsync);
-        public virtual void Join_GroupBy_entity_ToList();

+        public virtual Task Join_GroupBy_entity_ToList(bool isAsync);
-        public virtual void Select_GroupBy();

+        public virtual Task Select_GroupBy(bool isAsync);
-        public virtual void Select_GroupBy_All();

+        public virtual Task Select_GroupBy_All(bool isAsync);
-        public virtual void Select_GroupBy_SelectMany();

+        public virtual Task Select_GroupBy_SelectMany(bool isAsync);
-        public virtual void Select_nested_collection_with_groupby();

+        public virtual Task Select_nested_collection_with_groupby(bool isAsync);
     }
+    public class GroupByShaperExpression : Expression, IPrintableExpression {
+        public GroupByShaperExpression(Expression keySelector, Expression elementSelector);
+        public virtual Expression ElementSelector { get; }
+        public virtual Expression KeySelector { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        public virtual GroupByShaperExpression Update(Expression keySelector, Expression elementSelector);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
+    public interface IEntityMaterializerSource {
+        Expression CreateMaterializeExpression(IEntityType entityType, string entityInstanceName, Expression materializationExpression);
+        Expression CreateReadValueExpression(Expression valueBuffer, Type type, int index, IPropertyBase property);
+        Func<MaterializationContext, object> GetMaterializer(IEntityType entityType);
+    }
-    public interface IEntityQueryModelVisitorFactory {
 {
-        EntityQueryModelVisitor Create(QueryCompilationContext queryCompilationContext, EntityQueryModelVisitor parentEntityQueryModelVisitor);

-    }
+    public interface IEvaluatableExpressionFilter {
+        bool IsEvaluatableExpression(Expression expression, IModel model);
+    }
+    public interface IMemberTranslator {
+        SqlExpression Translate(SqlExpression instance, MemberInfo member, Type returnType);
+    }
+    public interface IMemberTranslatorPlugin {
+        IEnumerable<IMemberTranslator> Translators { get; }
+    }
+    public interface IMemberTranslatorProvider {
+        SqlExpression Translate(SqlExpression instance, MemberInfo member, Type returnType);
+    }
+    public interface IMethodCallTranslator {
+        SqlExpression Translate(SqlExpression instance, MethodInfo method, IReadOnlyList<SqlExpression> arguments);
+    }
+    public interface IMethodCallTranslatorPlugin {
+        IEnumerable<IMethodCallTranslator> Translators { get; }
+    }
+    public interface IMethodCallTranslatorProvider {
+        SqlExpression Translate(IModel model, SqlExpression instance, MethodInfo method, IReadOnlyList<SqlExpression> arguments);
+    }
+    public class IncludeExpression : Expression, IPrintableExpression {
+        public IncludeExpression(Expression entityExpression, Expression navigationExpression, INavigation navigation);
+        public virtual Expression EntityExpression { get; set; }
+        public virtual INavigation Navigation { get; set; }
+        public virtual Expression NavigationExpression { get; set; }
+        public sealed override ExpressionType NodeType { get; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        public virtual IncludeExpression Update(Expression entityExpression, Expression navigationExpression);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
-    public class IncludeSpecification {
 {
-        public IncludeSpecification(IQuerySource querySource, IReadOnlyList<INavigation> navigationPath);

-        public virtual bool IsEnumerableTarget { get; set; }

-        public virtual IReadOnlyList<INavigation> NavigationPath { get; }

-        public virtual IQuerySource QuerySource { get; }

-        public override string ToString();

-    }
     public abstract class InheritanceRelationalFixture : InheritanceFixtureBase {
-        public override DbContextOptionsBuilder AddOptions(DbContextOptionsBuilder builder);

     }
     public abstract class InheritanceRelationshipsQueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : InheritanceRelationshipsQueryFixtureBase, new() {
-        public virtual void Include_self_refence_with_inheritence();

-        public virtual void Include_self_refence_with_inheritence_reverse();

+        public virtual void Include_self_reference_with_inheritance();
+        public virtual void Include_self_reference_with_inheritance_reverse();
     }
     public abstract class InheritanceTestBase<TFixture> : IClassFixture<TFixture> where TFixture : InheritanceFixtureBase, new() {
+        protected virtual bool EnforcesFkConstraints { get; }
-        public virtual void Can_concat_kiwis_and_eagles_as_birds();

-        public virtual void Can_except_kiwis_and_eagles_as_birds();

-        public virtual void Can_intersect_kiwis_and_eagles_as_birds();

-        public virtual void Can_union_kiwis_and_eagles_as_birds();

+        public virtual void Can_use_backwards_is_animal();
+        public virtual void Can_use_backwards_of_type_animal();
+        public virtual void OfType_Union_OfType();
+        public virtual void OfType_Union_subquery();
+        public virtual void Subquery_OfType();
+        public virtual void Union_entity_equality();
+        public virtual void Union_siblings_with_duplicate_property_in_subquery();
     }
+    public interface IParameterValues {
+        IReadOnlyDictionary<string, object> ParameterValues { get; }
+        void AddParameter(string name, object value);
+    }
+    public interface IPrintableExpression {
+        void Print(ExpressionPrinter expressionPrinter);
+    }
+    public interface IQueryableMethodTranslatingExpressionVisitorFactory {
+        QueryableMethodTranslatingExpressionVisitor Create(IModel model);
+    }
-    public interface IQueryMethodProvider {
 {
-        MethodInfo DefaultIfEmptyShapedQueryMethod { get; }

-        MethodInfo FastQueryMethod { get; }

-        MethodInfo GetResultMethod { get; }

-        MethodInfo GroupByMethod { get; }

-        MethodInfo GroupJoinMethod { get; }

-        MethodInfo InjectParametersMethod { get; }

-        MethodInfo QueryMethod { get; }

-        MethodInfo ShapedQueryMethod { get; }

-    }
+    public interface IQuerySqlGeneratorFactory {
+        QuerySqlGenerator Create();
+    }
+    public interface IQueryTranslationPostprocessorFactory {
+        QueryTranslationPostprocessor Create(QueryCompilationContext queryCompilationContext);
+    }
+    public interface IQueryTranslationPreprocessorFactory {
+        QueryTranslationPreprocessor Create(QueryCompilationContext queryCompilationContext);
+    }
-    public interface IRelationalResultOperatorHandler : IResultOperatorHandler

+    public interface IRelationalSqlTranslatingExpressionVisitorFactory {
+        RelationalSqlTranslatingExpressionVisitor Create(IModel model, QueryableMethodTranslatingExpressionVisitor queryableMethodTranslatingExpressionVisitor);
+    }
-    public interface IResultOperatorHandler {
 {
-        Expression HandleResultOperator(EntityQueryModelVisitor entityQueryModelVisitor, ResultOperatorBase resultOperator, QueryModel queryModel);

-    }
+    public interface IShapedQueryCompilingExpressionVisitorFactory {
+        ShapedQueryCompilingExpressionVisitor Create(QueryCompilationContext queryCompilationContext);
+    }
+    public interface ISqlExpressionFactory {
+        SqlBinaryExpression Add(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        SqlBinaryExpression And(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        SqlBinaryExpression AndAlso(SqlExpression left, SqlExpression right);
+        SqlExpression ApplyDefaultTypeMapping(SqlExpression sqlExpression);
+        SqlExpression ApplyTypeMapping(SqlExpression sqlExpression, RelationalTypeMapping typeMapping);
+        CaseExpression Case(SqlExpression operand, params CaseWhenClause[] whenClauses);
+        CaseExpression Case(IReadOnlyList<CaseWhenClause> whenClauses, SqlExpression elseResult);
+        SqlBinaryExpression Coalesce(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        SqlConstantExpression Constant(object value, RelationalTypeMapping typeMapping = null);
+        SqlUnaryExpression Convert(SqlExpression operand, Type type, RelationalTypeMapping typeMapping = null);
+        SqlBinaryExpression Divide(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        SqlBinaryExpression Equal(SqlExpression left, SqlExpression right);
+        ExistsExpression Exists(SelectExpression subquery, bool negated);
+        RelationalTypeMapping FindMapping(Type type);
+        SqlFragmentExpression Fragment(string sql);
+        SqlFunctionExpression Function(SqlExpression instance, string name, IEnumerable<SqlExpression> arguments, Type returnType, RelationalTypeMapping typeMapping = null);
+        SqlFunctionExpression Function(SqlExpression instance, string name, Type returnType, RelationalTypeMapping typeMapping = null);
+        SqlFunctionExpression Function(string name, IEnumerable<SqlExpression> arguments, Type returnType, RelationalTypeMapping typeMapping = null);
+        SqlFunctionExpression Function(string schema, string name, IEnumerable<SqlExpression> arguments, Type returnType, RelationalTypeMapping typeMapping = null);
+        SqlFunctionExpression Function(string schema, string name, Type returnType, RelationalTypeMapping typeMapping = null);
+        SqlFunctionExpression Function(string name, Type returnType, RelationalTypeMapping typeMapping = null);
+        RelationalTypeMapping GetTypeMappingForValue(object value);
+        SqlBinaryExpression GreaterThan(SqlExpression left, SqlExpression right);
+        SqlBinaryExpression GreaterThanOrEqual(SqlExpression left, SqlExpression right);
+        InExpression In(SqlExpression item, SelectExpression subquery, bool negated);
+        InExpression In(SqlExpression item, SqlExpression values, bool negated);
+        SqlUnaryExpression IsNotNull(SqlExpression operand);
+        SqlUnaryExpression IsNull(SqlExpression operand);
+        SqlBinaryExpression LessThan(SqlExpression left, SqlExpression right);
+        SqlBinaryExpression LessThanOrEqual(SqlExpression left, SqlExpression right);
+        LikeExpression Like(SqlExpression match, SqlExpression pattern, SqlExpression escapeChar = null);
+        SqlBinaryExpression MakeBinary(ExpressionType operatorType, SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping);
+        SqlUnaryExpression MakeUnary(ExpressionType operatorType, SqlExpression operand, Type type, RelationalTypeMapping typeMapping = null);
+        SqlBinaryExpression Modulo(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        SqlBinaryExpression Multiply(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        SqlUnaryExpression Negate(SqlExpression operand);
+        SqlUnaryExpression Not(SqlExpression operand);
+        SqlBinaryExpression NotEqual(SqlExpression left, SqlExpression right);
+        SqlBinaryExpression Or(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        SqlBinaryExpression OrElse(SqlExpression left, SqlExpression right);
+        SelectExpression Select(IEntityType entityType);
+        SelectExpression Select(IEntityType entityType, string sql, Expression sqlArguments);
+        SelectExpression Select(SqlExpression projection);
+        SqlBinaryExpression Subtract(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+    }
+    public class MaterializeCollectionNavigationExpression : Expression, IPrintableExpression {
+        public MaterializeCollectionNavigationExpression(Expression subquery, INavigation navigation);
+        public virtual INavigation Navigation { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public virtual Expression Subquery { get; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        public virtual MaterializeCollectionNavigationExpression Update(Expression subquery);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
     public abstract class NorthwindQueryFixtureBase<TModelCustomizer> : SharedStoreFixtureBase<NorthwindContext>, IQueryFixtureBase where TModelCustomizer : IModelCustomizer, new() {
+        protected override Task SeedAsync(NorthwindContext context);
     }
+    public class NullConditionalExpression : Expression, IPrintableExpression {
+        public NullConditionalExpression(Expression caller, Expression accessOperation);
+        public virtual Expression AccessOperation { get; }
+        public virtual Expression Caller { get; }
+        public override bool CanReduce { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public override Type Type { get; }
+        protected virtual bool Equals(NullConditionalExpression other);
+        public override bool Equals(object obj);
+        public override int GetHashCode();
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        public override Expression Reduce();
+        public override string ToString();
+        public virtual Expression Update(Expression newCaller, Expression newAccessOperation);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
     public abstract class NullSemanticsQueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NullSemanticsQueryRelationalFixture, new() {
+        public virtual void Contains_with_local_nullable_array_closure_negated();
+        protected static TResult Maybe<TResult>(object caller, Func<TResult> expression) where TResult : class;
+        protected static TResult? MaybeScalar<TResult>(object caller, Func<TResult?> expression) where TResult : struct;
+        public virtual void Null_comparison_in_join_key_with_relational_nulls();
+        public virtual void Null_comparison_in_order_by_with_relational_nulls();
+        public virtual void Null_comparison_in_selector_with_relational_nulls();
+        public virtual void Null_semantics_applied_when_comparing_function_with_nullable_argument_to_a_nullable_column();
+        public virtual void Null_semantics_applied_when_comparing_two_functions_with_multiple_nullable_arguments();
+        public virtual void Null_semantics_applied_when_comparing_two_functions_with_nullable_arguments();
+        public virtual void Null_semantics_coalesce();
+        public virtual void Null_semantics_conditional();
+        public virtual void Null_semantics_contains();
+        public virtual void Null_semantics_function();
+        public virtual void Null_semantics_join_with_composite_key();
     }
     public abstract class OwnedQueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : OwnedQueryTestBase<TFixture>.OwnedQueryFixtureBase, new() {
+        public virtual void Filter_owned_entity_chained_with_regular_entity_followed_by_projecting_owned_collection();
+        public virtual void Navigation_rewrite_on_owned_collection_with_composition();
+        public virtual void Navigation_rewrite_on_owned_collection_with_composition_complex();
-        public virtual void Navigation_rewrite_on_owned_reference();

+        public virtual void Navigation_rewrite_on_owned_reference_followed_by_regular_entity_filter();
+        public virtual void Navigation_rewrite_on_owned_reference_projecting_entity();
+        public virtual void Navigation_rewrite_on_owned_reference_projecting_scalar();
+        public virtual void Project_multiple_owned_navigations();
+        public virtual void Project_multiple_owned_navigations_with_expansion_on_owned_collections();
+        public virtual void Query_loads_reference_nav_automatically_in_projection();
+        public virtual void SelectMany_on_owned_collection();
-        public virtual void Select_many_on_owned_collection();

+        public virtual void Set_throws_for_owned_type();
+        public virtual void Throw_for_owned_entities_without_owner_in_tracking_query();
+        protected class Barton {
+            public Barton();
+            public int Id { get; set; }
+            public string Simple { get; set; }
+            public OwnedQueryTestBase<TFixture>.Throned Throned { get; set; }
+        }
+        protected class Fink {
+            public Fink();
+            public OwnedQueryTestBase<TFixture>.Barton Barton { get; set; }
+            public int Id { get; set; }
+        }
+        protected class Throned {
+            public Throned();
+            public string Property { get; set; }
+        }
     }
+    public class ProjectionBindingExpression : Expression, IPrintableExpression {
+        public ProjectionBindingExpression(Expression queryExpression, ProjectionMember projectionMember, Type type);
+        public ProjectionBindingExpression(Expression queryExpression, IDictionary<IProperty, int> indexMap);
+        public ProjectionBindingExpression(Expression queryExpression, int index, Type type);
+        public virtual Nullable<int> Index { get; }
+        public virtual IDictionary<IProperty, int> IndexMap { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public virtual ProjectionMember ProjectionMember { get; }
+        public virtual Expression QueryExpression { get; }
+        public override Type Type { get; }
+        public override bool Equals(object obj);
+        public override int GetHashCode();
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
+    public class ProjectionMember {
+        public ProjectionMember();
+        public virtual MemberInfo Last { get; }
+        public virtual ProjectionMember Append(MemberInfo member);
+        public override bool Equals(object obj);
+        public override int GetHashCode();
+        public virtual ProjectionMember Prepend(MemberInfo member);
+        public override string ToString();
+    }
+    public static class QueryableMethods {
+        public static MethodInfo All { get; }
+        public static MethodInfo AnyWithoutPredicate { get; }
+        public static MethodInfo AnyWithPredicate { get; }
+        public static MethodInfo AsQueryable { get; }
+        public static MethodInfo Cast { get; }
+        public static MethodInfo Concat { get; }
+        public static MethodInfo Contains { get; }
+        public static MethodInfo CountWithoutPredicate { get; }
+        public static MethodInfo CountWithPredicate { get; }
+        public static MethodInfo DefaultIfEmptyWithArgument { get; }
+        public static MethodInfo DefaultIfEmptyWithoutArgument { get; }
+        public static MethodInfo Distinct { get; }
+        public static MethodInfo ElementAt { get; }
+        public static MethodInfo ElementAtOrDefault { get; }
+        public static MethodInfo Except { get; }
+        public static MethodInfo FirstOrDefaultWithoutPredicate { get; }
+        public static MethodInfo FirstOrDefaultWithPredicate { get; }
+        public static MethodInfo FirstWithoutPredicate { get; }
+        public static MethodInfo FirstWithPredicate { get; }
+        public static MethodInfo GroupByWithKeyElementResultSelector { get; }
+        public static MethodInfo GroupByWithKeyElementSelector { get; }
+        public static MethodInfo GroupByWithKeyResultSelector { get; }
+        public static MethodInfo GroupByWithKeySelector { get; }
+        public static MethodInfo GroupJoin { get; }
+        public static MethodInfo Intersect { get; }
+        public static MethodInfo Join { get; }
+        public static MethodInfo LastOrDefaultWithoutPredicate { get; }
+        public static MethodInfo LastOrDefaultWithPredicate { get; }
+        public static MethodInfo LastWithoutPredicate { get; }
+        public static MethodInfo LastWithPredicate { get; }
+        public static MethodInfo LongCountWithoutPredicate { get; }
+        public static MethodInfo LongCountWithPredicate { get; }
+        public static MethodInfo MaxWithoutSelector { get; }
+        public static MethodInfo MaxWithSelector { get; }
+        public static MethodInfo MinWithoutSelector { get; }
+        public static MethodInfo MinWithSelector { get; }
+        public static MethodInfo OfType { get; }
+        public static MethodInfo OrderBy { get; }
+        public static MethodInfo OrderByDescending { get; }
+        public static MethodInfo Reverse { get; }
+        public static MethodInfo Select { get; }
+        public static MethodInfo SelectManyWithCollectionSelector { get; }
+        public static MethodInfo SelectManyWithoutCollectionSelector { get; }
+        public static MethodInfo SingleOrDefaultWithoutPredicate { get; }
+        public static MethodInfo SingleOrDefaultWithPredicate { get; }
+        public static MethodInfo SingleWithoutPredicate { get; }
+        public static MethodInfo SingleWithPredicate { get; }
+        public static MethodInfo Skip { get; }
+        public static MethodInfo SkipWhile { get; }
+        public static MethodInfo Take { get; }
+        public static MethodInfo TakeWhile { get; }
+        public static MethodInfo ThenBy { get; }
+        public static MethodInfo ThenByDescending { get; }
+        public static MethodInfo Union { get; }
+        public static MethodInfo Where { get; }
+        public static MethodInfo GetAverageWithoutSelector(Type type);
+        public static MethodInfo GetAverageWithSelector(Type type);
+        public static MethodInfo GetSumWithoutSelector(Type type);
+        public static MethodInfo GetSumWithSelector(Type type);
+        public static bool IsAverageWithoutSelector(MethodInfo methodInfo);
+        public static bool IsAverageWithSelector(MethodInfo methodInfo);
+        public static bool IsSumWithoutSelector(MethodInfo methodInfo);
+        public static bool IsSumWithSelector(MethodInfo methodInfo);
+    }
+    public abstract class QueryableMethodTranslatingExpressionVisitor : ExpressionVisitor {
+        protected QueryableMethodTranslatingExpressionVisitor(QueryableMethodTranslatingExpressionVisitorDependencies dependencies, bool subquery);
+        protected virtual QueryableMethodTranslatingExpressionVisitorDependencies Dependencies { get; }
+        protected abstract ShapedQueryExpression CreateShapedQueryExpression(Type elementType);
+        protected abstract QueryableMethodTranslatingExpressionVisitor CreateSubqueryVisitor();
+        protected virtual Expression MarkShaperNullable(Expression shaperExpression);
+        protected abstract ShapedQueryExpression TranslateAll(ShapedQueryExpression source, LambdaExpression predicate);
+        protected abstract ShapedQueryExpression TranslateAny(ShapedQueryExpression source, LambdaExpression predicate);
+        protected abstract ShapedQueryExpression TranslateAverage(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected abstract ShapedQueryExpression TranslateCast(ShapedQueryExpression source, Type resultType);
+        protected abstract ShapedQueryExpression TranslateConcat(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected abstract ShapedQueryExpression TranslateContains(ShapedQueryExpression source, Expression item);
+        protected abstract ShapedQueryExpression TranslateCount(ShapedQueryExpression source, LambdaExpression predicate);
+        protected abstract ShapedQueryExpression TranslateDefaultIfEmpty(ShapedQueryExpression source, Expression defaultValue);
+        protected abstract ShapedQueryExpression TranslateDistinct(ShapedQueryExpression source);
+        protected abstract ShapedQueryExpression TranslateElementAtOrDefault(ShapedQueryExpression source, Expression index, bool returnDefault);
+        protected abstract ShapedQueryExpression TranslateExcept(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected abstract ShapedQueryExpression TranslateFirstOrDefault(ShapedQueryExpression source, LambdaExpression predicate, Type returnType, bool returnDefault);
+        protected abstract ShapedQueryExpression TranslateGroupBy(ShapedQueryExpression source, LambdaExpression keySelector, LambdaExpression elementSelector, LambdaExpression resultSelector);
+        protected abstract ShapedQueryExpression TranslateGroupJoin(ShapedQueryExpression outer, ShapedQueryExpression inner, LambdaExpression outerKeySelector, LambdaExpression innerKeySelector, LambdaExpression resultSelector);
+        protected abstract ShapedQueryExpression TranslateIntersect(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected abstract ShapedQueryExpression TranslateJoin(ShapedQueryExpression outer, ShapedQueryExpression inner, LambdaExpression outerKeySelector, LambdaExpression innerKeySelector, LambdaExpression resultSelector);
+        protected abstract ShapedQueryExpression TranslateLastOrDefault(ShapedQueryExpression source, LambdaExpression predicate, Type returnType, bool returnDefault);
+        protected abstract ShapedQueryExpression TranslateLeftJoin(ShapedQueryExpression outer, ShapedQueryExpression inner, LambdaExpression outerKeySelector, LambdaExpression innerKeySelector, LambdaExpression resultSelector);
+        protected abstract ShapedQueryExpression TranslateLongCount(ShapedQueryExpression source, LambdaExpression predicate);
+        protected abstract ShapedQueryExpression TranslateMax(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected abstract ShapedQueryExpression TranslateMin(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected abstract ShapedQueryExpression TranslateOfType(ShapedQueryExpression source, Type resultType);
+        protected abstract ShapedQueryExpression TranslateOrderBy(ShapedQueryExpression source, LambdaExpression keySelector, bool ascending);
+        protected virtual ShapedQueryExpression TranslateResultSelectorForJoin(ShapedQueryExpression outer, LambdaExpression resultSelector, Expression innerShaper, Type transparentIdentifierType);
+        protected abstract ShapedQueryExpression TranslateReverse(ShapedQueryExpression source);
+        protected abstract ShapedQueryExpression TranslateSelect(ShapedQueryExpression source, LambdaExpression selector);
+        protected abstract ShapedQueryExpression TranslateSelectMany(ShapedQueryExpression source, LambdaExpression selector);
+        protected abstract ShapedQueryExpression TranslateSelectMany(ShapedQueryExpression source, LambdaExpression collectionSelector, LambdaExpression resultSelector);
+        protected abstract ShapedQueryExpression TranslateSingleOrDefault(ShapedQueryExpression source, LambdaExpression predicate, Type returnType, bool returnDefault);
+        protected abstract ShapedQueryExpression TranslateSkip(ShapedQueryExpression source, Expression count);
+        protected abstract ShapedQueryExpression TranslateSkipWhile(ShapedQueryExpression source, LambdaExpression predicate);
+        public virtual ShapedQueryExpression TranslateSubquery(Expression expression);
+        protected abstract ShapedQueryExpression TranslateSum(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected abstract ShapedQueryExpression TranslateTake(ShapedQueryExpression source, Expression count);
+        protected abstract ShapedQueryExpression TranslateTakeWhile(ShapedQueryExpression source, LambdaExpression predicate);
+        protected abstract ShapedQueryExpression TranslateThenBy(ShapedQueryExpression source, LambdaExpression keySelector, bool ascending);
+        protected abstract ShapedQueryExpression TranslateUnion(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected abstract ShapedQueryExpression TranslateWhere(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override Expression VisitConstant(ConstantExpression constantExpression);
+        protected override Expression VisitExtension(Expression expression);
+        protected override Expression VisitMethodCall(MethodCallExpression methodCallExpression);
+    }
+    public sealed class QueryableMethodTranslatingExpressionVisitorDependencies {
+        public QueryableMethodTranslatingExpressionVisitorDependencies();
+    }
     public class QueryCompilationContext {
+        public static readonly ParameterExpression QueryContextParameter;
-        public QueryCompilationContext(QueryCompilationContextDependencies dependencies, ILinqOperatorProvider linqOperatorProvider, bool trackQueryResults);

+        public QueryCompilationContext(QueryCompilationContextDependencies dependencies, bool async);
+        public virtual IDbContextOptions ContextOptions { get; }
+        public virtual bool IsAsync { get; }
-        public virtual bool IsAsyncQuery { get; set; }

-        public virtual bool IsIncludeQuery { get; }

-        public virtual bool IsQueryBufferRequired { get; private set; }

+        public virtual bool IsTracking { get; internal set; }
-        public virtual bool IsTrackingQuery { get; }

-        public virtual ILinqOperatorProvider LinqOperatorProvider { get; }

-        public virtual IReadOnlyCollection<IQueryAnnotation> QueryAnnotations { get; }

-        public virtual QuerySourceMapping QuerySourceMapping { get; }

+        public virtual ISet<string> Tags { get; }
-        public virtual bool TrackQueryResults { get; }

-        public virtual void AddAnnotations(IEnumerable<IQueryAnnotation> annotations);

-        public virtual void AddOrUpdateMapping(IQuerySource querySource, IEntityType entityType);

-        public virtual void AddOrUpdateMapping(IQuerySource querySource, Expression expression);

-        public virtual void AddQuerySourceRequiringMaterialization(IQuerySource querySource);

+        public virtual void AddTag(string tag);
-        public virtual void AddTrackableInclude(IQuerySource querySource, IReadOnlyList<INavigation> navigationPath);

-        public virtual void CloneAnnotations(QuerySourceMapping querySourceMapping, QueryModel queryModel);

+        public virtual Func<QueryContext, TResult> CreateQueryExecutor<TResult>(Expression query);
-        public virtual EntityQueryModelVisitor CreateQueryModelVisitor();

-        public virtual EntityQueryModelVisitor CreateQueryModelVisitor(EntityQueryModelVisitor parentEntityQueryModelVisitor);

-        public virtual void DetermineQueryBufferRequirement(QueryModel queryModel);

-        public virtual IEntityType FindEntityType(IQuerySource querySource);

-        public virtual void FindQuerySourcesRequiringMaterialization(EntityQueryModelVisitor queryModelVisitor, QueryModel queryModel);

-        public virtual IReadOnlyList<IReadOnlyList<INavigation>> GetTrackableIncludes(IQuerySource querySource);

-        public virtual bool QuerySourceRequiresMaterialization(IQuerySource querySource);

-        public virtual void RegisterCorrelatedSubqueryMetadata(MainFromClause mainFromClause, bool trackingQuery, INavigation firstNavigation, INavigation collectionNavigation, IQuerySource parentQuerySource);

+        public virtual ParameterExpression RegisterRuntimeParameter(string name, LambdaExpression valueExtractor);
-        public virtual bool TryGetCorrelatedSubqueryMetadata(MainFromClause mainFromClause, out CorrelatedSubqueryMetadata correlatedSubqueryMetadata);

-        public virtual void UpdateMapping(QuerySourceMapping querySourceMapping);

     }
+    public sealed class QueryCompilationContextDependencies {
+        public QueryCompilationContextDependencies(IModel model, IQueryTranslationPreprocessorFactory queryTranslationPreprocessorFactory, IQueryableMethodTranslatingExpressionVisitorFactory queryableMethodTranslatingExpressionVisitorFactory, IQueryTranslationPostprocessorFactory queryTranslationPostprocessorFactory, IShapedQueryCompilingExpressionVisitorFactory shapedQueryCompilingExpressionVisitorFactory, ICurrentDbContext currentContext, IDbContextOptions contextOptions, IDiagnosticsLogger<DbLoggerCategory.Query> logger);
+        public IDbContextOptions ContextOptions { get; }
+        public ICurrentDbContext CurrentContext { get; }
+        public IDiagnosticsLogger<DbLoggerCategory.Query> Logger { get; }
+        public IModel Model { get; }
+        public IQueryableMethodTranslatingExpressionVisitorFactory QueryableMethodTranslatingExpressionVisitorFactory { get; }
+        public IQueryTranslationPostprocessorFactory QueryTranslationPostprocessorFactory { get; }
+        public IQueryTranslationPreprocessorFactory QueryTranslationPreprocessorFactory { get; }
+        public IShapedQueryCompilingExpressionVisitorFactory ShapedQueryCompilingExpressionVisitorFactory { get; }
+        public QueryCompilationContextDependencies With(IDiagnosticsLogger<DbLoggerCategory.Query> logger);
+        public QueryCompilationContextDependencies With(ICurrentDbContext currentContext);
+        public QueryCompilationContextDependencies With(IDbContextOptions contextOptions);
+        public QueryCompilationContextDependencies With(IModel model);
+        public QueryCompilationContextDependencies With(IQueryableMethodTranslatingExpressionVisitorFactory queryableMethodTranslatingExpressionVisitorFactory);
+        public QueryCompilationContextDependencies With(IQueryTranslationPostprocessorFactory queryTranslationPostprocessorFactory);
+        public QueryCompilationContextDependencies With(IQueryTranslationPreprocessorFactory queryTranslationPreprocessorFactory);
+        public QueryCompilationContextDependencies With(IShapedQueryCompilingExpressionVisitorFactory shapedQueryCompilingExpressionVisitorFactory);
+    }
-    public class QueryContext : IDisposable, IParameterValues {
+    public abstract class QueryContext : IParameterValues {
+        protected QueryContext(QueryContextDependencies dependencies);
-        public QueryContext(QueryContextDependencies dependencies, Func<IQueryBuffer> queryBufferFactory);

+        public virtual IDiagnosticsLogger<DbLoggerCategory.Database.Command> CommandLogger { get; }
-        public virtual IQueryBuffer QueryBuffer { get; }

+        public virtual IDiagnosticsLogger<DbLoggerCategory.Query> QueryLogger { get; }
-        public virtual void BeginTrackingQuery();

-        public virtual void Dispose();

-        public virtual object RemoveParameter(string name);

+        public virtual void SetNavigationIsLoaded(object entity, INavigation navigation);
-        public virtual void SetParameter(string name, object value);

+        public virtual InternalEntityEntry StartTracking(IEntityType entityType, object entity, ValueBuffer valueBuffer);
-        public virtual void StartTracking(object entity, EntityTrackingInfo entityTrackingInfo);

     }
     public sealed class QueryContextDependencies {
+        public QueryContextDependencies(ICurrentDbContext currentContext, IConcurrencyDetector concurrencyDetector, IDiagnosticsLogger<DbLoggerCategory.Database.Command> commandLogger, IDiagnosticsLogger<DbLoggerCategory.Query> queryLogger);
-        public QueryContextDependencies(ICurrentDbContext currentContext, IConcurrencyDetector concurrencyDetector);

-        public IChangeDetector ChangeDetector { get; }

+        public IDiagnosticsLogger<DbLoggerCategory.Database.Command> CommandLogger { get; }
+        public ICurrentDbContext CurrentContext { get; }
-        public ICurrentDbContext CurrentDbContext { get; }

+        public IDiagnosticsLogger<DbLoggerCategory.Query> QueryLogger { get; }
+        public QueryContextDependencies With(IDiagnosticsLogger<DbLoggerCategory.Database.Command> commandLogger);
+        public QueryContextDependencies With(IDiagnosticsLogger<DbLoggerCategory.Query> queryLogger);
+        public QueryContextDependencies With(IConcurrencyDetector concurrencyDetector);
+        public QueryContextDependencies With(ICurrentDbContext currentContext);
-        public QueryContextDependencies With(IConcurrencyDetector concurrencyDetector);

-        public QueryContextDependencies With(ICurrentDbContext currentDbContext);

     }
-    public abstract class QueryContextFactory : IQueryContextFactory {
 {
-        protected QueryContextFactory(QueryContextDependencies dependencies);

-        protected virtual QueryContextDependencies Dependencies { get; }

-        public abstract QueryContext Create();

-        protected virtual IQueryBuffer CreateQueryBuffer();

-    }
     public abstract class QueryFilterFuncletizationRelationalFixture : QueryFilterFuncletizationFixtureBase {
-        public override DbContextOptionsBuilder AddOptions(DbContextOptionsBuilder builder);

     }
-    public class QueryMethodProvider : IQueryMethodProvider {
 {
-        public QueryMethodProvider();

-        public virtual MethodInfo DefaultIfEmptyShapedQueryMethod { get; }

-        public virtual MethodInfo FastQueryMethod { get; }

-        public virtual MethodInfo GetResultMethod { get; }

-        public virtual MethodInfo GroupByMethod { get; }

-        public virtual MethodInfo GroupJoinMethod { get; }

-        public virtual MethodInfo InjectParametersMethod { get; }

-        public virtual MethodInfo QueryMethod { get; }

-        public virtual MethodInfo ShapedQueryMethod { get; }

-    }
     public abstract class QueryNavigationsTestBase<TFixture> : QueryTestBase<TFixture> where TFixture : NorthwindQueryFixtureBase<NoopModelCustomizer>, new() {
+        public virtual Task Select_collection_navigation_simple2(bool isAsync);
     }
+    public class QuerySqlGenerator : SqlExpressionVisitor {
+        public QuerySqlGenerator(QuerySqlGeneratorDependencies dependencies);
+        protected virtual string AliasSeparator { get; }
+        protected virtual QuerySqlGeneratorDependencies Dependencies { get; }
+        protected virtual IRelationalCommandBuilder Sql { get; }
+        protected virtual void GenerateLimitOffset(SelectExpression selectExpression);
+        protected virtual string GenerateOperator(SqlBinaryExpression binaryExpression);
+        protected virtual void GenerateOrderings(SelectExpression selectExpression);
+        protected virtual void GenerateSetOperation(SetOperationBase setOperation);
+        protected virtual void GenerateSetOperationOperand(SetOperationBase setOperation, SelectExpression operand);
+        protected virtual void GenerateTagsHeaderComment(SelectExpression selectExpression);
+        protected virtual void GenerateTop(SelectExpression selectExpression);
+        public virtual IRelationalCommand GetCommand(SelectExpression selectExpression);
+        protected override Expression VisitCase(CaseExpression caseExpression);
+        protected override Expression VisitColumn(ColumnExpression columnExpression);
+        protected override Expression VisitCrossApply(CrossApplyExpression crossApplyExpression);
+        protected override Expression VisitCrossJoin(CrossJoinExpression crossJoinExpression);
+        protected override Expression VisitExcept(ExceptExpression exceptExpression);
+        protected override Expression VisitExists(ExistsExpression existsExpression);
+        protected override Expression VisitFromSql(FromSqlExpression fromSqlExpression);
+        protected override Expression VisitIn(InExpression inExpression);
+        protected override Expression VisitInnerJoin(InnerJoinExpression innerJoinExpression);
+        protected override Expression VisitIntersect(IntersectExpression intersectExpression);
+        protected override Expression VisitLeftJoin(LeftJoinExpression leftJoinExpression);
+        protected override Expression VisitLike(LikeExpression likeExpression);
+        protected override Expression VisitOrdering(OrderingExpression orderingExpression);
+        protected override Expression VisitOuterApply(OuterApplyExpression outerApplyExpression);
+        protected override Expression VisitProjection(ProjectionExpression projectionExpression);
+        protected override Expression VisitRowNumber(RowNumberExpression rowNumberExpression);
+        protected override Expression VisitSelect(SelectExpression selectExpression);
+        protected override Expression VisitSqlBinary(SqlBinaryExpression sqlBinaryExpression);
+        protected override Expression VisitSqlConstant(SqlConstantExpression sqlConstantExpression);
+        protected override Expression VisitSqlFragment(SqlFragmentExpression sqlFragmentExpression);
+        protected override Expression VisitSqlFunction(SqlFunctionExpression sqlFunctionExpression);
+        protected override Expression VisitSqlParameter(SqlParameterExpression sqlParameterExpression);
+        protected override Expression VisitSqlUnary(SqlUnaryExpression sqlUnaryExpression);
+        protected override Expression VisitSubSelect(ScalarSubqueryExpression scalarSubqueryExpression);
+        protected override Expression VisitTable(TableExpression tableExpression);
+        protected override Expression VisitUnion(UnionExpression unionExpression);
+    }
+    public sealed class QuerySqlGeneratorDependencies {
+        public QuerySqlGeneratorDependencies(IRelationalCommandBuilderFactory relationalCommandBuilderFactory, ISqlGenerationHelper sqlGenerationHelper);
+        public IRelationalCommandBuilderFactory RelationalCommandBuilderFactory { get; }
+        public ISqlGenerationHelper SqlGenerationHelper { get; }
+        public QuerySqlGeneratorDependencies With(IRelationalCommandBuilderFactory relationalCommandBuilderFactory);
+        public QuerySqlGeneratorDependencies With(ISqlGenerationHelper sqlGenerationHelper);
+    }
     public abstract class QueryTestBase<TFixture> : IClassFixture<TFixture> where TFixture : class, IQueryFixtureBase, new() {
-        protected virtual Task AssertAll<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate) where TItem1 : class;
+        protected Task AssertAll<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate) where TItem1 : class;
-        protected virtual Task AssertAll<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate) where TItem1 : class;
+        protected Task AssertAll<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate) where TItem1 : class;
-        protected virtual Task AssertAny<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> query) where TItem1 : class where TItem2 : class where TItem3 : class;
+        protected Task AssertAny<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> query) where TItem1 : class where TItem2 : class where TItem3 : class;
-        protected virtual Task AssertAny<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class where TItem3 : class;
+        protected Task AssertAny<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class where TItem3 : class;
-        protected virtual Task AssertAny<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query) where TItem1 : class where TItem2 : class;
+        protected Task AssertAny<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertAny<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class;
+        protected Task AssertAny<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertAny<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate) where TItem1 : class;
+        protected Task AssertAny<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate) where TItem1 : class;
-        protected virtual Task AssertAny<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate) where TItem1 : class;
+        protected Task AssertAny<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate) where TItem1 : class;
-        protected virtual Task AssertAny<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> query) where TItem1 : class;
+        protected Task AssertAny<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> query) where TItem1 : class;
-        protected virtual Task AssertAny<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TResult>> expectedQuery) where TItem1 : class;
+        protected Task AssertAny<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TResult>> expectedQuery) where TItem1 : class;
-        protected virtual Task AssertAny<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query) where TItem1 : class;
+        protected Task AssertAny<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query) where TItem1 : class;
-        protected virtual Task AssertAny<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery) where TItem1 : class;
+        protected Task AssertAny<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, float>> actualSelector, Expression<Func<TSelector, float>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, float>> actualSelector, Expression<Func<TSelector, float>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, float>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, float>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> actualQuery, Func<IQueryable<TItem1>, IQueryable<long>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> actualQuery, Func<IQueryable<TItem1>, IQueryable<long>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertAverage<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int?>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query) where TItem1 : class where TItem2 : class;
+        protected Task AssertCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class;
+        protected Task AssertCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertCount<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate) where TItem1 : class;
+        protected Task AssertCount<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate) where TItem1 : class;
-        protected virtual Task AssertCount<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate) where TItem1 : class;
+        protected Task AssertCount<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate) where TItem1 : class;
-        protected virtual Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> query) where TItem1 : class;
+        protected Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> query) where TItem1 : class;
-        protected virtual Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> actualQuery, Func<IQueryable<TItem1>, IQueryable<bool>> expectedQuery) where TItem1 : class;
+        protected Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> actualQuery, Func<IQueryable<TItem1>, IQueryable<bool>> expectedQuery) where TItem1 : class;
-        protected virtual Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query) where TItem1 : class;
+        protected Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query) where TItem1 : class;
-        protected virtual Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery) where TItem1 : class;
+        protected Task AssertCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery) where TItem1 : class;
-        protected virtual Task AssertFirst<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirst<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertFirst<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirst<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertFirst<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirst<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertFirst<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirst<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class where TItem3 : class;
+        protected Task AssertFirstOrDefault<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class where TItem3 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class where TItem3 : class;
+        protected Task AssertFirstOrDefault<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class where TItem3 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
+        protected Task AssertFirstOrDefault<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
+        protected Task AssertFirstOrDefault<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirstOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirstOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirstOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertFirstOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertFirstOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        public Task<List<object>> AssertIncludeQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class where TItem2 : class;

+        public Task<List<object>> AssertIncludeQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task<List<object>> AssertIncludeQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class where TItem2 : class;

+        public Task<List<object>> AssertIncludeQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task<List<object>> AssertIncludeQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class;

+        public Task<List<object>> AssertIncludeQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        public Task<List<object>> AssertIncludeQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class;

+        public Task<List<object>> AssertIncludeQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, List<IExpectedInclude> expectedIncludes, dynamic elementSorter = null, dynamic clientProjections = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected virtual Task AssertLast<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLast<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLast<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLast<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLast<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLast<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLast<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLast<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLastOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLastOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLastOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLastOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLastOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLastOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLastOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertLastOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertLongCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query) where TItem1 : class where TItem2 : class;
+        protected Task AssertLongCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertLongCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class;
+        protected Task AssertLongCount<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertLongCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query) where TItem1 : class;
+        protected Task AssertLongCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query) where TItem1 : class;
-        protected virtual Task AssertLongCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery) where TItem1 : class;
+        protected Task AssertLongCount<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> actualQuery, Func<IQueryable<TItem1>, IQueryable<long>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> actualQuery, Func<IQueryable<TItem1>, IQueryable<long>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMax<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> actualQuery, Func<IQueryable<TItem1>, IQueryable<long>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> actualQuery, Func<IQueryable<TItem1>, IQueryable<long>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertMin<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        public Task AssertQuery<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> expectedQuery, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class where TItem2 : class where TItem3 : class;

+        public Task AssertQuery<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> expectedQuery, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class where TItem2 : class where TItem3 : class;
-        public Task AssertQuery<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> query, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class where TItem2 : class where TItem3 : class;

+        public Task AssertQuery<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<object>> query, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class where TItem2 : class where TItem3 : class;
-        public Task AssertQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class where TItem2 : class;

+        public Task AssertQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class where TItem2 : class;

+        public Task AssertQuery<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class;

+        public Task AssertQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        public Task AssertQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0) where TItem1 : class;

+        public Task AssertQuery<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, dynamic elementSorter = null, dynamic elementAsserter = null, bool assertOrder = false, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1, TItem2, TItem3, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<TResult>> expectedQuery, bool assertOrder = false) where TItem1 : class where TItem2 : class where TItem3 : class where TResult : struct;

+        public Task AssertQueryScalar<TItem1, TItem2, TItem3, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<TResult>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class where TItem3 : class where TResult : struct;
-        public Task AssertQueryScalar<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<int>> query, bool assertOrder = false) where TItem1 : class where TItem2 : class where TItem3 : class;

+        public Task AssertQueryScalar<TItem1, TItem2, TItem3>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TItem3>, IQueryable<int>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class where TItem3 : class;
-        public Task AssertQueryScalar<TItem1, TItem2, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult?>> expectedQuery, bool assertOrder = false) where TItem1 : class where TItem2 : class where TResult : struct;

+        public Task AssertQueryScalar<TItem1, TItem2, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult?>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class where TResult : struct;
-        public Task AssertQueryScalar<TItem1, TItem2, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult>> expectedQuery, bool assertOrder = false) where TItem1 : class where TItem2 : class where TResult : struct;

+        public Task AssertQueryScalar<TItem1, TItem2, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TResult>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class where TResult : struct;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<bool>> query, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<bool>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<bool>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<bool>> expectedQuery, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<bool>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<bool>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<DateTime>> query, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<DateTime>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<DateTime>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<DateTime>> expectedQuery, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<DateTime>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<DateTime>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int>> query, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int>> expectedQuery, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int?>> query, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int?>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int?>> expectedQuery, bool assertOrder = false) where TItem1 : class where TItem2 : class;

+        public Task AssertQueryScalar<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<int?>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TItem2 : class;
-        public Task AssertQueryScalar<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TResult?>> expectedQuery, bool assertOrder = false) where TItem1 : class where TResult : struct;

+        public Task AssertQueryScalar<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TResult?>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TResult : struct;
-        public Task AssertQueryScalar<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> query, bool assertOrder = false) where TItem1 : class where TResult : struct;

+        public Task AssertQueryScalar<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TResult : struct;
-        public Task AssertQueryScalar<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TResult>> expectedQuery, bool assertOrder = false) where TItem1 : class where TResult : struct;

+        public Task AssertQueryScalar<TItem1, TResult>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TResult>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TResult>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class where TResult : struct;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> actualQuery, Func<IQueryable<TItem1>, IQueryable<bool>> expectedQuery, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool>> actualQuery, Func<IQueryable<TItem1>, IQueryable<bool>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<DateTime>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<DateTime>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<DateTimeOffset>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<DateTimeOffset>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<double>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<double>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<short>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<short>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<long>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool?>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool?>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<bool?>> expectedQuery, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<bool?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<bool?>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<DateTime?>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<DateTime?>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<double?>> query, bool assertOrder = false) where TItem1 : class;
+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<double?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<double?>> expectedQuery, bool assertOrder = false) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int?>> expectedQuery, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int?>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TimeSpan?>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TimeSpan?>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TimeSpan>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TimeSpan>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<uint>> query, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<uint>> query, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<uint>> actualQuery, Func<IQueryable<TItem1>, IQueryable<uint>> expectedQuery, bool assertOrder = false) where TItem1 : class;

+        public Task AssertQueryScalar<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<uint>> actualQuery, Func<IQueryable<TItem1>, IQueryable<uint>> expectedQuery, bool assertOrder = false, string testMethodName = null) where TItem1 : class;
-        protected virtual Task AssertSingle<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
+        protected Task AssertSingle<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertSingle<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
+        protected Task AssertSingle<TItem1, TItem2>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertSingle<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingle<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertSingle<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingle<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertSingle<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingle<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertSingle<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingle<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertSingleOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingleOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TPredicate>> expectedQuery, Expression<Func<TPredicate, bool>> actualPredicate, Expression<Func<TPredicate, bool>> expectedPredicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertSingleOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingleOrDefault<TItem1, TPredicate>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TPredicate>> query, Expression<Func<TPredicate, bool>> predicate, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertSingleOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingleOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> query, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected virtual Task AssertSingleOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
+        protected Task AssertSingleOrDefault<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<object>> actualQuery, Func<IQueryable<TItem1>, IQueryable<object>> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, bool> syncQuery, Func<IQueryable<TItem1>, Task<bool>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, bool> syncQuery, Func<IQueryable<TItem1>, Task<bool>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, bool> actualSyncQuery, Func<IQueryable<TItem1>, Task<bool>> actualAsyncQuery, Func<IQueryable<TItem1>, bool> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, bool> actualSyncQuery, Func<IQueryable<TItem1>, Task<bool>> actualAsyncQuery, Func<IQueryable<TItem1>, bool> expectedQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, int> syncQuery, Func<IQueryable<TItem1>, Task<int>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, int> syncQuery, Func<IQueryable<TItem1>, Task<int>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, int> actualSyncQuery, Func<IQueryable<TItem1>, Task<int>> actualAsyncQuery, Func<IQueryable<TItem1>, int> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, int> actualSyncQuery, Func<IQueryable<TItem1>, Task<int>> actualAsyncQuery, Func<IQueryable<TItem1>, int> expectedQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, long> syncQuery, Func<IQueryable<TItem1>, Task<long>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, long> syncQuery, Func<IQueryable<TItem1>, Task<long>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, long> actualSyncQuery, Func<IQueryable<TItem1>, Task<long>> actualAsyncQuery, Func<IQueryable<TItem1>, long> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, long> actualSyncQuery, Func<IQueryable<TItem1>, Task<long>> actualAsyncQuery, Func<IQueryable<TItem1>, long> expectedQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, object> syncQuery, Func<IQueryable<TItem1>, Task<object>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, object> syncQuery, Func<IQueryable<TItem1>, Task<object>> asyncQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, object> actualSyncQuery, Func<IQueryable<TItem1>, Task<object>> actualAsyncQuery, Func<IQueryable<TItem1>, object> expectedQuery, Action<object, object> asserter = null, int entryCount = 0) where TItem1 : class;

+        protected Task AssertSingleResult<TItem1>(bool isAsync, Func<IQueryable<TItem1>, object> actualSyncQuery, Func<IQueryable<TItem1>, Task<object>> actualAsyncQuery, Func<IQueryable<TItem1>, object> expectedQuery, Action<object, object> asserter = null, int entryCount = 0, string testMethodName = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TItem2, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class where TItem2 : class;
+        protected Task AssertSum<TItem1, TItem2, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertSum<TItem1, TItem2, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null) where TItem1 : class where TItem2 : class;
+        protected Task AssertSum<TItem1, TItem2, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TItem2>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null) where TItem1 : class where TItem2 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, decimal>> actualSelector, Expression<Func<TSelector, decimal>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int>> actualSelector, Expression<Func<TSelector, int>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, int?>> actualSelector, Expression<Func<TSelector, int?>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, float>> actualSelector, Expression<Func<TSelector, float>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> actualQuery, Func<IQueryable<TItem1>, IQueryable<TSelector>> expectedQuery, Expression<Func<TSelector, float>> actualSelector, Expression<Func<TSelector, float>> expectedSelector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, decimal>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, int?>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, float>> selector, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1, TSelector>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<TSelector>> query, Expression<Func<TSelector, float>> selector, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> query, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> query, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> query, Action<object, object> asserter = null) where TItem1 : class;
-        protected virtual Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int?>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
+        protected Task AssertSum<TItem1>(bool isAsync, Func<IQueryable<TItem1>, IQueryable<int?>> actualQuery, Func<IQueryable<TItem1>, IQueryable<int?>> expectedQuery, Action<object, object> asserter = null) where TItem1 : class;
-        public static TResult Maybe<TResult>(object caller, Func<TResult> expression) where TResult : class;
+        protected static TResult Maybe<TResult>(object caller, Func<TResult> expression) where TResult : class;
-        public static IEnumerable<TResult> MaybeDefaultIfEmpty<TResult>(IEnumerable<TResult> caller) where TResult : class;
+        protected static IEnumerable<TResult> MaybeDefaultIfEmpty<TResult>(IEnumerable<TResult> caller) where TResult : class;
-        public static TResult? MaybeScalar<TResult>(object caller, Func<TResult?> expression) where TResult : struct;
+        protected static TResult? MaybeScalar<TResult>(object caller, Func<TResult?> expression) where TResult : struct;
     }
+    public class QueryTranslationPostprocessor {
+        public QueryTranslationPostprocessor(QueryTranslationPostprocessorDependencies dependencies);
+        protected virtual QueryTranslationPostprocessorDependencies Dependencies { get; }
+        public virtual Expression Process(Expression query);
+    }
+    public sealed class QueryTranslationPostprocessorDependencies {
+        public QueryTranslationPostprocessorDependencies();
+    }
+    public class QueryTranslationPreprocessor {
+        public QueryTranslationPreprocessor(QueryTranslationPreprocessorDependencies dependencies, QueryCompilationContext queryCompilationContext);
+        protected virtual QueryTranslationPreprocessorDependencies Dependencies { get; }
+        public virtual Expression Process(Expression query);
+    }
+    public sealed class QueryTranslationPreprocessorDependencies {
+        public QueryTranslationPreprocessorDependencies(IEvaluatableExpressionFilter evaluatableExpressionFilter);
+        public IEvaluatableExpressionFilter EvaluatableExpressionFilter { get; }
+        public QueryTranslationPreprocessorDependencies With(IEvaluatableExpressionFilter evaluatableExpressionFilter);
+    }
+    public class RelationalCollectionShaperExpression : Expression, IPrintableExpression {
+        public RelationalCollectionShaperExpression(int collectionId, Expression parentIdentifier, Expression outerIdentifier, Expression selfIdentifier, Expression innerShaper, INavigation navigation, Type elementType);
+        public virtual int CollectionId { get; }
+        public virtual Type ElementType { get; }
+        public virtual Expression InnerShaper { get; }
+        public virtual INavigation Navigation { get; }
+        public sealed override ExpressionType NodeType { get; }
+        public virtual Expression OuterIdentifier { get; }
+        public virtual Expression ParentIdentifier { get; }
+        public virtual Expression SelfIdentifier { get; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        public virtual RelationalCollectionShaperExpression Update(Expression parentIdentifier, Expression outerIdentifier, Expression selfIdentifier, Expression innerShaper);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
+    public class RelationalEvaluatableExpressionFilter : EvaluatableExpressionFilter {
+        public RelationalEvaluatableExpressionFilter(EvaluatableExpressionFilterDependencies dependencies, RelationalEvaluatableExpressionFilterDependencies relationalDependencies);
+        protected virtual RelationalEvaluatableExpressionFilterDependencies RelationalDependencies { get; }
+        public override bool IsEvaluatableExpression(Expression expression, IModel model);
+    }
+    public sealed class RelationalEvaluatableExpressionFilterDependencies {
+        public RelationalEvaluatableExpressionFilterDependencies();
+    }
+    public class RelationalMemberTranslatorProvider : IMemberTranslatorProvider {
+        public RelationalMemberTranslatorProvider(RelationalMemberTranslatorProviderDependencies dependencies);
+        protected virtual void AddTranslators(IEnumerable<IMemberTranslator> translators);
+        public virtual SqlExpression Translate(SqlExpression instance, MemberInfo member, Type returnType);
+    }
+    public sealed class RelationalMemberTranslatorProviderDependencies {
+        public RelationalMemberTranslatorProviderDependencies(ISqlExpressionFactory sqlExpressionFactory, IEnumerable<IMemberTranslatorPlugin> plugins);
+        public IEnumerable<IMemberTranslatorPlugin> Plugins { get; }
+        public ISqlExpressionFactory SqlExpressionFactory { get; }
+        public RelationalMemberTranslatorProviderDependencies With(ISqlExpressionFactory sqlExpressionFactory);
+        public RelationalMemberTranslatorProviderDependencies With(IEnumerable<IMemberTranslatorPlugin> plugins);
+    }
+    public class RelationalMethodCallTranslatorProvider : IMethodCallTranslatorProvider {
+        public RelationalMethodCallTranslatorProvider(RelationalMethodCallTranslatorProviderDependencies dependencies);
+        protected virtual void AddTranslators(IEnumerable<IMethodCallTranslator> translators);
+        public virtual SqlExpression Translate(IModel model, SqlExpression instance, MethodInfo method, IReadOnlyList<SqlExpression> arguments);
+    }
+    public sealed class RelationalMethodCallTranslatorProviderDependencies {
+        public RelationalMethodCallTranslatorProviderDependencies(ISqlExpressionFactory sqlExpressionFactory, IEnumerable<IMethodCallTranslatorPlugin> plugins);
+        public IEnumerable<IMethodCallTranslatorPlugin> Plugins { get; }
+        public ISqlExpressionFactory SqlExpressionFactory { get; }
+        public RelationalMethodCallTranslatorProviderDependencies With(ISqlExpressionFactory sqlExpressionFactory);
+        public RelationalMethodCallTranslatorProviderDependencies With(IEnumerable<IMethodCallTranslatorPlugin> plugins);
+    }
     public abstract class RelationalOwnedQueryTestBase<TFixture> : OwnedQueryTestBase<TFixture> where TFixture : RelationalOwnedQueryTestBase<TFixture>.RelationalOwnedQueryFixture, new() {
         public abstract class RelationalOwnedQueryFixture : OwnedQueryTestBase<TFixture>.OwnedQueryFixtureBase {
-            public override DbContextOptionsBuilder AddOptions(DbContextOptionsBuilder builder);

         }
     }
+    public class RelationalQueryableMethodTranslatingExpressionVisitor : QueryableMethodTranslatingExpressionVisitor {
+        public RelationalQueryableMethodTranslatingExpressionVisitor(QueryableMethodTranslatingExpressionVisitorDependencies dependencies, RelationalQueryableMethodTranslatingExpressionVisitorDependencies relationalDependencies, IModel model);
+        protected RelationalQueryableMethodTranslatingExpressionVisitor(RelationalQueryableMethodTranslatingExpressionVisitor parentVisitor);
+        protected virtual RelationalQueryableMethodTranslatingExpressionVisitorDependencies RelationalDependencies { get; }
+        protected override ShapedQueryExpression CreateShapedQueryExpression(Type elementType);
+        protected override QueryableMethodTranslatingExpressionVisitor CreateSubqueryVisitor();
+        protected override ShapedQueryExpression TranslateAll(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override ShapedQueryExpression TranslateAny(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override ShapedQueryExpression TranslateAverage(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected override ShapedQueryExpression TranslateCast(ShapedQueryExpression source, Type resultType);
+        protected override ShapedQueryExpression TranslateConcat(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected override ShapedQueryExpression TranslateContains(ShapedQueryExpression source, Expression item);
+        protected override ShapedQueryExpression TranslateCount(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override ShapedQueryExpression TranslateDefaultIfEmpty(ShapedQueryExpression source, Expression defaultValue);
+        protected override ShapedQueryExpression TranslateDistinct(ShapedQueryExpression source);
+        protected override ShapedQueryExpression TranslateElementAtOrDefault(ShapedQueryExpression source, Expression index, bool returnDefault);
+        protected override ShapedQueryExpression TranslateExcept(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected override ShapedQueryExpression TranslateFirstOrDefault(ShapedQueryExpression source, LambdaExpression predicate, Type returnType, bool returnDefault);
+        protected override ShapedQueryExpression TranslateGroupBy(ShapedQueryExpression source, LambdaExpression keySelector, LambdaExpression elementSelector, LambdaExpression resultSelector);
+        protected override ShapedQueryExpression TranslateGroupJoin(ShapedQueryExpression outer, ShapedQueryExpression inner, LambdaExpression outerKeySelector, LambdaExpression innerKeySelector, LambdaExpression resultSelector);
+        protected override ShapedQueryExpression TranslateIntersect(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected override ShapedQueryExpression TranslateJoin(ShapedQueryExpression outer, ShapedQueryExpression inner, LambdaExpression outerKeySelector, LambdaExpression innerKeySelector, LambdaExpression resultSelector);
+        protected override ShapedQueryExpression TranslateLastOrDefault(ShapedQueryExpression source, LambdaExpression predicate, Type returnType, bool returnDefault);
+        protected override ShapedQueryExpression TranslateLeftJoin(ShapedQueryExpression outer, ShapedQueryExpression inner, LambdaExpression outerKeySelector, LambdaExpression innerKeySelector, LambdaExpression resultSelector);
+        protected override ShapedQueryExpression TranslateLongCount(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override ShapedQueryExpression TranslateMax(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected override ShapedQueryExpression TranslateMin(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected override ShapedQueryExpression TranslateOfType(ShapedQueryExpression source, Type resultType);
+        protected override ShapedQueryExpression TranslateOrderBy(ShapedQueryExpression source, LambdaExpression keySelector, bool ascending);
+        protected override ShapedQueryExpression TranslateReverse(ShapedQueryExpression source);
+        protected override ShapedQueryExpression TranslateSelect(ShapedQueryExpression source, LambdaExpression selector);
+        protected override ShapedQueryExpression TranslateSelectMany(ShapedQueryExpression source, LambdaExpression selector);
+        protected override ShapedQueryExpression TranslateSelectMany(ShapedQueryExpression source, LambdaExpression collectionSelector, LambdaExpression resultSelector);
+        protected override ShapedQueryExpression TranslateSingleOrDefault(ShapedQueryExpression source, LambdaExpression predicate, Type returnType, bool returnDefault);
+        protected override ShapedQueryExpression TranslateSkip(ShapedQueryExpression source, Expression count);
+        protected override ShapedQueryExpression TranslateSkipWhile(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override ShapedQueryExpression TranslateSum(ShapedQueryExpression source, LambdaExpression selector, Type resultType);
+        protected override ShapedQueryExpression TranslateTake(ShapedQueryExpression source, Expression count);
+        protected override ShapedQueryExpression TranslateTakeWhile(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override ShapedQueryExpression TranslateThenBy(ShapedQueryExpression source, LambdaExpression keySelector, bool ascending);
+        protected override ShapedQueryExpression TranslateUnion(ShapedQueryExpression source1, ShapedQueryExpression source2);
+        protected override ShapedQueryExpression TranslateWhere(ShapedQueryExpression source, LambdaExpression predicate);
+        protected override Expression VisitMethodCall(MethodCallExpression methodCallExpression);
+    }
+    public sealed class RelationalQueryableMethodTranslatingExpressionVisitorDependencies {
+        public RelationalQueryableMethodTranslatingExpressionVisitorDependencies(IRelationalSqlTranslatingExpressionVisitorFactory relationalSqlTranslatingExpressionVisitorFactory, ISqlExpressionFactory sqlExpressionFactory);
+        public IRelationalSqlTranslatingExpressionVisitorFactory RelationalSqlTranslatingExpressionVisitorFactory { get; }
+        public ISqlExpressionFactory SqlExpressionFactory { get; }
+        public RelationalQueryableMethodTranslatingExpressionVisitorDependencies With(IRelationalSqlTranslatingExpressionVisitorFactory relationalSqlTranslatingExpressionVisitorFactory);
+        public RelationalQueryableMethodTranslatingExpressionVisitorDependencies With(ISqlExpressionFactory sqlExpressionFactory);
+    }
-    public class RelationalQueryCompilationContext : QueryCompilationContext {
 {
-        public RelationalQueryCompilationContext(QueryCompilationContextDependencies dependencies, ILinqOperatorProvider linqOperatorProvider, IQueryMethodProvider queryMethodProvider, bool trackQueryResults);

-        public virtual bool IsLateralJoinSupported { get; }

-        public virtual int MaxTableAliasLength { get; }

-        public virtual IList<string> ParentQueryReferenceParameters { get; }

-        public virtual IQueryMethodProvider QueryMethodProvider { get; }

-        public override EntityQueryModelVisitor CreateQueryModelVisitor();

-        public override EntityQueryModelVisitor CreateQueryModelVisitor(EntityQueryModelVisitor parentEntityQueryModelVisitor);

-        public virtual string CreateUniqueTableAlias();

-        public virtual string CreateUniqueTableAlias(string currentAlias);

-        public virtual SelectExpression FindSelectExpression(IQuerySource querySource);

-    }
-    public sealed class RelationalQueryCompilationContextDependencies {
 {
-        public RelationalQueryCompilationContextDependencies(INodeTypeProviderFactory nodeTypeProviderFactory);

-        public INodeTypeProviderFactory NodeTypeProviderFactory { get; }

-        public RelationalQueryCompilationContextDependencies With(INodeTypeProviderFactory nodeTypeProviderFactory);

-    }
-    public class RelationalQueryCompilationContextFactory : QueryCompilationContextFactory {
 {
-        public RelationalQueryCompilationContextFactory(QueryCompilationContextDependencies dependencies, RelationalQueryCompilationContextDependencies relationalDependencies);

-        public override QueryCompilationContext Create(bool async);

-    }
     public class RelationalQueryContext : QueryContext {
+        public RelationalQueryContext(QueryContextDependencies dependencies, RelationalQueryContextDependencies relationalDependencies);
-        public RelationalQueryContext(QueryContextDependencies dependencies, Func<IQueryBuffer> queryBufferFactory, IRelationalConnection connection, IExecutionStrategyFactory executionStrategyFactory);

+        protected virtual RelationalQueryContextDependencies RelationalDependencies { get; }
     }
+    public sealed class RelationalQueryContextDependencies {
+        public RelationalQueryContextDependencies(IRelationalConnection relationalConnection, IExecutionStrategyFactory executionStrategyFactory);
+        public IExecutionStrategyFactory ExecutionStrategyFactory { get; }
+        public IRelationalConnection RelationalConnection { get; }
+        public RelationalQueryContextDependencies With(IExecutionStrategyFactory executionStrategyFactory);
+        public RelationalQueryContextDependencies With(IRelationalConnection relationalConnection);
+    }
-    public class RelationalQueryContextFactory : QueryContextFactory {
 {
-        public RelationalQueryContextFactory(QueryContextDependencies dependencies, IRelationalConnection connection, IExecutionStrategyFactory executionStrategyFactory);

-        protected virtual IExecutionStrategyFactory ExecutionStrategyFactory { get; }

-        public override QueryContext Create();

-    }
-    public class RelationalQueryModelVisitor : EntityQueryModelVisitor {
 {
-        public RelationalQueryModelVisitor(EntityQueryModelVisitorDependencies dependencies, RelationalQueryModelVisitorDependencies relationalDependencies, RelationalQueryCompilationContext queryCompilationContext, RelationalQueryModelVisitor parentQueryModelVisitor);

-        public virtual bool CanBindToParentQueryModel { get; protected set; }

-        protected virtual IDbContextOptions ContextOptions { get; }

-        public virtual bool IsLiftable { get; }

-        public virtual RelationalQueryModelVisitor ParentQueryModelVisitor { get; }

-        public virtual ICollection<SelectExpression> Queries { get; }

-        protected virtual Dictionary<IQuerySource, SelectExpression> QueriesBySource { get; }

-        public virtual new RelationalQueryCompilationContext QueryCompilationContext { get; }

-        public virtual bool RequiresClientEval { get; set; }

-        public virtual bool RequiresClientFilter { get; set; }

-        public virtual bool RequiresClientJoin { get; set; }

-        public virtual bool RequiresClientOrderBy { get; set; }

-        public virtual bool RequiresClientProjection { get; set; }

-        public virtual bool RequiresClientResultOperator { get; set; }

-        public virtual bool RequiresClientSelectMany { get; set; }

-        public virtual bool RequiresStreamingGroupResultOperator { get; set; }

-        public virtual void AddQuery(IQuerySource querySource, SelectExpression selectExpression);

-        public virtual Expression BindLocalMethodCallExpression(MethodCallExpression methodCallExpression);

-        public virtual TResult BindMemberExpression<TResult>(MemberExpression memberExpression, Func<IProperty, IQuerySource, SelectExpression, TResult> memberBinder, bool bindSubQueries = false);

-        public virtual Expression BindMemberToOuterQueryParameter(MemberExpression memberExpression);

-        public override Expression BindMemberToValueBuffer(MemberExpression memberExpression, Expression expression);

-        public virtual TResult BindMethodCallExpression<TResult>(MethodCallExpression methodCallExpression, Func<IProperty, IQuerySource, SelectExpression, TResult> memberBinder, bool bindSubQueries = false);

-        public override Expression BindMethodCallToValueBuffer(MethodCallExpression methodCallExpression, Expression expression);

-        public virtual Expression BindMethodToOuterQueryParameter(MethodCallExpression methodCallExpression);

-        protected override bool CanOptimizeCorrelatedCollections();

-        protected override Expression CompileAdditionalFromClauseExpression(AdditionalFromClause additionalFromClause, QueryModel queryModel);

-        protected override Expression CompileGroupJoinInnerSequenceExpression(GroupJoinClause groupJoinClause, QueryModel queryModel);

-        protected override Expression CompileJoinClauseInnerSequenceExpression(JoinClause joinClause, QueryModel queryModel);

-        protected override Expression CompileMainFromClauseExpression(MainFromClause mainFromClause, QueryModel queryModel);

-        protected override Func<QueryContext, TResults> CreateExecutorLambda<TResults>();

-        public virtual void LiftInjectedParameters(RelationalQueryModelVisitor subQueryModelVisitor);

-        protected override void OnBeforeNavigationRewrite(QueryModel queryModel);

-        protected override void OptimizeQueryModel(QueryModel queryModel, bool asyncQuery);

-        public virtual void RegisterSubQueryVisitor(IQuerySource querySource, RelationalQueryModelVisitor queryModelVisitor);

-        protected override void RemoveOrderings(QueryModel queryModel);

-        public override bool ShouldApplyDefiningQuery(IEntityType entityType, IQuerySource querySource);

-        public virtual SelectExpression TryGetQuery(IQuerySource querySource);

-        public override void VisitAdditionalFromClause(AdditionalFromClause fromClause, QueryModel queryModel, int index);

-        public override void VisitGroupJoinClause(GroupJoinClause groupJoinClause, QueryModel queryModel, int index);

-        public override void VisitJoinClause(JoinClause joinClause, QueryModel queryModel, int index);

-        public override void VisitOrderByClause(OrderByClause orderByClause, QueryModel queryModel, int index);

-        public override void VisitQueryModel(QueryModel queryModel);

-        public override void VisitResultOperator(ResultOperatorBase resultOperator, QueryModel queryModel, int index);

-        public override void VisitSelectClause(SelectClause selectClause, QueryModel queryModel);

-        public virtual void VisitSubQueryModel(QueryModel queryModel);

-        public override void VisitWhereClause(WhereClause whereClause, QueryModel queryModel, int index);

-        protected virtual void WarnClientEval(QueryModel queryModel, object queryModelElement);

-    }
-    public sealed class RelationalQueryModelVisitorDependencies {
 {
-        public RelationalQueryModelVisitorDependencies(IRelationalResultOperatorHandler relationalResultOperatorHandler, ISqlTranslatingExpressionVisitorFactory sqlTranslatingExpressionVisitorFactory, ICompositePredicateExpressionVisitorFactory compositePredicateExpressionVisitorFactory, IConditionalRemovingExpressionVisitorFactory conditionalRemovingExpressionVisitorFactory, IDbContextOptions contextOptions);

-        public ICompositePredicateExpressionVisitorFactory CompositePredicateExpressionVisitorFactory { get; }

-        public IConditionalRemovingExpressionVisitorFactory ConditionalRemovingExpressionVisitorFactory { get; }

-        public IDbContextOptions ContextOptions { get; }

-        public IRelationalResultOperatorHandler RelationalResultOperatorHandler { get; }

-        public ISqlTranslatingExpressionVisitorFactory SqlTranslatingExpressionVisitorFactory { get; }

-        public RelationalQueryModelVisitorDependencies With(IDbContextOptions contextOptions);

-        public RelationalQueryModelVisitorDependencies With(ICompositePredicateExpressionVisitorFactory compositePredicateExpressionVisitorFactory);

-        public RelationalQueryModelVisitorDependencies With(IConditionalRemovingExpressionVisitorFactory conditionalRemovingExpressionVisitorFactory);

-        public RelationalQueryModelVisitorDependencies With(ISqlTranslatingExpressionVisitorFactory sqlTranslatingExpressionVisitorFactory);

-        public RelationalQueryModelVisitorDependencies With(IRelationalResultOperatorHandler relationalResultOperatorHandler);

-    }
-    public class RelationalQueryModelVisitorFactory : EntityQueryModelVisitorFactory {
 {
-        public RelationalQueryModelVisitorFactory(EntityQueryModelVisitorDependencies dependencies, RelationalQueryModelVisitorDependencies relationalDependencies);

-        protected virtual RelationalQueryModelVisitorDependencies RelationalDependencies { get; }

-        public override EntityQueryModelVisitor Create(QueryCompilationContext queryCompilationContext, EntityQueryModelVisitor parentEntityQueryModelVisitor);

-    }
+    public class RelationalQueryTranslationPostprocessor : QueryTranslationPostprocessor {
+        public RelationalQueryTranslationPostprocessor(QueryTranslationPostprocessorDependencies dependencies, RelationalQueryTranslationPostprocessorDependencies relationalDependencies, QueryCompilationContext queryCompilationContext);
+        protected virtual RelationalQueryTranslationPostprocessorDependencies RelationalDependencies { get; }
+        protected virtual ISqlExpressionFactory SqlExpressionFactory { get; }
+        protected virtual bool UseRelationalNulls { get; }
+        protected virtual Expression OptimizeSqlExpression(Expression query);
+        public override Expression Process(Expression query);
+    }
+    public sealed class RelationalQueryTranslationPostprocessorDependencies {
+        public RelationalQueryTranslationPostprocessorDependencies(ISqlExpressionFactory sqlExpressionFactory);
+        public ISqlExpressionFactory SqlExpressionFactory { get; }
+        public RelationalQueryTranslationPostprocessorDependencies With(ISqlExpressionFactory sqlExpressionFactory);
+    }
+    public class RelationalQueryTranslationPreprocessor : QueryTranslationPreprocessor {
+        public RelationalQueryTranslationPreprocessor(QueryTranslationPreprocessorDependencies dependencies, RelationalQueryTranslationPreprocessorDependencies relationalDependencies, QueryCompilationContext queryCompilationContext);
+        protected virtual RelationalQueryTranslationPreprocessorDependencies RelationalDependencies { get; }
+    }
+    public sealed class RelationalQueryTranslationPreprocessorDependencies {
+        public RelationalQueryTranslationPreprocessorDependencies();
+    }
+    public class RelationalShapedQueryCompilingExpressionVisitor : ShapedQueryCompilingExpressionVisitor {
+        public RelationalShapedQueryCompilingExpressionVisitor(ShapedQueryCompilingExpressionVisitorDependencies dependencies, RelationalShapedQueryCompilingExpressionVisitorDependencies relationalDependencies, QueryCompilationContext queryCompilationContext);
+        protected virtual RelationalShapedQueryCompilingExpressionVisitorDependencies RelationalDependencies { get; }
+        protected override Expression VisitShapedQueryExpression(ShapedQueryExpression shapedQueryExpression);
+    }
+    public sealed class RelationalShapedQueryCompilingExpressionVisitorDependencies {
+        public RelationalShapedQueryCompilingExpressionVisitorDependencies(IQuerySqlGeneratorFactory querySqlGeneratorFactory, ISqlExpressionFactory sqlExpressionFactory, IParameterNameGeneratorFactory parameterNameGeneratorFactory);
+        public IParameterNameGeneratorFactory ParameterNameGeneratorFactory { get; }
+        public IQuerySqlGeneratorFactory QuerySqlGeneratorFactory { get; }
+        public ISqlExpressionFactory SqlExpressionFactory { get; }
+        public RelationalShapedQueryCompilingExpressionVisitorDependencies With(IQuerySqlGeneratorFactory querySqlGeneratorFactory);
+        public RelationalShapedQueryCompilingExpressionVisitorDependencies With(ISqlExpressionFactory sqlExpressionFactory);
+        public RelationalShapedQueryCompilingExpressionVisitorDependencies With(IParameterNameGeneratorFactory parameterNameGeneratorFactory);
+    }
+    public class RelationalSqlTranslatingExpressionVisitor : ExpressionVisitor {
+        public RelationalSqlTranslatingExpressionVisitor(RelationalSqlTranslatingExpressionVisitorDependencies dependencies, IModel model, QueryableMethodTranslatingExpressionVisitor queryableMethodTranslatingExpressionVisitor);
+        protected virtual RelationalSqlTranslatingExpressionVisitorDependencies Dependencies { get; }
+        public virtual SqlExpression Translate(Expression expression);
+        public virtual SqlExpression TranslateAverage(Expression expression);
+        public virtual SqlExpression TranslateCount(Expression expression = null);
+        public virtual SqlExpression TranslateLongCount(Expression expression = null);
+        public virtual SqlExpression TranslateMax(Expression expression);
+        public virtual SqlExpression TranslateMin(Expression expression);
+        public virtual SqlExpression TranslateSum(Expression expression);
+        protected override Expression VisitBinary(BinaryExpression binaryExpression);
+        protected override Expression VisitConditional(ConditionalExpression conditionalExpression);
+        protected override Expression VisitConstant(ConstantExpression constantExpression);
+        protected override Expression VisitExtension(Expression extensionExpression);
+        protected override Expression VisitInvocation(InvocationExpression node);
+        protected override Expression VisitLambda<T>(Expression<T> node);
+        protected override Expression VisitListInit(ListInitExpression node);
+        protected override Expression VisitMember(MemberExpression memberExpression);
+        protected override Expression VisitMemberInit(MemberInitExpression node);
+        protected override Expression VisitMethodCall(MethodCallExpression methodCallExpression);
+        protected override Expression VisitNew(NewExpression node);
+        protected override Expression VisitNewArray(NewArrayExpression node);
+        protected override Expression VisitParameter(ParameterExpression parameterExpression);
+        protected override Expression VisitTypeBinary(TypeBinaryExpression typeBinaryExpression);
+        protected override Expression VisitUnary(UnaryExpression unaryExpression);
+    }
+    public sealed class RelationalSqlTranslatingExpressionVisitorDependencies {
+        public RelationalSqlTranslatingExpressionVisitorDependencies(ISqlExpressionFactory sqlExpressionFactory, IMemberTranslatorProvider memberTranslatorProvider, IMethodCallTranslatorProvider methodCallTranslatorProvider);
+        public IMemberTranslatorProvider MemberTranslatorProvider { get; }
+        public IMethodCallTranslatorProvider MethodCallTranslatorProvider { get; }
+        public ISqlExpressionFactory SqlExpressionFactory { get; }
+        public RelationalSqlTranslatingExpressionVisitorDependencies With(IMemberTranslatorProvider memberTranslatorProvider);
+        public RelationalSqlTranslatingExpressionVisitorDependencies With(IMethodCallTranslatorProvider methodCallTranslatorProvider);
+        public RelationalSqlTranslatingExpressionVisitorDependencies With(ISqlExpressionFactory sqlExpressionFactory);
+    }
+    public class RelationalSqlTranslatingExpressionVisitorFactory : IRelationalSqlTranslatingExpressionVisitorFactory {
+        public RelationalSqlTranslatingExpressionVisitorFactory(RelationalSqlTranslatingExpressionVisitorDependencies dependencies);
+        public virtual RelationalSqlTranslatingExpressionVisitor Create(IModel model, QueryableMethodTranslatingExpressionVisitor queryableMethodTranslatingExpressionVisitor);
+    }
+    public class ReplacingExpressionVisitor : ExpressionVisitor {
+        public ReplacingExpressionVisitor(IDictionary<Expression, Expression> replacements);
+        public static Expression Replace(Expression original, Expression replacement, Expression tree);
+        public override Expression Visit(Expression expression);
+        protected override Expression VisitMember(MemberExpression memberExpression);
+        protected override Expression VisitMethodCall(MethodCallExpression methodCallExpression);
+    }
+    public enum ResultCardinality {
+        Enumerable = 0,
+        Single = 1,
+        SingleOrDefault = 2,
+    }
-    public class ResultOperatorHandler : IResultOperatorHandler {
 {
-        public ResultOperatorHandler(ResultOperatorHandlerDependencies dependencies);

-        public static Expression CallWithPossibleCancellationToken(MethodInfo methodInfo, params Expression[] arguments);

-        public virtual Expression HandleResultOperator(EntityQueryModelVisitor entityQueryModelVisitor, ResultOperatorBase resultOperator, QueryModel queryModel);

-    }
-    public sealed class ResultOperatorHandlerDependencies {
 {
-        public ResultOperatorHandlerDependencies();

-    }
+    public abstract class ShapedQueryCompilingExpressionVisitor : ExpressionVisitor {
+        protected ShapedQueryCompilingExpressionVisitor(ShapedQueryCompilingExpressionVisitorDependencies dependencies, QueryCompilationContext queryCompilationContext);
+        protected virtual ShapedQueryCompilingExpressionVisitorDependencies Dependencies { get; }
+        protected virtual bool IsAsync { get; }
+        protected virtual bool IsTracking { get; }
+        protected virtual Expression InjectEntityMaterializers(Expression expression);
+        protected override Expression VisitExtension(Expression extensionExpression);
+        protected abstract Expression VisitShapedQueryExpression(ShapedQueryExpression shapedQueryExpression);
+    }
+    public sealed class ShapedQueryCompilingExpressionVisitorDependencies {
+        public ShapedQueryCompilingExpressionVisitorDependencies(IEntityMaterializerSource entityMaterializerSource, ITypeMappingSource typeMappingSource);
+        public IEntityMaterializerSource EntityMaterializerSource { get; }
+        public ITypeMappingSource TypeMappingSource { get; }
+        public ShapedQueryCompilingExpressionVisitorDependencies With(IEntityMaterializerSource entityMaterializerSource);
+        public ShapedQueryCompilingExpressionVisitorDependencies With(ITypeMappingSource typeMappingSource);
+    }
+    public class ShapedQueryExpression : Expression, IPrintableExpression {
+        public ShapedQueryExpression(Expression queryExpression, Expression shaperExpression);
+        public sealed override ExpressionType NodeType { get; }
+        public virtual Expression QueryExpression { get; set; }
+        public virtual ResultCardinality ResultCardinality { get; set; }
+        public virtual Expression ShaperExpression { get; set; }
+        public override Type Type { get; }
+        public virtual void Print(ExpressionPrinter expressionPrinter);
+        protected override Expression VisitChildren(ExpressionVisitor visitor);
+    }
     public abstract class SimpleQueryTestBase<TFixture> : QueryTestBase<TFixture> where TFixture : NorthwindQueryFixtureBase<NoopModelCustomizer>, new() {
+        public virtual void Average_no_data_cast_to_nullable();
+        public virtual void Average_no_data_nullable();
-        public virtual void Can_execute_non_generic();

+        public virtual Task Cast_before_aggregate_is_preserved(bool isAsync);
+        public virtual Task Cast_on_top_level_projection_brings_explicit_Cast(bool isAsync);
+        public virtual void Client_code_using_instance_in_anonymous_type();
+        public virtual void Client_code_using_instance_in_static_method();
+        public virtual void Client_code_using_instance_method_throws();
+        public virtual Task Client_eval_Union_FirstOrDefault(bool isAsync);
+        public virtual Task Client_method_in_projection_requiring_materialization_1(bool isAsync);
+        public virtual Task Client_method_in_projection_requiring_materialization_2(bool isAsync);
+        public virtual Task Concat(bool isAsync);
-        public virtual void Concat_dbset();

-        public virtual void Concat_non_entity();

+        public virtual Task Concat_non_entity(bool isAsync);
-        public virtual void Concat_simple();

+        public virtual void Contains_over_entityType_with_null_should_rewrite_to_identity_equality();
+        public virtual void Contains_over_keyless_entity_throws();
+        public virtual Task Contains_with_constant_list_value_type_id(bool isAsync);
-        public virtual Task Contains_with_local_int_array_closure(bool isAsync);

+        public virtual Task Contains_with_local_non_primitive_list_closure_mix(bool isAsync);
+        public virtual Task Contains_with_local_non_primitive_list_inline_closure_mix(bool isAsync);
-        public virtual Task Contains_with_local_nullable_int_array_closure(bool isAsync);

+        public virtual Task Contains_with_local_nullable_uint_array_closure(bool isAsync);
+        public virtual Task Contains_with_local_uint_array_closure(bool isAsync);
+        public virtual Task Contains_with_parameter_list_value_type_id(bool isAsync);
+        public virtual Task Convert_to_nullable_on_nullable_value_is_ignored(bool isAsync);
+        public virtual Task DateTime_Compare_to_simple_zero(bool isAsync, bool compareTo);
+        public virtual Task DateTime_parse_is_inlined(bool isAsync);
-        public virtual Task DateTime_parse_is_parameterized(bool isAsync);

+        public virtual Task DateTime_parse_is_parameterized_when_from_closure(bool isAsync);
+        public virtual Task Decimal_cast_to_double_works(bool isAsync);
+        public virtual Task DefaultIfEmpty_in_subquery_not_correlated(bool isAsync);
+        public virtual Task Enclosing_class_const_member_does_not_generate_parameter(bool isAsync);
+        public virtual Task Enclosing_class_readonly_member_generates_parameter(bool isAsync);
+        public virtual Task Enclosing_class_settable_member_generates_parameter(bool isAsync);
+        public virtual Task Entity_equality_local_composite_key(bool isAsync);
+        public virtual Task Entity_equality_local_double_check(bool isAsync);
+        public virtual Task Entity_equality_local_inline_composite_key(bool isAsync);
+        public virtual Task Entity_equality_not_null_composite_key(bool isAsync);
+        public virtual Task Entity_equality_null_composite_key(bool isAsync);
+        public virtual Task Entity_equality_orderby(bool isAsync);
+        public virtual Task Entity_equality_orderby_descending_composite_key(bool isAsync);
+        public virtual Task Entity_equality_through_DTO_projection(bool isAsync);
+        public virtual Task Entity_equality_through_include(bool isAsync);
+        public virtual Task Entity_equality_through_nested_anonymous_type_projection(bool isAsync);
+        public virtual Task Entity_equality_through_subquery(bool isAsync);
+        public virtual void Entity_equality_through_subquery_composite_key();
+        public virtual Task Enumerable_min_is_mapped_to_Queryable_1(bool isAsync);
+        public virtual Task Enumerable_min_is_mapped_to_Queryable_2(bool isAsync);
+        public virtual Task Except(bool isAsync);
-        public virtual Task Except_dbset(bool isAsync);

-        public virtual void Except_non_entity();

+        public virtual Task Except_non_entity(bool isAsync);
-        public virtual Task Except_simple(bool isAsync);

+        public virtual Task Filter_non_nullable_value_after_FirstOrDefault_on_empty_collection(bool isAsync);
+        public virtual Task GroupBy_Select_Union(bool isAsync);
+        public virtual Task Include_Union(bool isAsync);
+        public virtual void Include_Union_different_includes_throws();
+        public virtual void Include_Union_only_on_one_side_throws();
+        public virtual Task Inner_parameter_in_nested_lambdas_gets_preserved(bool isAsync);
+        public virtual Task Intersect(bool isAsync);
-        public virtual Task Intersect_dbset(bool isAsync);

-        public virtual void Intersect_non_entity();

+        public virtual Task Intersect_non_entity(bool isAsync);
-        public virtual Task Intersect_simple(bool isAsync);

+        public virtual Task Int_Compare_to_simple_zero(bool isAsync);
+        public virtual Task Join_customers_orders_entities_same_entity_twice(bool isAsync);
+        public virtual void KeylessEntity_by_database_view();
+        public virtual Task KeylessEntity_select_where_navigation(bool isAsync);
+        public virtual Task KeylessEntity_select_where_navigation_multi_level(bool isAsync);
+        public virtual Task KeylessEntity_simple(bool isAsync);
+        public virtual Task KeylessEntity_where_simple(bool isAsync);
+        public virtual Task KeylessEntity_with_defining_query(bool isAsync);
+        public virtual Task KeylessEntity_with_defining_query_and_correlated_collection(bool isAsync);
+        public virtual Task KeylessEntity_with_included_nav(bool isAsync);
+        public virtual Task KeylessEntity_with_included_navs_multi_level(bool isAsync);
+        public virtual Task KeylessEntity_with_mixed_tracking(bool isAsync);
+        public virtual void KeylessEntity_with_nav_defining_query();
-        public virtual Task Let_subquery_with_multiple_occurences(bool isAsync);

+        public virtual Task Let_subquery_with_multiple_occurrences(bool isAsync);
+        public virtual Task List_Contains_over_entityType_should_rewrite_to_identity_equality(bool isAsync);
+        public virtual Task List_Contains_with_constant_list(bool isAsync);
+        public virtual Task List_Contains_with_parameter_list(bool isAsync);
-        public virtual Task Local_array(bool isAsync);

+        public virtual Task Local_dictionary(bool isAsync);
+        public virtual void Max_no_data_cast_to_nullable();
+        public virtual void Max_no_data_nullable();
-        public virtual void Method_with_constant_queryable_arg();

+        public virtual void Min_no_data_cast_to_nullable();
+        public virtual void Min_no_data_nullable();
+        public virtual Task Multiple_collection_navigation_with_FirstOrDefault_chained(bool isAsync);
+        public virtual Task Multiple_collection_navigation_with_FirstOrDefault_chained_projecting_scalar(bool isAsync);
+        public virtual void Multiple_context_instances_2();
+        public virtual Task Multiple_select_many_with_predicate(bool isAsync);
+        public virtual Task Navigation_inside_interpolated_string_is_expanded(bool isAsync);
+        public virtual Task New_DateTime_is_inlined(bool isAsync);
+        public virtual Task New_DateTime_is_parameterized_when_from_closure(bool isAsync);
+        public virtual Task Null_Coalesce_Short_Circuit(bool isAsync);
+        public virtual Task OrderBy_conditional_operator_where_condition_false(bool isAsync);
-        public virtual Task OrderBy_conditional_operator_where_condition_null(bool isAsync);

+        public virtual Task Projecting_nullable_struct(bool isAsync);
+        public virtual Task Projection_when_arithmetic_expression_precedence(bool isAsync);
-        public virtual Task Projection_when_arithmetic_expression_precendence(bool isAsync);

+        public virtual Task Project_non_nullable_value_after_FirstOrDefault_on_empty_collection(bool isAsync);
-        public virtual Task QueryType_select_where_navigation(bool isAsync);

-        public virtual Task QueryType_select_where_navigation_multi_level(bool isAsync);

-        public virtual Task QueryType_simple(bool isAsync);

-        public virtual Task QueryType_where_simple(bool isAsync);

-        public virtual Task QueryType_with_defining_query(bool isAsync);

-        public virtual Task QueryType_with_defining_query_and_correlated_collection(bool isAsync);

-        public virtual Task QueryType_with_included_nav(bool isAsync);

-        public virtual Task QueryType_with_included_navs_multi_level(bool isAsync);

-        public virtual Task QueryType_with_mixed_tracking(bool isAsync);

-        public virtual void QueryType_with_nav_defining_query();

-        public virtual void Query_backed_by_database_view();

-        public virtual void Query_throws_for_non_query();

+        public virtual Task SelectMany_correlated_with_outer_1(bool isAsync);
+        public virtual Task SelectMany_correlated_with_outer_2(bool isAsync);
+        public virtual Task SelectMany_correlated_with_outer_3(bool isAsync);
+        public virtual Task SelectMany_correlated_with_outer_4(bool isAsync);
+        public virtual Task SelectMany_without_result_selector_collection_navigation_composed(bool isAsync);
+        public virtual Task SelectMany_without_result_selector_naked_collection_navigation(bool isAsync);
+        public virtual void Select_DTO_constructor_distinct_with_navigation_translated_to_server();
+        public virtual Task Select_DTO_with_member_init_distinct_in_subquery_translated_to_server_2(bool isAsync);
+        public virtual Task Select_Except_reference_projection(bool isAsync);
+        public virtual Task Select_Property_when_shadow_unconstrained_generic_method(bool isAsync);
-        public virtual Task Select_Property_when_shaow_unconstrained_generic_method(bool isAsync);

+        public virtual Task Select_Union(bool isAsync);
+        public virtual Task Select_Union_different_fields_in_anonymous_with_subquery(bool isAsync);
+        public virtual Task Select_Union_unrelated(bool isAsync);
+        public virtual Task Skip_orderby_const(bool isAsync);
-        public virtual Task String_Compare_simple_client(bool isAsync);

+        public virtual Task String_Compare_simple_more_than_one(bool isAsync);
-        public virtual Task String_Compare_to_simple_client(bool isAsync);

+        public virtual Task String_Compare_to_simple_more_than_one(bool isAsync);
+        public virtual Task SubSelect_Union(bool isAsync);
-        public virtual Task Substring_with_client_eval(bool isAsync);

+        public virtual Task Substring_with_Index_of(bool isAsync);
+        public virtual Task Sum_with_no_data_cast_to_nullable(bool isAsync);
+        public virtual Task TimeSpan_Compare_to_simple_zero(bool isAsync, bool compareTo);
+        public virtual Task TypeBinary_short_circuit(bool isAsync);
+        public virtual Task Union(bool isAsync);
-        public virtual Task Union_dbset(bool isAsync);

+        public virtual Task Union_Include(bool isAsync);
+        public virtual Task Union_Intersect(bool isAsync);
-        public virtual void Union_non_entity();

+        public virtual void Union_non_entity(bool isAsync);
+        public virtual Task Union_OrderBy_Skip_Take(bool isAsync);
+        public virtual Task Union_over_different_projection_types(bool isAsync, string leftType, string rightType);
+        public virtual Task Union_Select(bool isAsync);
-        public virtual Task Union_simple(bool isAsync);

+        public virtual Task Union_Skip_Take_OrderBy_ThenBy_Where(bool isAsync);
+        public virtual Task Union_Take_Union_Take(bool isAsync);
+        public virtual Task Union_Union(bool isAsync);
+        public virtual Task Union_Where(bool isAsync);
+        public virtual Task Union_with_anonymous_type_projection(bool isAsync);
-        public virtual Task Union_with_custom_projection(bool isAsync);

+        public virtual Task Where_concat_string_int_comparison4(bool isAsync);
+        public virtual Task Where_concat_string_string_comparison(bool isAsync);
-        public virtual Task Where_de_morgan_and_optimizated(bool isAsync);

+        public virtual Task Where_de_morgan_and_optimized(bool isAsync);
-        public virtual Task Where_de_morgan_or_optimizated(bool isAsync);

+        public virtual Task Where_de_morgan_or_optimized(bool isAsync);
+        public virtual Task Where_is_conditional(bool isAsync);
+        public virtual Task Where_new_instance_field_access_query_cache(bool isAsync);
-        public virtual Task Where_OrderBy_Count_client_eval_mixed(bool isAsync);

+        public virtual Task Where_Property_when_shadow_unconstrained_generic_method(bool isAsync);
-        public virtual Task Where_Property_when_shaow_unconstrained_generic_method(bool isAsync);

+        public virtual Task Where_query_composition_entity_equality_multiple_elements_First(bool isAsync);
+        public virtual Task Where_query_composition_entity_equality_multiple_elements_Single(bool isAsync);
-        public virtual void Where_query_composition_entity_equality_multiple_elements_SingleOrDefault();

+        public virtual Task Where_query_composition_entity_equality_multiple_elements_SingleOrDefault(bool isAsync);
+        public virtual Task Where_query_composition_entity_equality_no_elements_First(bool isAsync);
-        public virtual void Where_query_composition_entity_equality_no_elements_Single();

+        public virtual Task Where_query_composition_entity_equality_no_elements_Single(bool isAsync);
+        public virtual Task Where_query_composition_entity_equality_one_element_First(bool isAsync);
+        public virtual Task Where_query_composition_entity_equality_one_element_Single(bool isAsync);
+        public virtual Task Where_string_concat_method_comparison(bool isAsync);
+        public struct MyStruct {
+            public int X;
+            public int Y;
+        }
     }
     public abstract class SpatialQueryFixtureBase : SharedStoreFixtureBase<SpatialContext>, IQueryFixtureBase {
-        public virtual IGeometryFactory GeometryFactory { get; }
+        public virtual GeometryFactory GeometryFactory { get; }
     }
     public abstract class SpatialQueryTestBase<TFixture> : QueryTestBase<TFixture> where TFixture : SpatialQueryFixtureBase, new() {
-        public virtual Task Distance_concrete(bool isAsync);

+        public virtual Task Distance_on_converted_geometry_type_lhs(bool isAsync);
-        public virtual Task SRID_concrete(bool isAsync);

     }
+    public class SqlExpressionFactory : ISqlExpressionFactory {
+        public SqlExpressionFactory(SqlExpressionFactoryDependencies dependencies);
+        public virtual SqlBinaryExpression Add(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        public virtual SqlBinaryExpression And(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        public virtual SqlBinaryExpression AndAlso(SqlExpression left, SqlExpression right);
+        public virtual SqlExpression ApplyDefaultTypeMapping(SqlExpression sqlExpression);
+        public virtual SqlExpression ApplyTypeMapping(SqlExpression sqlExpression, RelationalTypeMapping typeMapping);
+        public virtual CaseExpression Case(SqlExpression operand, params CaseWhenClause[] whenClauses);
+        public virtual CaseExpression Case(SqlExpression operand, SqlExpression elseResult, params CaseWhenClause[] whenClauses);
+        public virtual CaseExpression Case(IReadOnlyList<CaseWhenClause> whenClauses, SqlExpression elseResult);
+        public virtual SqlBinaryExpression Coalesce(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        public virtual SqlConstantExpression Constant(object value, RelationalTypeMapping typeMapping = null);
+        public virtual SqlUnaryExpression Convert(SqlExpression operand, Type type, RelationalTypeMapping typeMapping = null);
+        public virtual SqlBinaryExpression Divide(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        public virtual SqlBinaryExpression Equal(SqlExpression left, SqlExpression right);
+        public virtual ExistsExpression Exists(SelectExpression subquery, bool negated);
+        public virtual RelationalTypeMapping FindMapping(Type type);
+        public virtual SqlFragmentExpression Fragment(string sql);
+        public virtual SqlFunctionExpression Function(SqlExpression instance, string name, IEnumerable<SqlExpression> arguments, Type returnType, RelationalTypeMapping typeMapping = null);
+        public virtual SqlFunctionExpression Function(SqlExpression instance, string name, Type returnType, RelationalTypeMapping typeMapping = null);
+        public virtual SqlFunctionExpression Function(string name, IEnumerable<SqlExpression> arguments, Type returnType, RelationalTypeMapping typeMapping = null);
+        public virtual SqlFunctionExpression Function(string schema, string name, IEnumerable<SqlExpression> arguments, Type returnType, RelationalTypeMapping typeMapping = null);
+        public virtual SqlFunctionExpression Function(string schema, string name, Type returnType, RelationalTypeMapping typeMapping = null);
+        public virtual SqlFunctionExpression Function(string name, Type returnType, RelationalTypeMapping typeMapping = null);
+        public virtual RelationalTypeMapping GetTypeMappingForValue(object value);
+        public virtual SqlBinaryExpression GreaterThan(SqlExpression left, SqlExpression right);
+        public virtual SqlBinaryExpression GreaterThanOrEqual(SqlExpression left, SqlExpression right);
+        public virtual InExpression In(SqlExpression item, SelectExpression subquery, bool negated);
+        public virtual InExpression In(SqlExpression item, SqlExpression values, bool negated);
+        public virtual SqlUnaryExpression IsNotNull(SqlExpression operand);
+        public virtual SqlUnaryExpression IsNull(SqlExpression operand);
+        public virtual SqlBinaryExpression LessThan(SqlExpression left, SqlExpression right);
+        public virtual SqlBinaryExpression LessThanOrEqual(SqlExpression left, SqlExpression right);
+        public virtual LikeExpression Like(SqlExpression match, SqlExpression pattern, SqlExpression escapeChar = null);
+        public virtual SqlBinaryExpression MakeBinary(ExpressionType operatorType, SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping);
+        public virtual SqlUnaryExpression MakeUnary(ExpressionType operatorType, SqlExpression operand, Type type, RelationalTypeMapping typeMapping = null);
+        public virtual SqlBinaryExpression Modulo(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        public virtual SqlBinaryExpression Multiply(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        public virtual SqlUnaryExpression Negate(SqlExpression operand);
+        public virtual SqlUnaryExpression Not(SqlExpression operand);
+        public virtual SqlBinaryExpression NotEqual(SqlExpression left, SqlExpression right);
+        public virtual SqlBinaryExpression Or(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+        public virtual SqlBinaryExpression OrElse(SqlExpression left, SqlExpression right);
+        public virtual SelectExpression Select(IEntityType entityType);
+        public virtual SelectExpression Select(IEntityType entityType, string sql, Expression sqlArguments);
+        public virtual SelectExpression Select(SqlExpression projection);
+        public virtual SqlBinaryExpression Subtract(SqlExpression left, SqlExpression right, RelationalTypeMapping typeMapping = null);
+    }
+    public sealed class SqlExpressionFactoryDependencies {
+        public SqlExpressionFactoryDependencies(IRelationalTypeMappingSource typeMappingSource);
+        public IRelationalTypeMappingSource TypeMappingSource { get; }
+        public SqlExpressionFactoryDependencies With(IRelationalTypeMappingSource typeMappingSource);
+    }
+    public abstract class SqlExpressionVisitor : ExpressionVisitor {
+        protected SqlExpressionVisitor();
+        protected abstract Expression VisitCase(CaseExpression caseExpression);
+        protected abstract Expression VisitColumn(ColumnExpression columnExpression);
+        protected abstract Expression VisitCrossApply(CrossApplyExpression crossApplyExpression);
+        protected abstract Expression VisitCrossJoin(CrossJoinExpression crossJoinExpression);
+        protected abstract Expression VisitExcept(ExceptExpression exceptExpression);
+        protected abstract Expression VisitExists(ExistsExpression existsExpression);
+        protected override Expression VisitExtension(Expression extensionExpression);
+        protected abstract Expression VisitFromSql(FromSqlExpression fromSqlExpression);
+        protected abstract Expression VisitIn(InExpression inExpression);
+        protected abstract Expression VisitInnerJoin(InnerJoinExpression innerJoinExpression);
+        protected abstract Expression VisitIntersect(IntersectExpression intersectExpression);
+        protected abstract Expression VisitLeftJoin(LeftJoinExpression leftJoinExpression);
+        protected abstract Expression VisitLike(LikeExpression likeExpression);
+        protected abstract Expression VisitOrdering(OrderingExpression orderingExpression);
+        protected abstract Expression VisitOuterApply(OuterApplyExpression outerApplyExpression);
+        protected abstract Expression VisitProjection(ProjectionExpression projectionExpression);
+        protected abstract Expression VisitRowNumber(RowNumberExpression rowNumberExpression);
+        protected abstract Expression VisitSelect(SelectExpression selectExpression);
+        protected abstract Expression VisitSqlBinary(SqlBinaryExpression sqlBinaryExpression);
+        protected abstract Expression VisitSqlConstant(SqlConstantExpression sqlConstantExpression);
+        protected abstract Expression VisitSqlFragment(SqlFragmentExpression sqlFragmentExpression);
+        protected abstract Expression VisitSqlFunction(SqlFunctionExpression sqlFunctionExpression);
+        protected abstract Expression VisitSqlParameter(SqlParameterExpression sqlParameterExpression);
+        protected abstract Expression VisitSqlUnary(SqlUnaryExpression sqlCastExpression);
+        protected abstract Expression VisitSubSelect(ScalarSubqueryExpression scalarSubqueryExpression);
+        protected abstract Expression VisitTable(TableExpression tableExpression);
+        protected abstract Expression VisitUnion(UnionExpression unionExpression);
+    }
+    public static class TransparentIdentifierFactory {
+        public static Type Create(Type outerType, Type innerType);
+    }
     public abstract class UdfDbFunctionTestBase<TFixture> : IClassFixture<TFixture> where TFixture : SharedStoreFixtureBase<DbContext>, new() {
+        public static Exception AssertThrows<T>(Func<object> testCode) where T : Exception, new();
         public abstract class UdfFixtureBase : SharedStoreFixtureBase<DbContext> {
-            public override DbContextOptionsBuilder AddOptions(DbContextOptionsBuilder builder);

         }
     }
     public abstract class WarningsTestBase<TFixture> : IClassFixture<TFixture> where TFixture : NorthwindQueryRelationalFixture<NoopModelCustomizer>, new() {
-        public virtual void LastOrDefault_without_order_by_issues_client_eval_warning();

-        public virtual void Last_without_order_by_issues_client_eval_warning();

-        public virtual void Last_with_order_by_issues_client_eval_warning_in_subquery();

-        public virtual void Throws_when_warning_as_error();

     }
 }
```

