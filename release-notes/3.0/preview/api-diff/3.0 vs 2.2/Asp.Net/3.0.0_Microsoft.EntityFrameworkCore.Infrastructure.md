# Microsoft.EntityFrameworkCore.Infrastructure

``` diff
 namespace Microsoft.EntityFrameworkCore.Infrastructure {
     public class Annotatable : IAnnotatable, IMutableAnnotatable {
-        public virtual Annotation GetOrAddAnnotation(string name, object value);

+        IAnnotation Microsoft.EntityFrameworkCore.Metadata.IMutableAnnotatable.AddAnnotation(string name, object value);
+        IAnnotation Microsoft.EntityFrameworkCore.Metadata.IMutableAnnotatable.RemoveAnnotation(string name);
-        protected virtual Annotation SetAnnotation(string name, Annotation annotation);

+        protected virtual Annotation SetAnnotation(string name, Annotation annotation, Annotation oldAnnotation);
     }
-    public class CoreOptionsExtension : IDbContextOptionsExtension, IDbContextOptionsExtensionWithDebugInfo {
+    public class CoreOptionsExtension : IDbContextOptionsExtension {
+        public virtual DbContextOptionsExtensionInfo Info { get; }
+        public virtual IEnumerable<IInterceptor> Interceptors { get; }
-        public virtual string LogFragment { get; }

-        public virtual int? MaxPoolSize { get; }
+        public virtual Nullable<int> MaxPoolSize { get; }
+        public virtual bool ServiceProviderCachingEnabled { get; }
-        public virtual bool ApplyServices(IServiceCollection services);

+        public virtual void ApplyServices(IServiceCollection services);
-        public virtual long GetServiceProviderHashCode();

-        public virtual void PopulateDebugInfo(IDictionary<string, string> debugInfo);

+        public virtual CoreOptionsExtension WithInterceptors(IEnumerable<IInterceptor> interceptors);
-        public virtual CoreOptionsExtension WithMaxPoolSize(int? maxPoolSize);
+        public virtual CoreOptionsExtension WithMaxPoolSize(Nullable<int> maxPoolSize);
+        public virtual CoreOptionsExtension WithServiceProviderCachingEnabled(bool serviceProviderCachingEnabled);
     }
-    public class DatabaseFacade : IInfrastructure<IServiceProvider> {
+    public class DatabaseFacade : IDatabaseFacadeDependenciesAccessor, IInfrastructure<IServiceProvider> {
-        IServiceProvider Microsoft.EntityFrameworkCore.Infrastructure.IInfrastructure<System.IServiceProvider>.Instance { get; }

+        DbContext Microsoft.EntityFrameworkCore.Internal.IDatabaseFacadeDependenciesAccessor.Context { get; }
+        IDatabaseFacadeDependencies Microsoft.EntityFrameworkCore.Internal.IDatabaseFacadeDependenciesAccessor.Dependencies { get; }
     }
-    public class DbContextFactoryOptions {
 {
-        public DbContextFactoryOptions();

-        public virtual string ApplicationBasePath { get; set; }

-        public virtual string ContentRootPath { get; set; }

-        public virtual string EnvironmentName { get; set; }

-    }
+    public abstract class DbContextOptionsExtensionInfo {
+        protected DbContextOptionsExtensionInfo(IDbContextOptionsExtension extension);
+        public virtual IDbContextOptionsExtension Extension { get; }
+        public abstract bool IsDatabaseProvider { get; }
+        public abstract string LogFragment { get; }
+        public abstract long GetServiceProviderHashCode();
+        public abstract void PopulateDebugInfo(IDictionary<string, string> debugInfo);
+    }
+    public sealed class EntityFrameworkInternalAttribute : Attribute {
+        public EntityFrameworkInternalAttribute();
+    }
-    public static class EntityFrameworkServiceCollectionExtensions {
 {
-        public static IServiceCollection AddEntityFramework(this IServiceCollection serviceCollection);

-    }
+    public static class ExpressionExtensions {
+        public static Expression Assign(this MemberExpression memberExpression, Expression valueExpression);
+        public static PropertyInfo GetPropertyAccess(this LambdaExpression propertyAccessExpression);
+        public static IReadOnlyList<PropertyInfo> GetPropertyAccessList(this LambdaExpression propertyAccessExpression);
+        public static MemberExpression MakeMemberAccess(this Expression expression, MemberInfo member);
+        public static string Print(this Expression expression, Nullable<int> characterLimit = default(Nullable<int>));
+        public static Expression RemoveConvert(this Expression expression);
+        public static bool TryGetEFPropertyArguments(this MethodCallExpression methodCallExpression, out Expression entityExpression, out string propertyName);
+    }
+    public interface IConcurrencyDetector {
+        IDisposable EnterCriticalSection();
+    }
+    public interface ICurrentDbContext {
+        DbContext Context { get; }
+    }
-    public interface IDbContextFactory<out TContext> where TContext : DbContext {
 {
-        TContext Create(DbContextFactoryOptions options);

-    }
     public interface IDbContextOptionsExtension {
+        DbContextOptionsExtensionInfo Info { get; }
-        string LogFragment { get; }

-        bool ApplyServices(IServiceCollection services);

+        void ApplyServices(IServiceCollection services);
-        long GetServiceProviderHashCode();

     }
-    public interface IDbContextOptionsExtensionWithDebugInfo : IDbContextOptionsExtension {
 {
-        void PopulateDebugInfo(IDictionary<string, string> debugInfo);

-    }
-    public interface ILazyLoader {
+    public interface ILazyLoader : IDisposable {
+        void SetLoaded(object entity, string navigationName = "", bool loaded = true);
     }
     public interface IModelSource {
+        IModel GetModel(DbContext context, IConventionSetBuilder conventionSetBuilder);
-        IModel GetModel(DbContext context, IConventionSetBuilder conventionSetBuilder, IModelValidator validator);

     }
     public interface IModelValidator {
-        void Validate(IModel model);

+        void Validate(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
     }
     public interface IResettableService {
+        Task ResetStateAsync(CancellationToken cancellationToken = default(CancellationToken));
     }
+    public static class MethodInfoExtensions {
+        public static bool IsEFPropertyMethod(this MethodInfo methodInfo);
+    }
     public class ModelCustomizer : IModelCustomizer {
-        protected virtual void FindSets(ModelBuilder modelBuilder, DbContext context);

     }
     public class ModelSource : IModelSource {
-        protected virtual ConventionSet CreateConventionSet(IConventionSetBuilder conventionSetBuilder);

+        protected virtual IModel CreateModel(DbContext context, IConventionSetBuilder conventionSetBuilder);
-        protected virtual IModel CreateModel(DbContext context, IConventionSetBuilder conventionSetBuilder, IModelValidator validator);

+        public virtual IModel GetModel(DbContext context, IConventionSetBuilder conventionSetBuilder);
-        public virtual IModel GetModel(DbContext context, IConventionSetBuilder conventionSetBuilder, IModelValidator validator);

     }
     public sealed class ModelSourceDependencies {
+        public ModelSourceDependencies(IModelCustomizer modelCustomizer, IModelCacheKeyFactory modelCacheKeyFactory);
-        public ModelSourceDependencies(ICoreConventionSetBuilder coreConventionSetBuilder, IModelCustomizer modelCustomizer, IModelCacheKeyFactory modelCacheKeyFactory);

-        public ICoreConventionSetBuilder CoreConventionSetBuilder { get; }

-        public ModelSourceDependencies With(ICoreConventionSetBuilder coreConventionSetBuilder);

     }
     public class ModelValidator : IModelValidator {
-        protected virtual void LogShadowProperties(IModel model);

+        protected virtual void LogShadowProperties(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        public virtual void Validate(IModel model);

+        public virtual void Validate(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateChangeTrackingStrategy(IModel model);

+        protected virtual void ValidateChangeTrackingStrategy(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateClrInheritance(IModel model);

+        protected virtual void ValidateClrInheritance(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateClrInheritance(IModel model, IEntityType entityType, HashSet<IEntityType> validEntityTypes);

-        protected virtual void ValidateData(IModel model);

+        protected virtual void ValidateData(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateDefiningNavigations(IModel model);

+        protected virtual void ValidateDefiningNavigations(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
+        protected virtual void ValidateDefiningQuery(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
+        protected virtual void ValidateDiscriminatorValues(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateFieldMapping(IModel model);

+        protected virtual void ValidateFieldMapping(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateForeignKeys(IModel model);

+        protected virtual void ValidateForeignKeys(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
+        protected virtual void ValidateIgnoredMembers(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
+        protected virtual void ValidateKeylessTypes(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateNoCycles(IModel model);

+        protected virtual void ValidateNoCycles(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateNoMutableKeys(IModel model);

+        protected virtual void ValidateNoMutableKeys(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateNonNullPrimaryKeys(IModel model);

+        protected virtual void ValidateNonNullPrimaryKeys(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateNoShadowEntities(IModel model);

+        protected virtual void ValidateNoShadowEntities(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateNoShadowKeys(IModel model);

+        protected virtual void ValidateNoShadowKeys(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateOwnership(IModel model);

+        protected virtual void ValidateOwnership(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
+        protected virtual void ValidatePropertyMapping(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateQueryFilters(IModel model);

+        protected virtual void ValidateQueryFilters(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateQueryTypes(IModel model);

+        protected virtual void ValidateRelationships(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
     }
     public sealed class ModelValidatorDependencies {
-        public ModelValidatorDependencies(IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger, IDiagnosticsLogger<DbLoggerCategory.Model> modelLogger);

+        public ModelValidatorDependencies(ITypeMappingSource typeMappingSource, IMemberClassifier memberClassifier);
-        public IDiagnosticsLogger<DbLoggerCategory.Model.Validation> Logger { get; }

+        public IMemberClassifier MemberClassifier { get; }
-        public IDiagnosticsLogger<DbLoggerCategory.Model> ModelLogger { get; }

+        public ITypeMappingSource TypeMappingSource { get; }
-        public ModelValidatorDependencies With(IDiagnosticsLogger<DbLoggerCategory.Model> modelLogger);

-        public ModelValidatorDependencies With(IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);

+        public ModelValidatorDependencies With(IMemberClassifier memberClassifier);
+        public ModelValidatorDependencies With(ITypeMappingSource typeMappingSource);
     }
+    public static class ProductInfo {
+        public static string GetVersion();
+    }
     public abstract class RelationalDbContextOptionsBuilder<TBuilder, TExtension> : IRelationalDbContextOptionsBuilderInfrastructure where TBuilder : RelationalDbContextOptionsBuilder<TBuilder, TExtension> where TExtension : RelationalOptionsExtension, new() {
-        public virtual TBuilder CommandTimeout(int? commandTimeout);
+        public virtual TBuilder CommandTimeout(Nullable<int> commandTimeout);
     }
     public class RelationalModelCustomizer : ModelCustomizer {
-        public override void Customize(ModelBuilder modelBuilder, DbContext context);

-        protected virtual void FindDbFunctions(ModelBuilder modelBuilder, DbContext context);

-        protected override void FindSets(ModelBuilder modelBuilder, DbContext context);

     }
     public class RelationalModelValidator : ModelValidator {
-        protected virtual IRelationalTypeMapper TypeMapper { get; }

-        public override void Validate(IModel model);

+        public override void Validate(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateBoolsWithDefaults(IModel model);

+        protected virtual void ValidateBoolsWithDefaults(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateDataTypes(IModel model);

-        protected virtual void ValidateDbFunctions(IModel model);

+        protected virtual void ValidateDbFunctions(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateDefaultValuesOnKeys(IModel model);

+        protected virtual void ValidateDefaultValuesOnKeys(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateInheritanceMapping(IModel model);

+        protected virtual void ValidateInheritanceMapping(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateSharedColumnsCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName);

+        protected virtual void ValidateSharedColumnsCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateSharedForeignKeysCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName);

+        protected virtual void ValidateSharedForeignKeysCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateSharedIndexesCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName);

+        protected virtual void ValidateSharedIndexesCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateSharedKeysCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName);

+        protected virtual void ValidateSharedKeysCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateSharedTableCompatibility(IModel model);

+        protected virtual void ValidateSharedTableCompatibility(IModel model, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
-        protected virtual void ValidateSharedTableCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName);

+        protected virtual void ValidateSharedTableCompatibility(IReadOnlyList<IEntityType> mappedTypes, string tableName, IDiagnosticsLogger<DbLoggerCategory.Model.Validation> logger);
     }
     public sealed class RelationalModelValidatorDependencies {
-        public RelationalModelValidatorDependencies(IRelationalTypeMapper typeMapper, IRelationalTypeMappingSource typeMappingSource);

+        public RelationalModelValidatorDependencies(IRelationalTypeMappingSource typeMappingSource);
-        public IRelationalTypeMapper TypeMapper { get; }

-        public RelationalModelValidatorDependencies With(IRelationalTypeMapper typeMapper);

     }
     public abstract class RelationalOptionsExtension : IDbContextOptionsExtension {
-        public virtual int? CommandTimeout { get; }
+        public virtual Nullable<int> CommandTimeout { get; }
+        public abstract DbContextOptionsExtensionInfo Info { get; }
-        public virtual string LogFragment { get; }

-        public virtual int? MaxBatchSize { get; }
+        public virtual Nullable<int> MaxBatchSize { get; }
-        public virtual int? MinBatchSize { get; }
+        public virtual Nullable<int> MinBatchSize { get; }
-        public abstract bool ApplyServices(IServiceCollection services);

+        public abstract void ApplyServices(IServiceCollection services);
-        public virtual long GetServiceProviderHashCode();

-        public virtual RelationalOptionsExtension WithCommandTimeout(int? commandTimeout);
+        public virtual RelationalOptionsExtension WithCommandTimeout(Nullable<int> commandTimeout);
-        public virtual RelationalOptionsExtension WithMaxBatchSize(int? maxBatchSize);
+        public virtual RelationalOptionsExtension WithMaxBatchSize(Nullable<int> maxBatchSize);
-        public virtual RelationalOptionsExtension WithMinBatchSize(int? minBatchSize);
+        public virtual RelationalOptionsExtension WithMinBatchSize(Nullable<int> minBatchSize);
+        protected abstract class RelationalExtensionInfo : DbContextOptionsExtensionInfo {
+            protected RelationalExtensionInfo(IDbContextOptionsExtension extension);
+            public virtual new RelationalOptionsExtension Extension { get; }
+            public override bool IsDatabaseProvider { get; }
+            public override string LogFragment { get; }
+            public override long GetServiceProviderHashCode();
+        }
     }
+    public static class RelationalPropertyExtensions {
+        public static string FormatColumns(this IEnumerable<IProperty> properties);
+    }
     public class SqliteDbContextOptionsBuilder : RelationalDbContextOptionsBuilder<SqliteDbContextOptionsBuilder, SqliteOptionsExtension> {
-        public virtual SqliteDbContextOptionsBuilder SuppressForeignKeyEnforcement(bool suppressForeignKeyEnforcement = true);

     }
     public class SqlServerDbContextOptionsBuilder : RelationalDbContextOptionsBuilder<SqlServerDbContextOptionsBuilder, SqlServerOptionsExtension> {
-        public virtual void UseRowNumberForPaging(bool useRowNumberForPaging = true);

+        public virtual SqlServerDbContextOptionsBuilder UseRowNumberForPaging(bool useRowNumberForPaging = true);
     }
+    public static class TypeExtensions {
+        public static string ShortDisplayName(this Type type);
+    }
+    public static class Uniquifier {
+        public static string Truncate(string identifier, int maxLength, Nullable<int> uniquifier = default(Nullable<int>));
+        public static string Uniquify<T>(string currentIdentifier, IReadOnlyDictionary<string, T> otherIdentifiers, int maxLength);
+        public static string Uniquify<TKey, TValue>(string currentIdentifier, IReadOnlyDictionary<TKey, TValue> otherIdentifiers, Func<string, TKey> keySelector, int maxLength);
+    }
 }
```

