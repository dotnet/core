# Microsoft.EntityFrameworkCore.Update.Internal

``` diff
 namespace Microsoft.EntityFrameworkCore.Update.Internal {
     public class BatchExecutor : IBatchExecutor {
+        public BatchExecutor(ICurrentDbContext currentContext, IExecutionStrategyFactory executionStrategyFactory);
-        public BatchExecutor(ICurrentDbContext currentContext, IExecutionStrategyFactory executionStrategyFactory);

     }
     public class CommandBatchPreparer : ICommandBatchPreparer {
+        public virtual IEnumerable<ModificationCommandBatch> BatchCommands(IList<IUpdateEntry> entries, IUpdateAdapter updateAdapter);
-        public virtual IEnumerable<ModificationCommandBatch> BatchCommands(IReadOnlyList<IUpdateEntry> entries);

+        protected virtual IEnumerable<ModificationCommand> CreateModificationCommands(IList<IUpdateEntry> entries, IUpdateAdapter updateAdapter, Func<string> generateParameterName);
-        protected virtual IEnumerable<ModificationCommand> CreateModificationCommands(IReadOnlyList<IUpdateEntry> entries, Func<string> generateParameterName);

     }
     public sealed class CommandBatchPreparerDependencies {
+        public CommandBatchPreparerDependencies(IModificationCommandBatchFactory modificationCommandBatchFactory, IParameterNameGeneratorFactory parameterNameGeneratorFactory, IComparer<ModificationCommand> modificationCommandComparer, IKeyValueIndexFactorySource keyValueIndexFactorySource, ILoggingOptions loggingOptions, IDiagnosticsLogger<DbLoggerCategory.Update> updateLogger, IDbContextOptions options);
-        public CommandBatchPreparerDependencies(IModificationCommandBatchFactory modificationCommandBatchFactory, IParameterNameGeneratorFactory parameterNameGeneratorFactory, IComparer<ModificationCommand> modificationCommandComparer, IKeyValueIndexFactorySource keyValueIndexFactorySource, Func<IStateManager> stateManager, ILoggingOptions loggingOptions, IDiagnosticsLogger<DbLoggerCategory.Update> updateLogger, IDbContextOptions options);

-        public Func<IStateManager> StateManager { get; }

-        public CommandBatchPreparerDependencies With(Func<IStateManager> stateManager);

     }
-    public interface ISingletonUpdateSqlGenerator

     public class SharedTableEntryMap<TValue> {
-        public SharedTableEntryMap(IStateManager stateManager, IReadOnlyDictionary<IEntityType, IReadOnlyList<IEntityType>> principals, IReadOnlyDictionary<IEntityType, IReadOnlyList<IEntityType>> dependents, string name, string schema, SharedTableEntryValueFactory<TValue> createElement);

+        public SharedTableEntryMap(IUpdateAdapter updateAdapter, IReadOnlyDictionary<IEntityType, IReadOnlyList<IEntityType>> principals, IReadOnlyDictionary<IEntityType, IReadOnlyList<IEntityType>> dependents, string name, string schema, SharedTableEntryValueFactory<TValue> createElement);
-        public static Dictionary<ValueTuple<string, string>, SharedTableEntryMapFactory<TValue>> CreateSharedTableEntryMapFactories(IModel model, IStateManager stateManager);

+        public static Dictionary<ValueTuple<string, string>, SharedTableEntryMapFactory<TValue>> CreateSharedTableEntryMapFactories(IModel model, IUpdateAdapter updateAdapter);
-        public static SharedTableEntryMapFactory<TValue> CreateSharedTableEntryMapFactory(IReadOnlyList<IEntityType> entityTypes, IStateManager stateManager, string tableName, string schema);

+        public static SharedTableEntryMapFactory<TValue> CreateSharedTableEntryMapFactory(IReadOnlyList<IEntityType> entityTypes, IUpdateAdapter updateAdapter, string tableName, string schema);
+        public virtual IReadOnlyList<IUpdateEntry> GetAllEntries(IUpdateEntry entry);
     }
+    public class UpdateAdapter : IUpdateAdapter {
+        public UpdateAdapter(IStateManager stateManager);
+        public virtual CascadeTiming CascadeDeleteTiming { get; set; }
+        public virtual CascadeTiming DeleteOrphansTiming { get; set; }
+        public virtual IEnumerable<IUpdateEntry> Entries { get; }
+        public virtual IModel Model { get; }
+        public virtual void CascadeChanges();
+        public virtual void CascadeDelete(IUpdateEntry entry, IEnumerable<IForeignKey> foreignKeys = null);
+        public virtual IUpdateEntry CreateEntry(IDictionary<string, object> values, IEntityType entityType);
+        public virtual void DetectChanges();
+        public virtual IUpdateEntry FindPrincipal(IUpdateEntry dependentEntry, IForeignKey foreignKey);
+        public virtual IEnumerable<IUpdateEntry> GetDependents(IUpdateEntry principalEntry, IForeignKey foreignKey);
+        public virtual IList<IUpdateEntry> GetEntriesToSave();
+        public virtual IUpdateEntry TryGetEntry(IKey key, object[] keyValues);
+    }
+    public class UpdateAdapterFactory : IUpdateAdapterFactory {
+        public UpdateAdapterFactory(ICurrentDbContext currentContext);
+        public virtual IUpdateAdapter Create();
+        public virtual IUpdateAdapter CreateStandalone(IModel model = null);
+    }
-    public static class UpdateEntryExtensions {
 {
-        public static string BuildCurrentValuesString(this IUpdateEntry entry, IEnumerable<IPropertyBase> properties);

-        public static string BuildOriginalValuesString(this IUpdateEntry entry, IEnumerable<IPropertyBase> properties);

-    }
 }
```

