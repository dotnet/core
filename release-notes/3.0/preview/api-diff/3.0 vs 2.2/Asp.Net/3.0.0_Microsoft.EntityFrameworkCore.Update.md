# Microsoft.EntityFrameworkCore.Update

``` diff
 namespace Microsoft.EntityFrameworkCore.Update {
     public abstract class AffectedCountModificationCommandBatch : ReaderModificationCommandBatch {
-        protected AffectedCountModificationCommandBatch(IRelationalCommandBuilderFactory commandBuilderFactory, ISqlGenerationHelper sqlGenerationHelper, IUpdateSqlGenerator updateSqlGenerator, IRelationalValueBufferFactoryFactory valueBufferFactoryFactory);

+        protected AffectedCountModificationCommandBatch(ModificationCommandBatchFactoryDependencies dependencies);
     }
     public class ColumnModification {
-        public ColumnModification(IUpdateEntry entry, IProperty property, IRelationalPropertyAnnotations propertyAnnotations, Func<string> generateParameterName, bool isRead, bool isWrite, bool isKey, bool isCondition, bool isConcurrencyToken);

+        public ColumnModification(IUpdateEntry entry, IProperty property, Func<string> generateParameterName, bool isRead, bool isWrite, bool isKey, bool isCondition, bool isConcurrencyToken, bool sensitiveLoggingEnabled);
-        public ColumnModification(string columnName, object originalValue, object value, IProperty property, bool isRead, bool isWrite, bool isKey, bool isCondition);

+        public ColumnModification(string columnName, object originalValue, object value, IProperty property, bool isRead, bool isWrite, bool isKey, bool isCondition, bool sensitiveLoggingEnabled);
+        public virtual void AddSharedColumnModification(ColumnModification modification);
     }
     public interface ICommandBatchPreparer {
+        IEnumerable<ModificationCommandBatch> BatchCommands(IList<IUpdateEntry> entries, IUpdateAdapter updateAdapter);
-        IEnumerable<ModificationCommandBatch> BatchCommands(IReadOnlyList<IUpdateEntry> entries);

     }
+    public interface IUpdateAdapter {
+        CascadeTiming CascadeDeleteTiming { get; set; }
+        CascadeTiming DeleteOrphansTiming { get; set; }
+        IEnumerable<IUpdateEntry> Entries { get; }
+        IModel Model { get; }
+        void CascadeChanges();
+        void CascadeDelete(IUpdateEntry entry, IEnumerable<IForeignKey> foreignKeys = null);
+        IUpdateEntry CreateEntry(IDictionary<string, object> values, IEntityType entityType);
+        void DetectChanges();
+        IUpdateEntry FindPrincipal(IUpdateEntry dependentEntry, IForeignKey foreignKey);
+        IEnumerable<IUpdateEntry> GetDependents(IUpdateEntry principalEntry, IForeignKey foreignKey);
+        IList<IUpdateEntry> GetEntriesToSave();
+        IUpdateEntry TryGetEntry(IKey key, object[] keyValues);
+    }
+    public interface IUpdateAdapterFactory {
+        IUpdateAdapter Create();
+        IUpdateAdapter CreateStandalone(IModel model = null);
+    }
     public interface IUpdateEntry {
-        EntityState EntityState { get; }
+        EntityState EntityState { get; set; }
-        void SetCurrentValue(IPropertyBase propertyBase, object value);

+        void SetOriginalValue(IProperty property, object value);
+        void SetPropertyModified(IProperty property);
+        void SetStoreGeneratedValue(IProperty property, object value);
     }
-    public interface IUpdateSqlGenerator : ISingletonUpdateSqlGenerator
+    public interface IUpdateSqlGenerator
     public class ModificationCommand {
-        public ModificationCommand(string name, string schema, IReadOnlyList<ColumnModification> columnModifications);

+        public ModificationCommand(string name, string schema, IReadOnlyList<ColumnModification> columnModifications, bool sensitiveLoggingEnabled);
     }
+    public sealed class ModificationCommandBatchFactoryDependencies {
+        public ModificationCommandBatchFactoryDependencies(IRelationalCommandBuilderFactory commandBuilderFactory, ISqlGenerationHelper sqlGenerationHelper, IUpdateSqlGenerator updateSqlGenerator, IRelationalValueBufferFactoryFactory valueBufferFactoryFactory, ICurrentDbContext currentContext, IDiagnosticsLogger<DbLoggerCategory.Database.Command> logger);
+        public IRelationalCommandBuilderFactory CommandBuilderFactory { get; }
+        public ICurrentDbContext CurrentContext { get; }
+        public IDiagnosticsLogger<DbLoggerCategory.Database.Command> Logger { get; }
+        public ISqlGenerationHelper SqlGenerationHelper { get; }
+        public IUpdateSqlGenerator UpdateSqlGenerator { get; }
+        public IRelationalValueBufferFactoryFactory ValueBufferFactoryFactory { get; }
+        public ModificationCommandBatchFactoryDependencies With(IDiagnosticsLogger<DbLoggerCategory.Database.Command> logger);
+        public ModificationCommandBatchFactoryDependencies With(ICurrentDbContext currentContext);
+        public ModificationCommandBatchFactoryDependencies With(IRelationalCommandBuilderFactory commandBuilderFactory);
+        public ModificationCommandBatchFactoryDependencies With(IRelationalValueBufferFactoryFactory valueBufferFactoryFactory);
+        public ModificationCommandBatchFactoryDependencies With(ISqlGenerationHelper sqlGenerationHelper);
+        public ModificationCommandBatchFactoryDependencies With(IUpdateSqlGenerator updateSqlGenerator);
+    }
     public abstract class ReaderModificationCommandBatch : ModificationCommandBatch {
-        protected ReaderModificationCommandBatch(IRelationalCommandBuilderFactory commandBuilderFactory, ISqlGenerationHelper sqlGenerationHelper, IUpdateSqlGenerator updateSqlGenerator, IRelationalValueBufferFactoryFactory valueBufferFactoryFactory);

+        protected ReaderModificationCommandBatch(ModificationCommandBatchFactoryDependencies dependencies);
+        public virtual ModificationCommandBatchFactoryDependencies Dependencies { get; }
-        protected virtual ISqlGenerationHelper SqlGenerationHelper { get; }

     }
     public class SingularModificationCommandBatch : AffectedCountModificationCommandBatch {
-        public SingularModificationCommandBatch(IRelationalCommandBuilderFactory commandBuilderFactory, ISqlGenerationHelper sqlGenerationHelper, IUpdateSqlGenerator updateSqlGenerator, IRelationalValueBufferFactoryFactory valueBufferFactoryFactory);

+        public SingularModificationCommandBatch(ModificationCommandBatchFactoryDependencies dependencies);
     }
+    public static class UpdateEntryExtensions {
+        public static string BuildCurrentValuesString(this IUpdateEntry entry, IEnumerable<IPropertyBase> properties);
+        public static string BuildOriginalValuesString(this IUpdateEntry entry, IEnumerable<IPropertyBase> properties);
+    }
-    public abstract class UpdateSqlGenerator : ISingletonUpdateSqlGenerator, IUpdateSqlGenerator
+    public abstract class UpdateSqlGenerator : IUpdateSqlGenerator
 }
```

