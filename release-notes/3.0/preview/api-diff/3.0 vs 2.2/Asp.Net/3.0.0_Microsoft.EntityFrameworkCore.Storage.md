# Microsoft.EntityFrameworkCore.Storage

``` diff
 namespace Microsoft.EntityFrameworkCore.Storage {
     public class BoolTypeMapping : RelationalTypeMapping {
-        public BoolTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public BoolTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
-    public class ByteArrayRelationalTypeMapper : IByteArrayRelationalTypeMapper {
 {
-        public ByteArrayRelationalTypeMapper(int maxBoundedLength, RelationalTypeMapping defaultMapping, RelationalTypeMapping unboundedMapping, RelationalTypeMapping keyMapping, RelationalTypeMapping rowVersionMapping, Func<int, RelationalTypeMapping> createBoundedMapping);

-        public virtual Func<int, RelationalTypeMapping> CreateBoundedMapping { get; }

-        public virtual RelationalTypeMapping DefaultMapping { get; }

-        public virtual RelationalTypeMapping KeyMapping { get; }

-        public virtual int MaxBoundedLength { get; }

-        public virtual RelationalTypeMapping RowVersionMapping { get; }

-        public virtual RelationalTypeMapping UnboundedMapping { get; }

-        public virtual RelationalTypeMapping FindMapping(bool rowVersion, bool keyOrIndex, int? size);

-    }
     public class ByteArrayTypeMapping : RelationalTypeMapping {
-        public ByteArrayTypeMapping(string storeType, DbType? dbType = default(DbType?), int? size = default(int?));
+        public ByteArrayTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>), Nullable<int> size = default(Nullable<int>));
     }
     public class ByteTypeMapping : RelationalTypeMapping {
-        public ByteTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public ByteTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class CharTypeMapping : RelationalTypeMapping {
-        public CharTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public CharTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
-        protected override string SqlLiteralFormatString { get; }

+        protected override string GenerateNonNullSqlLiteral(object value);
     }
-    public class CoreTypeMapper : ITypeMapper {
 {
-        public CoreTypeMapper(CoreTypeMapperDependencies dependencies);

-        protected virtual CoreTypeMapperDependencies Dependencies { get; }

-        public virtual bool IsTypeMapped(Type type);

-    }
-    public sealed class CoreTypeMapperDependencies {
 {
-        public CoreTypeMapperDependencies(IValueConverterSelector valueConverterSelector);

-        public IValueConverterSelector ValueConverterSelector { get; }

-        public CoreTypeMapperDependencies With(IValueConverterSelector valueConverterSelector);

-    }
     public abstract class CoreTypeMapping {
         protected readonly struct CoreTypeMappingParameters {
-            public CoreTypeMappingParameters(Type clrType, ValueConverter converter, ValueComparer comparer, ValueComparer keyComparer, ValueComparer structuralComparer, Func<IProperty, IEntityType, ValueGenerator> valueGeneratorFactory);
+            public CoreTypeMappingParameters(Type clrType, ValueConverter converter = null, ValueComparer comparer = null, ValueComparer keyComparer = null, ValueComparer structuralComparer = null, Func<IProperty, IEntityType, ValueGenerator> valueGeneratorFactory = null);
-            public CoreTypeMappingParameters(Type clrType, ValueConverter converter = null, ValueComparer comparer = null, ValueComparer keyComparer = null, Func<IProperty, IEntityType, ValueGenerator> valueGeneratorFactory = null);

         }
     }
     public abstract class Database : IDatabase {
-        public virtual Func<QueryContext, IAsyncEnumerable<TResult>> CompileAsyncQuery<TResult>(QueryModel queryModel);

-        public virtual Func<QueryContext, IEnumerable<TResult>> CompileQuery<TResult>(QueryModel queryModel);

+        public virtual Func<QueryContext, TResult> CompileQuery<TResult>(Expression query, bool async);
+        public abstract int SaveChanges(IList<IUpdateEntry> entries);
-        public abstract int SaveChanges(IReadOnlyList<IUpdateEntry> entries);

+        public abstract Task<int> SaveChangesAsync(IList<IUpdateEntry> entries, CancellationToken cancellationToken = default(CancellationToken));
-        public abstract Task<int> SaveChangesAsync(IReadOnlyList<IUpdateEntry> entries, CancellationToken cancellationToken = default(CancellationToken));

     }
     public sealed class DatabaseDependencies {
-        public DatabaseDependencies(IQueryCompilationContextFactory queryCompilationContextFactory);

+        public DatabaseDependencies(IQueryCompilationContextFactory queryCompilationContextFactory, IUpdateAdapterFactory updateAdapterFactory);
+        public IUpdateAdapterFactory UpdateAdapterFactory { get; }
+        public DatabaseDependencies With(IUpdateAdapterFactory updateAdapterFactory);
     }
     public class DateTimeOffsetTypeMapping : RelationalTypeMapping {
-        public DateTimeOffsetTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public DateTimeOffsetTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class DateTimeTypeMapping : RelationalTypeMapping {
-        public DateTimeTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public DateTimeTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class DecimalTypeMapping : RelationalTypeMapping {
-        public DecimalTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public DecimalTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class DoubleTypeMapping : RelationalTypeMapping {
-        public DoubleTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public DoubleTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public abstract class ExecutionStrategy : IExecutionStrategy {
-        protected virtual TimeSpan? GetNextDelay(Exception lastException);
+        protected virtual Nullable<TimeSpan> GetNextDelay(Exception lastException);
     }
     public sealed class ExecutionStrategyDependencies {
+        public ExecutionStrategyDependencies(ICurrentDbContext currentContext, IDbContextOptions options, IDiagnosticsLogger<DbLoggerCategory.Infrastructure> logger);
-        public ExecutionStrategyDependencies(ICurrentDbContext currentDbContext, IDbContextOptions options, IDiagnosticsLogger<DbLoggerCategory.Infrastructure> logger);

+        public ICurrentDbContext CurrentContext { get; }
-        public ICurrentDbContext CurrentDbContext { get; }

+        public ExecutionStrategyDependencies With(ICurrentDbContext currentContext);
-        public ExecutionStrategyDependencies With(ICurrentDbContext currentDbContext);

     }
     public class FloatTypeMapping : RelationalTypeMapping {
-        public FloatTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public FloatTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class GuidTypeMapping : RelationalTypeMapping {
-        public GuidTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public GuidTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
-    public interface IByteArrayRelationalTypeMapper {
 {
-        RelationalTypeMapping FindMapping(bool rowVersion, bool keyOrIndex, int? size);

-    }
     public interface IDatabase {
-        Func<QueryContext, IAsyncEnumerable<TResult>> CompileAsyncQuery<TResult>(QueryModel queryModel);

-        Func<QueryContext, IEnumerable<TResult>> CompileQuery<TResult>(QueryModel queryModel);

+        Func<QueryContext, TResult> CompileQuery<TResult>(Expression query, bool async);
+        int SaveChanges(IList<IUpdateEntry> entries);
-        int SaveChanges(IReadOnlyList<IUpdateEntry> entries);

+        Task<int> SaveChangesAsync(IList<IUpdateEntry> entries, CancellationToken cancellationToken = default(CancellationToken));
-        Task<int> SaveChangesAsync(IReadOnlyList<IUpdateEntry> entries, CancellationToken cancellationToken = default(CancellationToken));

     }
     public interface IDatabaseCreator {
+        bool CanConnect();
+        Task<bool> CanConnectAsync(CancellationToken cancellationToken = default(CancellationToken));
     }
-    public interface IDatabaseCreatorWithCanConnect : IDatabaseCreator {
 {
-        bool CanConnect();

-        Task<bool> CanConnectAsync(CancellationToken cancellationToken = default(CancellationToken));

-    }
-    public interface IDbContextTransaction : IDisposable {
+    public interface IDbContextTransaction : IAsyncDisposable, IDisposable {
+        Task CommitAsync(CancellationToken cancellationToken = default(CancellationToken));
+        Task RollbackAsync(CancellationToken cancellationToken = default(CancellationToken));
     }
     public class IntTypeMapping : RelationalTypeMapping {
-        public IntTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public IntTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public interface IRelationalCommand {
-        int ExecuteNonQuery(IRelationalConnection connection, IReadOnlyDictionary<string, object> parameterValues);

+        int ExecuteNonQuery(RelationalCommandParameterObject parameterObject);
-        Task<int> ExecuteNonQueryAsync(IRelationalConnection connection, IReadOnlyDictionary<string, object> parameterValues, CancellationToken cancellationToken = default(CancellationToken));

+        Task<int> ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default(CancellationToken));
-        RelationalDataReader ExecuteReader(IRelationalConnection connection, IReadOnlyDictionary<string, object> parameterValues);

+        RelationalDataReader ExecuteReader(RelationalCommandParameterObject parameterObject);
-        Task<RelationalDataReader> ExecuteReaderAsync(IRelationalConnection connection, IReadOnlyDictionary<string, object> parameterValues, CancellationToken cancellationToken = default(CancellationToken));

+        Task<RelationalDataReader> ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default(CancellationToken));
-        object ExecuteScalar(IRelationalConnection connection, IReadOnlyDictionary<string, object> parameterValues);

+        object ExecuteScalar(RelationalCommandParameterObject parameterObject);
-        Task<object> ExecuteScalarAsync(IRelationalConnection connection, IReadOnlyDictionary<string, object> parameterValues, CancellationToken cancellationToken = default(CancellationToken));

+        Task<object> ExecuteScalarAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default(CancellationToken));
     }
-    public interface IRelationalCommandBuilder : IInfrastructure<IndentedStringBuilder> {
+    public interface IRelationalCommandBuilder {
+        int CommandTextLength { get; }
-        IRelationalParameterBuilder ParameterBuilder { get; }

+        IReadOnlyList<IRelationalParameter> Parameters { get; }
+        IRelationalTypeMappingSource TypeMappingSource { get; }
+        IRelationalCommandBuilder AddParameter(IRelationalParameter parameter);
+        IRelationalCommandBuilder Append(object value);
+        IRelationalCommandBuilder AppendLine();
+        IRelationalCommandBuilder DecrementIndent();
+        IRelationalCommandBuilder IncrementIndent();
     }
-    public interface IRelationalConnection : IDbContextTransactionManager, IDisposable, IRelationalTransactionManager, IResettableService {
+    public interface IRelationalConnection : IAsyncDisposable, IDbContextTransactionManager, IDisposable, IRelationalTransactionManager, IResettableService {
-        int? CommandTimeout { get; set; }
+        Nullable<int> CommandTimeout { get; set; }
+        DbContext Context { get; }
+        Task<bool> CloseAsync();
-        void RegisterBufferable(IBufferable bufferable);

-        Task RegisterBufferableAsync(IBufferable bufferable, CancellationToken cancellationToken);

     }
     public interface IRelationalDatabaseCreator : IDatabaseCreator {
+        bool HasTables();
+        Task<bool> HasTablesAsync(CancellationToken cancellationToken = default(CancellationToken));
     }
-    public interface IRelationalParameterBuilder {
 {
-        IReadOnlyList<IRelationalParameter> Parameters { get; }

-        void AddCompositeParameter(string invariantName, Action<IRelationalParameterBuilder> buildAction);

-        void AddParameter(string invariantName, string name);

-        void AddParameter(string invariantName, string name, IProperty property);

-        void AddParameter(string invariantName, string name, RelationalTypeMapping typeMapping, bool nullable);

-        void AddPropertyParameter(string invariantName, string name, IProperty property);

-        void AddRawParameter(string invariantName, DbParameter dbParameter);

-    }
     public interface IRelationalTransactionFactory {
-        RelationalTransaction Create(IRelationalConnection connection, DbTransaction transaction, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> logger, bool transactionOwned);

+        RelationalTransaction Create(IRelationalConnection connection, DbTransaction transaction, Guid transactionId, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> logger, bool transactionOwned);
     }
     public interface IRelationalTransactionManager : IDbContextTransactionManager, IResettableService {
+        Task<IDbContextTransaction> UseTransactionAsync(DbTransaction transaction, CancellationToken cancellationToken = default(CancellationToken));
     }
-    public interface IRelationalTypeMapper : ITypeMapper {
 {
-        IByteArrayRelationalTypeMapper ByteArrayMapper { get; }

-        IStringRelationalTypeMapper StringMapper { get; }

-        RelationalTypeMapping FindMapping(IProperty property);

-        RelationalTypeMapping FindMapping(string storeType);

-        RelationalTypeMapping FindMapping(Type clrType);

-        void ValidateTypeName(string storeType);

-    }
     public interface IRelationalTypeMappingSource : ITypeMappingSource {
-        RelationalTypeMapping FindMapping(Type type, string storeTypeName, bool keyOrIndex = false, bool? unicode = default(bool?), int? size = default(int?), bool? rowVersion = default(bool?), bool? fixedLength = default(bool?), int? precision = default(int?), int? scale = default(int?));
+        RelationalTypeMapping FindMapping(Type type, string storeTypeName, bool keyOrIndex = false, Nullable<bool> unicode = default(Nullable<bool>), Nullable<int> size = default(Nullable<int>), Nullable<bool> rowVersion = default(Nullable<bool>), Nullable<bool> fixedLength = default(Nullable<bool>), Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
     }
     public interface IRelationalValueBufferFactoryFactory {
-        IRelationalValueBufferFactory Create(IReadOnlyList<Type> valueTypes, IReadOnlyList<int> indexMap);

     }
     public interface ISqlGenerationHelper {
+        string SingleLineCommentToken { get; }
-        string EscapeIdentifier(string identifier);

-        void EscapeIdentifier(StringBuilder builder, string identifier);

-        string EscapeLiteral(string literal);

-        void EscapeLiteral(StringBuilder builder, string literal);

+        string GenerateComment(string text);
     }
-    public interface IStringRelationalTypeMapper {
 {
-        RelationalTypeMapping FindMapping(bool unicode, bool keyOrIndex, int? maxLength);

-    }
-    public interface ITypeMapper {
 {
-        bool IsTypeMapped(Type clrType);

-    }
     public class LongTypeMapping : RelationalTypeMapping {
-        public LongTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public LongTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public readonly struct MaterializationContext {
-        public MaterializationContext(ValueBuffer valueBuffer);

     }
+    public class RelationalCommand : IRelationalCommand {
+        public RelationalCommand(RelationalCommandBuilderDependencies dependencies, string commandText, IReadOnlyList<IRelationalParameter> parameters);
+        public virtual string CommandText { get; }
+        protected virtual RelationalCommandBuilderDependencies Dependencies { get; }
+        public virtual IReadOnlyList<IRelationalParameter> Parameters { get; }
+        protected virtual DbCommand CreateCommand(RelationalCommandParameterObject parameterObject, Guid commandId, DbCommandMethod commandMethod);
+        public virtual int ExecuteNonQuery(RelationalCommandParameterObject parameterObject);
+        public virtual Task<int> ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default(CancellationToken));
+        public virtual RelationalDataReader ExecuteReader(RelationalCommandParameterObject parameterObject);
+        public virtual Task<RelationalDataReader> ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default(CancellationToken));
+        public virtual object ExecuteScalar(RelationalCommandParameterObject parameterObject);
+        public virtual Task<object> ExecuteScalarAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken = default(CancellationToken));
+    }
+    public class RelationalCommandBuilder : IRelationalCommandBuilder {
+        public RelationalCommandBuilder(RelationalCommandBuilderDependencies dependencies);
+        public virtual int CommandTextLength { get; }
+        public virtual RelationalCommandBuilderDependencies Dependencies { get; }
+        public virtual IReadOnlyList<IRelationalParameter> Parameters { get; }
+        public virtual IRelationalTypeMappingSource TypeMappingSource { get; }
+        public virtual IRelationalCommandBuilder AddParameter(IRelationalParameter parameter);
+        public virtual IRelationalCommandBuilder Append(object value);
+        public virtual IRelationalCommandBuilder AppendLine();
+        public virtual IRelationalCommand Build();
+        public virtual IRelationalCommandBuilder DecrementIndent();
+        public virtual IRelationalCommandBuilder IncrementIndent();
+        public override string ToString();
+    }
+    public sealed class RelationalCommandBuilderDependencies {
+        public RelationalCommandBuilderDependencies(IRelationalTypeMappingSource typeMappingSource);
+        public IRelationalTypeMappingSource TypeMappingSource { get; }
+        public RelationalCommandBuilderDependencies With(IRelationalTypeMappingSource typeMappingSource);
+    }
     public static class RelationalCommandBuilderExtensions {
-        public static IRelationalCommandBuilder AddCompositeParameter(this IRelationalCommandBuilder commandBuilder, string invariantName, Action<IRelationalParameterBuilder> buildAction);

+        public static IRelationalCommandBuilder AddCompositeParameter(this IRelationalCommandBuilder commandBuilder, string invariantName, IReadOnlyList<IRelationalParameter> subParameters);
-        public static IRelationalCommandBuilder Append(this IRelationalCommandBuilder commandBuilder, object o);

-        public static IRelationalCommandBuilder AppendLine(this IRelationalCommandBuilder commandBuilder);

-        public static IRelationalCommandBuilder AppendLine(this IRelationalCommandBuilder commandBuilder, object o);
+        public static IRelationalCommandBuilder AppendLine(this IRelationalCommandBuilder commandBuilder, object value);
-        public static IRelationalCommandBuilder AppendLines(this IRelationalCommandBuilder commandBuilder, object o);

+        public static IRelationalCommandBuilder AppendLines(this IRelationalCommandBuilder commandBuilder, object value, bool skipFinalNewline = false);
-        public static IRelationalCommandBuilder DecrementIndent(this IRelationalCommandBuilder commandBuilder);

-        public static int GetLength(this IRelationalCommandBuilder commandBuilder);

-        public static IRelationalCommandBuilder IncrementIndent(this IRelationalCommandBuilder commandBuilder);

     }
+    public class RelationalCommandBuilderFactory : IRelationalCommandBuilderFactory {
+        public RelationalCommandBuilderFactory(RelationalCommandBuilderDependencies dependencies);
+        public virtual RelationalCommandBuilderDependencies Dependencies { get; }
+        public virtual IRelationalCommandBuilder Create();
+    }
-    public static class RelationalCommandExtensions {
 {
-        public static int ExecuteNonQuery(this IRelationalCommand command, IRelationalConnection connection);

-        public static Task<int> ExecuteNonQueryAsync(this IRelationalCommand command, IRelationalConnection connection, CancellationToken cancellationToken = default(CancellationToken));

-        public static RelationalDataReader ExecuteReader(this IRelationalCommand command, IRelationalConnection connection);

-        public static Task<RelationalDataReader> ExecuteReaderAsync(this IRelationalCommand command, IRelationalConnection connection, CancellationToken cancellationToken = default(CancellationToken));

-        public static object ExecuteScalar(this IRelationalCommand command, IRelationalConnection connection);

-        public static Task<object> ExecuteScalarAsync(this IRelationalCommand command, IRelationalConnection connection, CancellationToken cancellationToken = default(CancellationToken));

-    }
+    public readonly struct RelationalCommandParameterObject {
+        public RelationalCommandParameterObject(IRelationalConnection connection, IReadOnlyDictionary<string, object> parameterValues, DbContext context, IDiagnosticsLogger<DbLoggerCategory.Database.Command> logger);
+        public IRelationalConnection Connection { get; }
+        public DbContext Context { get; }
+        public IDiagnosticsLogger<DbLoggerCategory.Database.Command> Logger { get; }
+        public IReadOnlyDictionary<string, object> ParameterValues { get; }
+    }
-    public abstract class RelationalConnection : IDbContextTransactionManager, IDisposable, IRelationalConnection, IRelationalTransactionManager, IResettableService, ITransactionEnlistmentManager {
+    public abstract class RelationalConnection : IAsyncDisposable, IDbContextTransactionManager, IDisposable, IRelationalConnection, IRelationalTransactionManager, IResettableService, ITransactionEnlistmentManager {
-        public virtual int? CommandTimeout { get; set; }
+        public virtual Nullable<int> CommandTimeout { get; set; }
+        public virtual DbContext Context { get; }
+        public virtual Task<bool> CloseAsync();
+        public virtual ValueTask DisposeAsync();
+        Task Microsoft.EntityFrameworkCore.Infrastructure.IResettableService.ResetStateAsync(CancellationToken cancellationToken);
-        void Microsoft.EntityFrameworkCore.Storage.IRelationalConnection.RegisterBufferable(IBufferable bufferable);

-        Task Microsoft.EntityFrameworkCore.Storage.IRelationalConnection.RegisterBufferableAsync(IBufferable bufferable, CancellationToken cancellationToken);

+        public virtual Task<IDbContextTransaction> UseTransactionAsync(DbTransaction transaction, CancellationToken cancellationToken = default(CancellationToken));
     }
     public sealed class RelationalConnectionDependencies {
-        public RelationalConnectionDependencies(IDbContextOptions contextOptions, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> transactionLogger, IDiagnosticsLogger<DbLoggerCategory.Database.Connection> connectionLogger, INamedConnectionStringResolver connectionStringResolver, IRelationalTransactionFactory relationalTransactionFactory);

+        public RelationalConnectionDependencies(IDbContextOptions contextOptions, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> transactionLogger, IDiagnosticsLogger<DbLoggerCategory.Database.Connection> connectionLogger, INamedConnectionStringResolver connectionStringResolver, IRelationalTransactionFactory relationalTransactionFactory, ICurrentDbContext currentContext);
+        public ICurrentDbContext CurrentContext { get; }
+        public RelationalConnectionDependencies With(ICurrentDbContext currentContext);
     }
     public class RelationalDatabase : Database {
+        public override int SaveChanges(IList<IUpdateEntry> entries);
-        public override int SaveChanges(IReadOnlyList<IUpdateEntry> entries);

+        public override Task<int> SaveChangesAsync(IList<IUpdateEntry> entries, CancellationToken cancellationToken = default(CancellationToken));
-        public override Task<int> SaveChangesAsync(IReadOnlyList<IUpdateEntry> entries, CancellationToken cancellationToken = default(CancellationToken));

     }
-    public abstract class RelationalDatabaseCreator : IDatabaseCreator, IDatabaseCreatorWithCanConnect, IRelationalDatabaseCreator {
+    public abstract class RelationalDatabaseCreator : IDatabaseCreator, IRelationalDatabaseCreator {
-        protected abstract bool HasTables();
+        public abstract bool HasTables();
-        protected virtual Task<bool> HasTablesAsync(CancellationToken cancellationToken = default(CancellationToken));
+        public virtual Task<bool> HasTablesAsync(CancellationToken cancellationToken = default(CancellationToken));
     }
     public sealed class RelationalDatabaseCreatorDependencies {
-        public RelationalDatabaseCreatorDependencies(IModel model, IRelationalConnection connection, IMigrationsModelDiffer modelDiffer, IMigrationsSqlGenerator migrationsSqlGenerator, IMigrationCommandExecutor migrationCommandExecutor, ISqlGenerationHelper sqlGenerationHelper, IExecutionStrategyFactory executionStrategyFactory);

+        public RelationalDatabaseCreatorDependencies(IModel model, IRelationalConnection connection, IMigrationsModelDiffer modelDiffer, IMigrationsSqlGenerator migrationsSqlGenerator, IMigrationCommandExecutor migrationCommandExecutor, ISqlGenerationHelper sqlGenerationHelper, IExecutionStrategyFactory executionStrategyFactory, ICurrentDbContext currentContext, IDiagnosticsLogger<DbLoggerCategory.Database.Command> commandLogger);
+        public IDiagnosticsLogger<DbLoggerCategory.Database.Command> CommandLogger { get; }
+        public ICurrentDbContext CurrentContext { get; }
+        public RelationalDatabaseCreatorDependencies With(IDiagnosticsLogger<DbLoggerCategory.Database.Command> commandLogger);
+        public RelationalDatabaseCreatorDependencies With(ICurrentDbContext currentContext);
     }
-    public class RelationalDataReader : IDisposable {
+    public class RelationalDataReader : IAsyncDisposable, IDisposable {
-        protected RelationalDataReader(DbCommand command, DbDataReader reader, IDiagnosticsLogger<DbLoggerCategory.Database.Command> logger);

-        protected RelationalDataReader(DbDataReader reader);

+        public virtual ValueTask DisposeAsync();
     }
     public abstract class RelationalGeometryTypeMapping<TGeometry, TProvider> : RelationalTypeMapping {
-        public override DbParameter CreateParameter(DbCommand command, string name, object value, bool? nullable = default(bool?));
+        public override DbParameter CreateParameter(DbCommand command, string name, object value, Nullable<bool> nullable = default(Nullable<bool>));
     }
     public class RelationalSqlGenerationHelper : ISqlGenerationHelper {
+        public virtual string SingleLineCommentToken { get; }
-        public virtual string EscapeLiteral(string literal);

-        public virtual void EscapeLiteral(StringBuilder builder, string literal);

+        public virtual string GenerateComment(string text);
     }
-    public class RelationalTransaction : IDbContextTransaction, IDisposable, IInfrastructure<DbTransaction> {
+    public class RelationalTransaction : IAsyncDisposable, IDbContextTransaction, IDisposable, IInfrastructure<DbTransaction> {
-        public RelationalTransaction(IRelationalConnection connection, DbTransaction transaction, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> logger, bool transactionOwned);

+        public RelationalTransaction(IRelationalConnection connection, DbTransaction transaction, Guid transactionId, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> logger, bool transactionOwned);
-        DbTransaction Microsoft.EntityFrameworkCore.Infrastructure.IInfrastructure<System.Data.Common.DbTransaction>.Instance { get; }

+        protected virtual Task ClearTransactionAsync(CancellationToken cancellationToken = default(CancellationToken));
+        public virtual Task CommitAsync(CancellationToken cancellationToken = default(CancellationToken));
+        public virtual ValueTask DisposeAsync();
+        public virtual Task RollbackAsync(CancellationToken cancellationToken = default(CancellationToken));
     }
     public class RelationalTransactionFactory : IRelationalTransactionFactory {
-        public virtual RelationalTransaction Create(IRelationalConnection connection, DbTransaction transaction, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> logger, bool transactionOwned);

+        public virtual RelationalTransaction Create(IRelationalConnection connection, DbTransaction transaction, Guid transactionId, IDiagnosticsLogger<DbLoggerCategory.Database.Transaction> logger, bool transactionOwned);
     }
-    public abstract class RelationalTypeMapper : IRelationalTypeMapper, ITypeMapper {
 {
-        protected RelationalTypeMapper(RelationalTypeMapperDependencies dependencies);

-        public virtual IByteArrayRelationalTypeMapper ByteArrayMapper { get; }

-        public virtual IStringRelationalTypeMapper StringMapper { get; }

-        protected virtual RelationalTypeMapping CreateMappingFromStoreType(string storeType);

-        protected virtual RelationalTypeMapping FindCustomMapping(IProperty property);

-        public virtual RelationalTypeMapping FindMapping(IProperty property);

-        public virtual RelationalTypeMapping FindMapping(string storeType);

-        public virtual RelationalTypeMapping FindMapping(Type clrType);

-        protected virtual RelationalTypeMapping GetByteArrayMapping(IProperty property);

-        protected abstract IReadOnlyDictionary<Type, RelationalTypeMapping> GetClrTypeMappings();

-        protected virtual string GetColumnType(IProperty property);

-        protected abstract IReadOnlyDictionary<string, RelationalTypeMapping> GetStoreTypeMappings();

-        protected virtual RelationalTypeMapping GetStringMapping(IProperty property);

-        public virtual bool IsTypeMapped(Type clrType);

-        protected virtual bool RequiresKeyMapping(IProperty property);

-        public virtual void ValidateTypeName(string storeType);

-    }
-    public sealed class RelationalTypeMapperDependencies {
 {
-        public RelationalTypeMapperDependencies();

-    }
-    public static class RelationalTypeMapperExtensions {
 {
-        public static RelationalTypeMapping GetMapping(this IRelationalTypeMapper typeMapper, IProperty property);

-        public static RelationalTypeMapping GetMapping(this IRelationalTypeMapper typeMapper, string typeName);

-        public static RelationalTypeMapping GetMapping(this IRelationalTypeMapper typeMapper, Type clrType);

-        public static RelationalTypeMapping GetMappingForValue(this IRelationalTypeMapper typeMapper, object value);

-    }
     public abstract class RelationalTypeMapping : CoreTypeMapping {
-        protected RelationalTypeMapping(string storeType, Type clrType, DbType? dbType = default(DbType?), bool unicode = false, int? size = default(int?));
+        protected RelationalTypeMapping(string storeType, Type clrType, Nullable<DbType> dbType = default(Nullable<DbType>), bool unicode = false, Nullable<int> size = default(Nullable<int>));
-        public virtual DbType? DbType { get; }
+        public virtual Nullable<DbType> DbType { get; }
-        public virtual int? Size { get; }
+        public virtual Nullable<int> Size { get; }
-        protected virtual RelationalTypeMapping Clone(RelationalTypeMapping.RelationalTypeMappingParameters parameters);
+        protected abstract RelationalTypeMapping Clone(RelationalTypeMapping.RelationalTypeMappingParameters parameters);
-        public virtual RelationalTypeMapping Clone(int? precision, int? scale);
+        public virtual RelationalTypeMapping Clone(Nullable<int> precision, Nullable<int> scale);
-        public virtual RelationalTypeMapping Clone(string storeType, int? size);
+        public virtual RelationalTypeMapping Clone(string storeType, Nullable<int> size);
-        public virtual DbParameter CreateParameter(DbCommand command, string name, object value, bool? nullable = default(bool?));
+        public virtual DbParameter CreateParameter(DbCommand command, string name, object value, Nullable<bool> nullable = default(Nullable<bool>));
+        protected virtual string ProcessStoreType(RelationalTypeMapping.RelationalTypeMappingParameters parameters, string storeType, string storeTypeNameBase);
         protected readonly struct RelationalTypeMappingParameters {
-            public RelationalTypeMappingParameters(CoreTypeMapping.CoreTypeMappingParameters coreParameters, string storeType, StoreTypePostfix storeTypePostfix = StoreTypePostfix.None, DbType? dbType = default(DbType?), bool unicode = false, int? size = default(int?), bool fixedLength = false, int? precision = default(int?), int? scale = default(int?));
+            public RelationalTypeMappingParameters(CoreTypeMapping.CoreTypeMappingParameters coreParameters, string storeType, StoreTypePostfix storeTypePostfix = StoreTypePostfix.None, Nullable<DbType> dbType = default(Nullable<DbType>), bool unicode = false, Nullable<int> size = default(Nullable<int>), bool fixedLength = false, Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
-            public DbType? DbType { get; }
+            public Nullable<DbType> DbType { get; }
-            public int? Precision { get; }
+            public Nullable<int> Precision { get; }
-            public bool PrecisionAndScaleOverriden { get; }

-            public int? Scale { get; }
+            public Nullable<int> Scale { get; }
-            public int? Size { get; }
+            public Nullable<int> Size { get; }
-            public RelationalTypeMapping.RelationalTypeMappingParameters WithPrecisionAndScale(int? precision, int? scale);
+            public RelationalTypeMapping.RelationalTypeMappingParameters WithPrecisionAndScale(Nullable<int> precision, Nullable<int> scale);
-            public RelationalTypeMapping.RelationalTypeMappingParameters WithStoreTypeAndSize(string storeType, int? size, StoreTypePostfix? storeTypePostfix = default(StoreTypePostfix?));
+            public RelationalTypeMapping.RelationalTypeMappingParameters WithStoreTypeAndSize(string storeType, Nullable<int> size, Nullable<StoreTypePostfix> storeTypePostfix = default(Nullable<StoreTypePostfix>));
         }
     }
     public readonly struct RelationalTypeMappingInfo : IEquatable<RelationalTypeMappingInfo> {
-        public RelationalTypeMappingInfo(IReadOnlyList<IProperty> principals);

+        public RelationalTypeMappingInfo(IReadOnlyList<IProperty> principals, string storeTypeName = null, string storeTypeNameBase = null, Nullable<bool> fallbackUnicode = default(Nullable<bool>), Nullable<bool> fixedLength = default(Nullable<bool>), Nullable<int> fallbackSize = default(Nullable<int>), Nullable<int> fallbackPrecision = default(Nullable<int>), Nullable<int> fallbackScale = default(Nullable<int>));
-        public RelationalTypeMappingInfo(MemberInfo member);

+        public RelationalTypeMappingInfo(MemberInfo member, string storeTypeName = null, string storeTypeNameBase = null, Nullable<bool> unicode = default(Nullable<bool>), Nullable<int> size = default(Nullable<int>), Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
-        public RelationalTypeMappingInfo(string storeTypeName);

+        public RelationalTypeMappingInfo(string storeTypeName, string storeTypeNameBase, Nullable<bool> unicode, Nullable<int> size, Nullable<int> precision, Nullable<int> scale);
-        public RelationalTypeMappingInfo(Type type);

-        public RelationalTypeMappingInfo(Type type, string storeTypeName, bool keyOrIndex, bool? unicode, int? size, bool? rowVersion, bool? fixedLength, int? precision, int? scale);

+        public RelationalTypeMappingInfo(Type type, string storeTypeName = null, string storeTypeNameBase = null, bool keyOrIndex = false, Nullable<bool> unicode = default(Nullable<bool>), Nullable<int> size = default(Nullable<int>), Nullable<bool> rowVersion = default(Nullable<bool>), Nullable<bool> fixedLength = default(Nullable<bool>), Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
-        public bool? IsFixedLength { get; }
+        public Nullable<bool> IsFixedLength { get; }
-        public bool? IsRowVersion { get; }
+        public Nullable<bool> IsRowVersion { get; }
-        public bool? IsUnicode { get; }
+        public Nullable<bool> IsUnicode { get; }
-        public int? Precision { get; }
+        public Nullable<int> Precision { get; }
-        public int? Scale { get; }
+        public Nullable<int> Scale { get; }
-        public int? Size { get; }
+        public Nullable<int> Size { get; }
-        public bool StoreTypeNameSizeIsMax { get; }

     }
     public abstract class RelationalTypeMappingSource : TypeMappingSourceBase, IRelationalTypeMappingSource, ITypeMappingSource {
-        public virtual RelationalTypeMapping FindMapping(Type type, string storeTypeName, bool keyOrIndex = false, bool? unicode = default(bool?), int? size = default(int?), bool? rowVersion = default(bool?), bool? fixedLength = default(bool?), int? precision = default(int?), int? scale = default(int?));
+        public virtual RelationalTypeMapping FindMapping(Type type, string storeTypeName, bool keyOrIndex = false, Nullable<bool> unicode = default(Nullable<bool>), Nullable<int> size = default(Nullable<int>), Nullable<bool> rowVersion = default(Nullable<bool>), Nullable<bool> fixedLength = default(Nullable<bool>), Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
-        protected virtual RelationalTypeMapping FindMappingWithConversion(in RelationalTypeMappingInfo mappingInfo, IReadOnlyList<IProperty> principals);

+        protected virtual string ParseStoreTypeName(string storeTypeName, out Nullable<bool> unicode, out Nullable<int> size, out Nullable<int> precision, out Nullable<int> scale);
     }
     public class RetryLimitExceededException : Exception {
+        public RetryLimitExceededException();
+        public RetryLimitExceededException(SerializationInfo info, StreamingContext context);
     }
     public class SByteTypeMapping : RelationalTypeMapping {
-        public SByteTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public SByteTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class ShortTypeMapping : RelationalTypeMapping {
-        public ShortTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public ShortTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
-    public class StringRelationalTypeMapper : IStringRelationalTypeMapper {
 {
-        public StringRelationalTypeMapper(int maxBoundedAnsiLength, RelationalTypeMapping defaultAnsiMapping, RelationalTypeMapping unboundedAnsiMapping, RelationalTypeMapping keyAnsiMapping, Func<int, RelationalTypeMapping> createBoundedAnsiMapping, int maxBoundedUnicodeLength, RelationalTypeMapping defaultUnicodeMapping, RelationalTypeMapping unboundedUnicodeMapping, RelationalTypeMapping keyUnicodeMapping, Func<int, RelationalTypeMapping> createBoundedUnicodeMapping);

-        public virtual Func<int, RelationalTypeMapping> CreateBoundedAnsiMapping { get; }

-        public virtual Func<int, RelationalTypeMapping> CreateBoundedUnicodeMapping { get; }

-        public virtual RelationalTypeMapping DefaultAnsiMapping { get; }

-        public virtual RelationalTypeMapping DefaultUnicodeMapping { get; }

-        public virtual RelationalTypeMapping KeyAnsiMapping { get; }

-        public virtual RelationalTypeMapping KeyUnicodeMapping { get; }

-        public virtual int MaxBoundedAnsiLength { get; }

-        public virtual int MaxBoundedUnicodeLength { get; }

-        public virtual RelationalTypeMapping UnboundedAnsiMapping { get; }

-        public virtual RelationalTypeMapping UnboundedUnicodeMapping { get; }

-        public virtual RelationalTypeMapping FindMapping(bool unicode, bool keyOrIndex, int? maxLength);

-    }
     public class StringTypeMapping : RelationalTypeMapping {
-        public StringTypeMapping(string storeType, DbType? dbType = default(DbType?), bool unicode = false, int? size = default(int?));
+        public StringTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>), bool unicode = false, Nullable<int> size = default(Nullable<int>));
     }
     public class TimeSpanTypeMapping : RelationalTypeMapping {
-        public TimeSpanTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public TimeSpanTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class TypedRelationalValueBufferFactoryFactory : IRelationalValueBufferFactoryFactory {
-        public virtual IRelationalValueBufferFactory Create(IReadOnlyList<Type> valueTypes, IReadOnlyList<int> indexMap);

     }
     public readonly struct TypeMappingInfo : IEquatable<TypeMappingInfo> {
-        public TypeMappingInfo(TypeMappingInfo source, ValueConverterInfo converter, bool? unicode = default(bool?), int? size = default(int?), int? precision = default(int?), int? scale = default(int?));
+        public TypeMappingInfo(TypeMappingInfo source, ValueConverterInfo converter, Nullable<bool> unicode = default(Nullable<bool>), Nullable<int> size = default(Nullable<int>), Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
-        public TypeMappingInfo(IReadOnlyList<IProperty> principals);

+        public TypeMappingInfo(IReadOnlyList<IProperty> principals, Nullable<bool> fallbackUnicode = default(Nullable<bool>), Nullable<int> fallbackSize = default(Nullable<int>), Nullable<int> fallbackPrecision = default(Nullable<int>), Nullable<int> fallbackScale = default(Nullable<int>));
-        public TypeMappingInfo(MemberInfo member);

+        public TypeMappingInfo(MemberInfo member, Nullable<bool> unicode = default(Nullable<bool>), Nullable<int> size = default(Nullable<int>), Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
-        public TypeMappingInfo(Type type);

-        public TypeMappingInfo(Type type, bool keyOrIndex, bool? unicode = default(bool?), int? size = default(int?), bool? rowVersion = default(bool?), int? precision = default(int?), int? scale = default(int?));
+        public TypeMappingInfo(Type type = null, bool keyOrIndex = false, Nullable<bool> unicode = default(Nullable<bool>), Nullable<int> size = default(Nullable<int>), Nullable<bool> rowVersion = default(Nullable<bool>), Nullable<int> precision = default(Nullable<int>), Nullable<int> scale = default(Nullable<int>));
-        public bool? IsRowVersion { get; }
+        public Nullable<bool> IsRowVersion { get; }
-        public bool? IsUnicode { get; }
+        public Nullable<bool> IsUnicode { get; }
-        public int? Precision { get; }
+        public Nullable<int> Precision { get; }
-        public int? Scale { get; }
+        public Nullable<int> Scale { get; }
-        public int? Size { get; }
+        public Nullable<int> Size { get; }
     }
     public class TypeMaterializationInfo {
-        public TypeMaterializationInfo(Type modelClrType, IProperty property, IRelationalTypeMappingSource typeMappingSource, bool? fromLeftOuterJoin, int index);
+        public TypeMaterializationInfo(Type modelClrType, IProperty property, IRelationalTypeMappingSource typeMappingSource, Nullable<bool> fromLeftOuterJoin, int index);
-        public TypeMaterializationInfo(Type modelClrType, IProperty property, IRelationalTypeMappingSource typeMappingSource, bool? fromLeftOuterJoin, int index = -1, RelationalTypeMapping mapping = null);
+        public TypeMaterializationInfo(Type modelClrType, IProperty property, IRelationalTypeMappingSource typeMappingSource, Nullable<bool> fromLeftOuterJoin, int index = -1, RelationalTypeMapping mapping = null);
-        public virtual bool? IsFromLeftOuterJoin { get; }
+        public virtual Nullable<bool> IsFromLeftOuterJoin { get; }
     }
     public class UIntTypeMapping : RelationalTypeMapping {
-        public UIntTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public UIntTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public class ULongTypeMapping : RelationalTypeMapping {
-        public ULongTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public ULongTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
-    public class UntypedRelationalValueBufferFactoryFactory : IRelationalValueBufferFactoryFactory {
 {
-        public UntypedRelationalValueBufferFactoryFactory(RelationalValueBufferFactoryDependencies dependencies);

-        protected virtual RelationalValueBufferFactoryDependencies Dependencies { get; }

-        public virtual IRelationalValueBufferFactory Create(IReadOnlyList<TypeMaterializationInfo> types);

-        public virtual IRelationalValueBufferFactory Create(IReadOnlyList<Type> valueTypes, IReadOnlyList<int> indexMap);

-    }
     public class UShortTypeMapping : RelationalTypeMapping {
-        public UShortTypeMapping(string storeType, DbType? dbType = default(DbType?));
+        public UShortTypeMapping(string storeType, Nullable<DbType> dbType = default(Nullable<DbType>));
     }
     public readonly struct ValueBuffer {
-        public ValueBuffer(object[] values, int offset);

-        public ValueBuffer WithOffset(int offset);

     }
 }
```

